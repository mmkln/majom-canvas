(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function e(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(i){if(i.ep)return;i.ep=!0;const r=e(i);fetch(i.href,r)}})();var ae=function(s,t){return ae=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])},ae(s,t)};function Et(s,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");ae(s,t);function e(){this.constructor=s}s.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}function Yn(s,t,e,n){function i(r){return r instanceof e?r:new e(function(o){o(r)})}return new(e||(e=Promise))(function(r,o){function c(h){try{l(n.next(h))}catch(d){o(d)}}function a(h){try{l(n.throw(h))}catch(d){o(d)}}function l(h){h.done?r(h.value):i(h.value).then(c,a)}l((n=n.apply(s,t||[])).next())})}function tn(s,t){var e={label:0,sent:function(){if(r[0]&1)throw r[1];return r[1]},trys:[],ops:[]},n,i,r,o=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return o.next=c(0),o.throw=c(1),o.return=c(2),typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function c(l){return function(h){return a([l,h])}}function a(l){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,l[0]&&(e=0)),e;)try{if(n=1,i&&(r=l[0]&2?i.return:l[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,l[1])).done)return r;switch(i=0,r&&(l=[l[0]&2,r.value]),l[0]){case 0:case 1:r=l;break;case 4:return e.label++,{value:l[1],done:!1};case 5:e.label++,i=l[1],l=[0];continue;case 7:l=e.ops.pop(),e.trys.pop();continue;default:if(r=e.trys,!(r=r.length>0&&r[r.length-1])&&(l[0]===6||l[0]===2)){e=0;continue}if(l[0]===3&&(!r||l[1]>r[0]&&l[1]<r[3])){e.label=l[1];break}if(l[0]===6&&e.label<r[1]){e.label=r[1],r=l;break}if(r&&e.label<r[2]){e.label=r[2],e.ops.push(l);break}r[2]&&e.ops.pop(),e.trys.pop();continue}l=t.call(s,e)}catch(h){l=[6,h],i=0}finally{n=r=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function St(s){var t=typeof Symbol=="function"&&Symbol.iterator,e=t&&s[t],n=0;if(e)return e.call(s);if(s&&typeof s.length=="number")return{next:function(){return s&&n>=s.length&&(s=void 0),{value:s&&s[n++],done:!s}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function Gt(s,t){var e=typeof Symbol=="function"&&s[Symbol.iterator];if(!e)return s;var n=e.call(s),i,r=[],o;try{for(;(t===void 0||t-- >0)&&!(i=n.next()).done;)r.push(i.value)}catch(c){o={error:c}}finally{try{i&&!i.done&&(e=n.return)&&e.call(n)}finally{if(o)throw o.error}}return r}function Ht(s,t,e){if(e||arguments.length===2)for(var n=0,i=t.length,r;n<i;n++)(r||!(n in t))&&(r||(r=Array.prototype.slice.call(t,0,n)),r[n]=t[n]);return s.concat(r||Array.prototype.slice.call(t))}function xt(s){return this instanceof xt?(this.v=s,this):new xt(s)}function Zn(s,t,e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=e.apply(s,t||[]),i,r=[];return i=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),c("next"),c("throw"),c("return",o),i[Symbol.asyncIterator]=function(){return this},i;function o(p){return function(f){return Promise.resolve(f).then(p,d)}}function c(p,f){n[p]&&(i[p]=function(m){return new Promise(function(S,v){r.push([p,m,S,v])>1||a(p,m)})},f&&(i[p]=f(i[p])))}function a(p,f){try{l(n[p](f))}catch(m){u(r[0][3],m)}}function l(p){p.value instanceof xt?Promise.resolve(p.value.v).then(h,d):u(r[0][2],p)}function h(p){a("next",p)}function d(p){a("throw",p)}function u(p,f){p(f),r.shift(),r.length&&a(r[0][0],r[0][1])}}function Xn(s){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=s[Symbol.asyncIterator],e;return t?t.call(s):(s=typeof St=="function"?St(s):s[Symbol.iterator](),e={},n("next"),n("throw"),n("return"),e[Symbol.asyncIterator]=function(){return this},e);function n(r){e[r]=s[r]&&function(o){return new Promise(function(c,a){o=s[r](o),i(c,a,o.done,o.value)})}}function i(r,o,c,a){Promise.resolve(a).then(function(l){r({value:l,done:c})},o)}}function R(s){return typeof s=="function"}function en(s){var t=function(n){Error.call(n),n.stack=new Error().stack},e=s(t);return e.prototype=Object.create(Error.prototype),e.prototype.constructor=e,e}var te=en(function(s){return function(e){s(this),this.message=e?e.length+` errors occurred during unsubscription:
`+e.map(function(n,i){return i+1+") "+n.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=e}});function ce(s,t){if(s){var e=s.indexOf(t);0<=e&&s.splice(e,1)}}var Ft=function(){function s(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._finalizers=null}return s.prototype.unsubscribe=function(){var t,e,n,i,r;if(!this.closed){this.closed=!0;var o=this._parentage;if(o)if(this._parentage=null,Array.isArray(o))try{for(var c=St(o),a=c.next();!a.done;a=c.next()){var l=a.value;l.remove(this)}}catch(m){t={error:m}}finally{try{a&&!a.done&&(e=c.return)&&e.call(c)}finally{if(t)throw t.error}}else o.remove(this);var h=this.initialTeardown;if(R(h))try{h()}catch(m){r=m instanceof te?m.errors:[m]}var d=this._finalizers;if(d){this._finalizers=null;try{for(var u=St(d),p=u.next();!p.done;p=u.next()){var f=p.value;try{Re(f)}catch(m){r=r??[],m instanceof te?r=Ht(Ht([],Gt(r)),Gt(m.errors)):r.push(m)}}}catch(m){n={error:m}}finally{try{p&&!p.done&&(i=u.return)&&i.call(u)}finally{if(n)throw n.error}}}if(r)throw new te(r)}},s.prototype.add=function(t){var e;if(t&&t!==this)if(this.closed)Re(t);else{if(t instanceof s){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=(e=this._finalizers)!==null&&e!==void 0?e:[]).push(t)}},s.prototype._hasParent=function(t){var e=this._parentage;return e===t||Array.isArray(e)&&e.includes(t)},s.prototype._addParent=function(t){var e=this._parentage;this._parentage=Array.isArray(e)?(e.push(t),e):e?[e,t]:t},s.prototype._removeParent=function(t){var e=this._parentage;e===t?this._parentage=null:Array.isArray(e)&&ce(e,t)},s.prototype.remove=function(t){var e=this._finalizers;e&&ce(e,t),t instanceof s&&t._removeParent(this)},s.EMPTY=function(){var t=new s;return t.closed=!0,t}(),s}(),nn=Ft.EMPTY;function sn(s){return s instanceof Ft||s&&"closed"in s&&R(s.remove)&&R(s.add)&&R(s.unsubscribe)}function Re(s){R(s)?s():s.unsubscribe()}var Un={Promise:void 0},Bn={setTimeout:function(s,t){for(var e=[],n=2;n<arguments.length;n++)e[n-2]=arguments[n];return setTimeout.apply(void 0,Ht([s,t],Gt(e)))},clearTimeout:function(s){return clearTimeout(s)},delegate:void 0};function rn(s){Bn.setTimeout(function(){throw s})}function Ae(){}function Wt(s){s()}var me=function(s){Et(t,s);function t(e){var n=s.call(this)||this;return n.isStopped=!1,e?(n.destination=e,sn(e)&&e.add(n)):n.destination=Gn,n}return t.create=function(e,n,i){return new Dt(e,n,i)},t.prototype.next=function(e){this.isStopped||this._next(e)},t.prototype.error=function(e){this.isStopped||(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,s.prototype.unsubscribe.call(this),this.destination=null)},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){try{this.destination.error(e)}finally{this.unsubscribe()}},t.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},t}(Ft),$n=function(){function s(t){this.partialObserver=t}return s.prototype.next=function(t){var e=this.partialObserver;if(e.next)try{e.next(t)}catch(n){Zt(n)}},s.prototype.error=function(t){var e=this.partialObserver;if(e.error)try{e.error(t)}catch(n){Zt(n)}else Zt(t)},s.prototype.complete=function(){var t=this.partialObserver;if(t.complete)try{t.complete()}catch(e){Zt(e)}},s}(),Dt=function(s){Et(t,s);function t(e,n,i){var r=s.call(this)||this,o;return R(e)||!e?o={next:e??void 0,error:n??void 0,complete:i??void 0}:o=e,r.destination=new $n(o),r}return t}(me);function Zt(s){rn(s)}function Wn(s){throw s}var Gn={closed:!0,next:Ae,error:Wn,complete:Ae},ge=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function Hn(s){return s}function jn(s){return s.length===0?Hn:s.length===1?s[0]:function(e){return s.reduce(function(n,i){return i(n)},e)}}var W=function(){function s(t){t&&(this._subscribe=t)}return s.prototype.lift=function(t){var e=new s;return e.source=this,e.operator=t,e},s.prototype.subscribe=function(t,e,n){var i=this,r=Fn(t)?t:new Dt(t,e,n);return Wt(function(){var o=i,c=o.operator,a=o.source;r.add(c?c.call(r,a):a?i._subscribe(r):i._trySubscribe(r))}),r},s.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(e){t.error(e)}},s.prototype.forEach=function(t,e){var n=this;return e=De(e),new e(function(i,r){var o=new Dt({next:function(c){try{t(c)}catch(a){r(a),o.unsubscribe()}},error:r,complete:i});n.subscribe(o)})},s.prototype._subscribe=function(t){var e;return(e=this.source)===null||e===void 0?void 0:e.subscribe(t)},s.prototype[ge]=function(){return this},s.prototype.pipe=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return jn(t)(this)},s.prototype.toPromise=function(t){var e=this;return t=De(t),new t(function(n,i){var r;e.subscribe(function(o){return r=o},function(o){return i(o)},function(){return n(r)})})},s.create=function(t){return new s(t)},s}();function De(s){var t;return(t=s??Un.Promise)!==null&&t!==void 0?t:Promise}function Vn(s){return s&&R(s.next)&&R(s.error)&&R(s.complete)}function Fn(s){return s&&s instanceof me||Vn(s)&&sn(s)}function qn(s){return R(s==null?void 0:s.lift)}function V(s){return function(t){if(qn(t))return t.lift(function(e){try{return s(e,this)}catch(n){this.error(n)}});throw new TypeError("Unable to lift unknown Observable type")}}function nt(s,t,e,n,i){return new Kn(s,t,e,n,i)}var Kn=function(s){Et(t,s);function t(e,n,i,r,o,c){var a=s.call(this,e)||this;return a.onFinalize=o,a.shouldUnsubscribe=c,a._next=n?function(l){try{n(l)}catch(h){e.error(h)}}:s.prototype._next,a._error=r?function(l){try{r(l)}catch(h){e.error(h)}finally{this.unsubscribe()}}:s.prototype._error,a._complete=i?function(){try{i()}catch(l){e.error(l)}finally{this.unsubscribe()}}:s.prototype._complete,a}return t.prototype.unsubscribe=function(){var e;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var n=this.closed;s.prototype.unsubscribe.call(this),!n&&((e=this.onFinalize)===null||e===void 0||e.call(this))}},t}(me),Jn=en(function(s){return function(){s(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),it=function(s){Et(t,s);function t(){var e=s.call(this)||this;return e.closed=!1,e.currentObservers=null,e.observers=[],e.isStopped=!1,e.hasError=!1,e.thrownError=null,e}return t.prototype.lift=function(e){var n=new _e(this,this);return n.operator=e,n},t.prototype._throwIfClosed=function(){if(this.closed)throw new Jn},t.prototype.next=function(e){var n=this;Wt(function(){var i,r;if(n._throwIfClosed(),!n.isStopped){n.currentObservers||(n.currentObservers=Array.from(n.observers));try{for(var o=St(n.currentObservers),c=o.next();!c.done;c=o.next()){var a=c.value;a.next(e)}}catch(l){i={error:l}}finally{try{c&&!c.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}}})},t.prototype.error=function(e){var n=this;Wt(function(){if(n._throwIfClosed(),!n.isStopped){n.hasError=n.isStopped=!0,n.thrownError=e;for(var i=n.observers;i.length;)i.shift().error(e)}})},t.prototype.complete=function(){var e=this;Wt(function(){if(e._throwIfClosed(),!e.isStopped){e.isStopped=!0;for(var n=e.observers;n.length;)n.shift().complete()}})},t.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(t.prototype,"observed",{get:function(){var e;return((e=this.observers)===null||e===void 0?void 0:e.length)>0},enumerable:!1,configurable:!0}),t.prototype._trySubscribe=function(e){return this._throwIfClosed(),s.prototype._trySubscribe.call(this,e)},t.prototype._subscribe=function(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)},t.prototype._innerSubscribe=function(e){var n=this,i=this,r=i.hasError,o=i.isStopped,c=i.observers;return r||o?nn:(this.currentObservers=null,c.push(e),new Ft(function(){n.currentObservers=null,ce(c,e)}))},t.prototype._checkFinalizedStatuses=function(e){var n=this,i=n.hasError,r=n.thrownError,o=n.isStopped;i?e.error(r):o&&e.complete()},t.prototype.asObservable=function(){var e=new W;return e.source=this,e},t.create=function(e,n){return new _e(e,n)},t}(W),_e=function(s){Et(t,s);function t(e,n){var i=s.call(this)||this;return i.destination=e,i.source=n,i}return t.prototype.next=function(e){var n,i;(i=(n=this.destination)===null||n===void 0?void 0:n.next)===null||i===void 0||i.call(n,e)},t.prototype.error=function(e){var n,i;(i=(n=this.destination)===null||n===void 0?void 0:n.error)===null||i===void 0||i.call(n,e)},t.prototype.complete=function(){var e,n;(n=(e=this.destination)===null||e===void 0?void 0:e.complete)===null||n===void 0||n.call(e)},t.prototype._subscribe=function(e){var n,i;return(i=(n=this.source)===null||n===void 0?void 0:n.subscribe(e))!==null&&i!==void 0?i:nn},t}(it),on={now:function(){return(on.delegate||Date).now()},delegate:void 0},Qn=function(s){Et(t,s);function t(e,n,i){e===void 0&&(e=1/0),n===void 0&&(n=1/0),i===void 0&&(i=on);var r=s.call(this)||this;return r._bufferSize=e,r._windowTime=n,r._timestampProvider=i,r._buffer=[],r._infiniteTimeWindow=!0,r._infiniteTimeWindow=n===1/0,r._bufferSize=Math.max(1,e),r._windowTime=Math.max(1,n),r}return t.prototype.next=function(e){var n=this,i=n.isStopped,r=n._buffer,o=n._infiniteTimeWindow,c=n._timestampProvider,a=n._windowTime;i||(r.push(e),!o&&r.push(c.now()+a)),this._trimBuffer(),s.prototype.next.call(this,e)},t.prototype._subscribe=function(e){this._throwIfClosed(),this._trimBuffer();for(var n=this._innerSubscribe(e),i=this,r=i._infiniteTimeWindow,o=i._buffer,c=o.slice(),a=0;a<c.length&&!e.closed;a+=r?1:2)e.next(c[a]);return this._checkFinalizedStatuses(e),n},t.prototype._trimBuffer=function(){var e=this,n=e._bufferSize,i=e._timestampProvider,r=e._buffer,o=e._infiniteTimeWindow,c=(o?1:2)*n;if(n<1/0&&c<r.length&&r.splice(0,r.length-c),!o){for(var a=i.now(),l=0,h=1;h<r.length&&r[h]<=a;h+=2)l=h;l&&r.splice(0,l+1)}},t}(it);function ts(s){return s&&R(s.schedule)}function es(s){return s[s.length-1]}function ns(s){return ts(es(s))?s.pop():void 0}var an=function(s){return s&&typeof s.length=="number"&&typeof s!="function"};function cn(s){return R(s==null?void 0:s.then)}function ln(s){return R(s[ge])}function hn(s){return Symbol.asyncIterator&&R(s==null?void 0:s[Symbol.asyncIterator])}function dn(s){return new TypeError("You provided "+(s!==null&&typeof s=="object"?"an invalid object":"'"+s+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function ss(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var un=ss();function pn(s){return R(s==null?void 0:s[un])}function fn(s){return Zn(this,arguments,function(){var e,n,i,r;return tn(this,function(o){switch(o.label){case 0:e=s.getReader(),o.label=1;case 1:o.trys.push([1,,9,10]),o.label=2;case 2:return[4,xt(e.read())];case 3:return n=o.sent(),i=n.value,r=n.done,r?[4,xt(void 0)]:[3,5];case 4:return[2,o.sent()];case 5:return[4,xt(i)];case 6:return[4,o.sent()];case 7:return o.sent(),[3,2];case 8:return[3,10];case 9:return e.releaseLock(),[7];case 10:return[2]}})})}function mn(s){return R(s==null?void 0:s.getReader)}function Q(s){if(s instanceof W)return s;if(s!=null){if(ln(s))return is(s);if(an(s))return rs(s);if(cn(s))return os(s);if(hn(s))return gn(s);if(pn(s))return as(s);if(mn(s))return cs(s)}throw dn(s)}function is(s){return new W(function(t){var e=s[ge]();if(R(e.subscribe))return e.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function rs(s){return new W(function(t){for(var e=0;e<s.length&&!t.closed;e++)t.next(s[e]);t.complete()})}function os(s){return new W(function(t){s.then(function(e){t.closed||(t.next(e),t.complete())},function(e){return t.error(e)}).then(null,rn)})}function as(s){return new W(function(t){var e,n;try{for(var i=St(s),r=i.next();!r.done;r=i.next()){var o=r.value;if(t.next(o),t.closed)return}}catch(c){e={error:c}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}t.complete()})}function gn(s){return new W(function(t){ls(s,t).catch(function(e){return t.error(e)})})}function cs(s){return gn(fn(s))}function ls(s,t){var e,n,i,r;return Yn(this,void 0,void 0,function(){var o,c;return tn(this,function(a){switch(a.label){case 0:a.trys.push([0,5,6,11]),e=Xn(s),a.label=1;case 1:return[4,e.next()];case 2:if(n=a.sent(),!!n.done)return[3,4];if(o=n.value,t.next(o),t.closed)return[2];a.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return c=a.sent(),i={error:c},[3,11];case 6:return a.trys.push([6,,9,10]),n&&!n.done&&(r=e.return)?[4,r.call(e)]:[3,8];case 7:a.sent(),a.label=8;case 8:return[3,10];case 9:if(i)throw i.error;return[7];case 10:return[7];case 11:return t.complete(),[2]}})})}function ut(s,t,e,n,i){n===void 0&&(n=0),i===void 0&&(i=!1);var r=t.schedule(function(){e(),i?s.add(this.schedule(null,n)):this.unsubscribe()},n);if(s.add(r),!i)return r}function bn(s,t){return t===void 0&&(t=0),V(function(e,n){e.subscribe(nt(n,function(i){return ut(n,s,function(){return n.next(i)},t)},function(){return ut(n,s,function(){return n.complete()},t)},function(i){return ut(n,s,function(){return n.error(i)},t)}))})}function vn(s,t){return t===void 0&&(t=0),V(function(e,n){n.add(s.schedule(function(){return e.subscribe(n)},t))})}function hs(s,t){return Q(s).pipe(vn(t),bn(t))}function ds(s,t){return Q(s).pipe(vn(t),bn(t))}function us(s,t){return new W(function(e){var n=0;return t.schedule(function(){n===s.length?e.complete():(e.next(s[n++]),e.closed||this.schedule())})})}function ps(s,t){return new W(function(e){var n;return ut(e,t,function(){n=s[un](),ut(e,t,function(){var i,r,o;try{i=n.next(),r=i.value,o=i.done}catch(c){e.error(c);return}o?e.complete():e.next(r)},0,!0)}),function(){return R(n==null?void 0:n.return)&&n.return()}})}function yn(s,t){if(!s)throw new Error("Iterable cannot be null");return new W(function(e){ut(e,t,function(){var n=s[Symbol.asyncIterator]();ut(e,t,function(){n.next().then(function(i){i.done?e.complete():e.next(i.value)})},0,!0)})})}function fs(s,t){return yn(fn(s),t)}function ms(s,t){if(s!=null){if(ln(s))return hs(s,t);if(an(s))return us(s,t);if(cn(s))return ds(s,t);if(hn(s))return yn(s,t);if(pn(s))return ps(s,t);if(mn(s))return fs(s,t)}throw dn(s)}function Z(s,t){return t?ms(s,t):Q(s)}function gs(){for(var s=[],t=0;t<arguments.length;t++)s[t]=arguments[t];var e=ns(s);return Z(s,e)}function vt(s,t){var e=R(s)?s:function(){return s},n=function(i){return i.error(e())};return new W(n)}function ct(s,t){return V(function(e,n){var i=0;e.subscribe(nt(n,function(r){n.next(s.call(t,r,i++))}))})}function bs(s,t,e,n,i,r,o,c){var a=[],l=0,h=0,d=!1,u=function(){d&&!a.length&&!l&&t.complete()},p=function(m){return l<n?f(m):a.push(m)},f=function(m){l++;var S=!1;Q(e(m,h++)).subscribe(nt(t,function(v){t.next(v)},function(){S=!0},void 0,function(){if(S)try{l--;for(var v=function(){var w=a.shift();o||f(w)};a.length&&l<n;)v();u()}catch(w){t.error(w)}}))};return s.subscribe(nt(t,p,function(){d=!0,u()})),function(){}}function be(s,t,e){return e===void 0&&(e=1/0),R(t)?be(function(n,i){return ct(function(r,o){return t(n,r,i,o)})(Q(s(n,i)))},e):(typeof t=="number"&&(e=t),V(function(n,i){return bs(n,i,s,e)}))}function yt(s){return V(function(t,e){var n=null,i=!1,r;n=t.subscribe(nt(e,void 0,void 0,function(o){r=Q(s(o,yt(s)(t))),n?(n.unsubscribe(),n=null,r.subscribe(e)):i=!0})),i&&(n.unsubscribe(),n=null,r.subscribe(e))})}function vs(s,t,e,n,i){return function(r,o){var c=e,a=t,l=0;r.subscribe(nt(o,function(h){var d=l++;a=c?s(a,h,d):(c=!0,h)},function(){c&&o.next(a),o.complete()}))}}function ys(s,t){return V(vs(s,t,arguments.length>=2,!1,!0))}var ws=function(s,t){return s.push(t),s};function xs(){return V(function(s,t){ys(ws,[])(s).subscribe(t)})}function Ss(s){return V(function(t,e){try{t.subscribe(e)}finally{e.add(s)}})}function Es(s){s===void 0&&(s={});var t=s.connector,e=t===void 0?function(){return new it}:t,n=s.resetOnError,i=n===void 0?!0:n,r=s.resetOnComplete,o=r===void 0?!0:r,c=s.resetOnRefCountZero,a=c===void 0?!0:c;return function(l){var h,d,u,p=0,f=!1,m=!1,S=function(){d==null||d.unsubscribe(),d=void 0},v=function(){S(),h=u=void 0,f=m=!1},w=function(){var C=h;v(),C==null||C.unsubscribe()};return V(function(C,k){p++,!m&&!f&&S();var T=u=u??e();k.add(function(){p--,p===0&&!m&&!f&&(d=ee(w,a))}),T.subscribe(k),!h&&p>0&&(h=new Dt({next:function(I){return T.next(I)},error:function(I){m=!0,S(),d=ee(v,i,I),T.error(I)},complete:function(){f=!0,S(),d=ee(v,o),T.complete()}}),Q(C).subscribe(h))})(l)}}function ee(s,t){for(var e=[],n=2;n<arguments.length;n++)e[n-2]=arguments[n];if(t===!0){s();return}if(t!==!1){var i=new Dt({next:function(){i.unsubscribe(),s()}});return Q(t.apply(void 0,Ht([],Gt(e)))).subscribe(i)}}function Cs(s,t,e){var n,i=!1;return n=s,Es({connector:function(){return new Qn(n,t,e)},resetOnError:!0,resetOnComplete:!1,resetOnRefCountZero:i})}function $(s,t){return V(function(e,n){var i=null,r=0,o=!1,c=function(){return o&&!i&&n.complete()};e.subscribe(nt(n,function(a){i==null||i.unsubscribe();var l=0,h=r++;Q(s(a,h)).subscribe(i=nt(n,function(d){return n.next(t?t(a,d,h,l++):d)},function(){i=null,c()}))},function(){o=!0,c()}))})}class ks{constructor(t){this.canvas=t,this.scrollX=0,this.scrollY=0,this.scale=1.4,this.virtualWidth=2e4,this.virtualHeight=12e3,this.scrollbarWidth=6,this.viewChanges=new it,this.zoomListeners=[]}clampScroll(){const t=this.canvas.width-this.scrollbarWidth,e=this.canvas.height-this.scrollbarWidth,n=Math.max(0,this.virtualWidth*this.scale-t),i=Math.max(0,this.virtualHeight*this.scale-e);this.scrollX=Math.min(Math.max(0,this.scrollX),n),this.scrollY=Math.min(Math.max(0,this.scrollY),i)}zoomIn(t){const e=this.scale,n=t.width/2,i=t.height/2,r=(n+this.scrollX)/e,o=(i+this.scrollY)/e,c=3;this.scale=Math.min(e*1.15,c),this.scrollX=r*this.scale-n,this.scrollY=o*this.scale-i,this.clampScroll(),this.emitZoomChange()}zoomOut(t){const e=this.scale,n=t.width/2,i=t.height/2,r=(n+this.scrollX)/e,o=(i+this.scrollY)/e,c=Math.max((t.width-this.scrollbarWidth)/this.virtualWidth,(t.height-this.scrollbarWidth)/this.virtualHeight);this.scale=Math.max(e/1.15,c),this.scrollX=r*this.scale-n,this.scrollY=o*this.scale-i,this.clampScroll(),this.emitZoomChange()}center(t){this.scale=1,this.scrollX=(this.virtualWidth*this.scale-t.width)/2,this.scrollY=(this.virtualHeight*this.scale-t.height)/2,this.clampScroll(),this.emitZoomChange()}handleWheelEvent(t,e,n,i){if(t.ctrlKey||t.metaKey){const r=Math.pow(1.005,-t.deltaY),o=this.scale;let c=o*r;const a=e.width-this.scrollbarWidth,l=e.height-this.scrollbarWidth,h=Math.max(a/this.virtualWidth,l/this.virtualHeight);c=Math.min(Math.max(c,h),3);const u=(n+this.scrollX)/o,p=(i+this.scrollY)/o;this.scale=c,this.scrollX=u*c-n,this.scrollY=p*c-i}else this.scrollX+=t.deltaX,this.scrollY+=t.deltaY;this.clampScroll(),this.emitZoomChange()}onZoomChange(t){this.zoomListeners.push(t)}emitZoomChange(){this.zoomListeners.forEach(t=>t()),this.viewChanges.next({scrollX:this.scrollX,scrollY:this.scrollY,scale:this.scale})}setViewState(t){this.scrollX=t.scrollX,this.scrollY=t.scrollY,this.scale=t.scale,this.clampScroll(),this.emitZoomChange()}}class Is{constructor(t,e,n){this.canvas=t,this.ctx=e,this.panZoom=n}drawRoundedRect(t,e,n,i,r){const o=this.ctx;o.beginPath(),o.moveTo(t+r,e),o.lineTo(t+n-r,e),o.quadraticCurveTo(t+n,e,t+n,e+r),o.lineTo(t+n,e+i-r),o.quadraticCurveTo(t+n,e+i,t+n-r,e+i),o.lineTo(t+r,e+i),o.quadraticCurveTo(t,e+i,t,e+i-r),o.lineTo(t,e+r),o.quadraticCurveTo(t,e,t+r,e),o.closePath(),o.fill(),o.stroke()}drawScrollbars(){const{canvas:t,panZoom:e,ctx:n}=this,i=t.width-e.scrollbarWidth,r=t.height-e.scrollbarWidth,o=e.virtualWidth*e.scale,c=e.virtualHeight*e.scale;if(o>i){const a=i/o,l=i*a,h=e.scrollX/o*i,d=t.height-e.scrollbarWidth;n.fillStyle="#5D5D5D80",n.strokeStyle="#5D5D5D80",n.lineWidth=1,this.drawRoundedRect(h,d,l,e.scrollbarWidth,e.scrollbarWidth/2)}if(c>r){const a=r/c,l=r*a,h=e.scrollY/c*r,d=t.width-e.scrollbarWidth;n.fillStyle="#5D5D5D80",n.strokeStyle="#5D5D5D80",n.lineWidth=1,this.drawRoundedRect(d,h,e.scrollbarWidth,l,e.scrollbarWidth/2)}}hitTestScrollbars(t,e){const{canvas:n,panZoom:i}=this,r=n.width-i.scrollbarWidth,o=n.height-i.scrollbarWidth,c=i.virtualWidth*i.scale,a=i.virtualHeight*i.scale;if(c>r&&e>o){const l=r/c,h=r*l,d=i.scrollX/c*r;if(t>=d&&t<=d+h)return"horizontal"}if(a>o&&t>r){const l=o/a,h=o*l,d=i.scrollY/a*o;if(e>=d&&e<=d+h)return"vertical"}return null}}class Ts{constructor(t,e){this.ctx=t,this.panZoom=e}drawContent(){const t=this.ctx;t.strokeStyle="#ddd",t.lineWidth=1;const e=this.panZoom.virtualWidth,n=this.panZoom.virtualHeight;for(let i=0;i<e;i+=50)t.beginPath(),t.moveTo(i,0),t.lineTo(i,n),t.stroke();for(let i=0;i<n;i+=50)t.beginPath(),t.moveTo(0,i),t.lineTo(e,i),t.stroke()}}const N=[];for(let s=0;s<256;++s)N.push((s+256).toString(16).slice(1));function Ms(s,t=0){return(N[s[t+0]]+N[s[t+1]]+N[s[t+2]]+N[s[t+3]]+"-"+N[s[t+4]]+N[s[t+5]]+"-"+N[s[t+6]]+N[s[t+7]]+"-"+N[s[t+8]]+N[s[t+9]]+"-"+N[s[t+10]]+N[s[t+11]]+N[s[t+12]]+N[s[t+13]]+N[s[t+14]]+N[s[t+15]]).toLowerCase()}let ne;const Ps=new Uint8Array(16);function Ls(){if(!ne){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");ne=crypto.getRandomValues.bind(crypto)}return ne(Ps)}const Rs=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Oe={randomUUID:Rs};function pt(s,t,e){var i;if(Oe.randomUUID&&!s)return Oe.randomUUID();s=s||{};const n=s.random??((i=s.rng)==null?void 0:i.call(s))??Ls();if(n.length<16)throw new Error("Random bytes length must be >= 16");return n[6]=n[6]&15|64,n[8]=n[8]&63|128,Ms(n)}class As{constructor(t=0,e=0){this.selected=!1,this.isHovered=!1,this.zIndex=0,this.id=pt(),this.x=t,this.y=e}onDoubleClick(){}onRightClick(){}onDragStart(){}onDrag(t,e){}onDragEnd(){}}const st="#1890ff",Ds="rgba(24,144,255,0.1)",_s="rgba(24,144,255,0.5)",ze=st,Os="rgba(24,144,255,0.2)",le="Arial",zs=14,Ns=12;class Ct extends As{constructor({id:t,x:e=0,y:n=0,width:i,height:r,fillColor:o="#e6f7ff",lineWidth:c=2,title:a="",description:l="",dueDate:h,tags:d}){super(e,n),t&&(this.id=t),this.width=i,this.height=r,this.fillColor=o,this.lineWidth=c,this.title=a,this.description=l,this.dueDate=h,this.tags=d}getNearestPoint(t,e){const n=this.getConnectionPoints();let i=n[0],r=1/0;for(const o of n){const c=(o.x-t)**2+(o.y-e)**2;c<r&&(r=c,i=o)}return{x:i.x,y:i.y}}drawAnchors(t,e){if(this.selected||this.isHovered){const n=this.getConnectionPoints();for(const i of n)t.save(),t.setLineDash([]),t.beginPath(),t.arc(i.x,i.y,4/e.scale,0,2*Math.PI),t.fillStyle=i.isHovered?st:"#ffffff",t.strokeStyle="#000000",t.lineWidth=1/e.scale,t.fill(),t.stroke(),t.restore()}}drawConnectionLine(t,e,n){const i=this.getNearestPoint(n.x,n.y),r=n.getNearestPoint(this.x,this.y);t.save(),t.beginPath(),t.moveTo(i.x,i.y),t.lineTo(r.x,r.y),t.strokeStyle="#888",t.lineWidth=1/e.scale,t.stroke(),t.restore()}}function H(s){return s instanceof Ct}function he(s){return"id"in s&&"x"in s&&"y"in s&&"radius"in s&&"contains"in s}function Ys(s){return"id"in s&&"selected"in s&&"fromId"in s&&"toId"in s}const Zs="rgba(82,196,26,0.03)",wn="#73d13d",Xs="rgba(24,144,255,0.03)",xn="#1890ff",Us="rgba(255,165,0,0.03)",Bs="#faad14",$s="rgba(140,140,140,0.03)",Ws="#bfbfbf",Gs="#ffffff",Hs="#52c41a",js="#ffffff",Vs="#1890ff",Fs="#ffffff",qs="#faad14",Ks="#ffffff",Js="#808080",Qs="rgba(82,196,26,0.1)",ti=wn,ei="rgba(24,144,255,0.1)",ni=xn,si="rgba(255,165,0,0.1)",ii="#fa8c16",ri="rgba(169,169,169,0.1)",oi="#a9a9a9",ai={done:{fillColor:Gs,borderColor:Hs},"in-progress":{fillColor:js,borderColor:Vs},pending:{fillColor:Fs,borderColor:qs},defined:{fillColor:Ks,borderColor:Js}};var X=(s=>(s.Defined="defined",s.Pending="pending",s.InProgress="in-progress",s.Done="done",s))(X||{});const ci={defined:"Defined",pending:"Pending","in-progress":"In Progress",done:"Done"},li=["defined","pending","in-progress","done"],hi=li.map(s=>({value:s,label:ci[s]})),qt=new it;class ve{static wrapText(t,e,n,i=3){if(!e||!e.trim())return[];const r=e.split(" "),o=[];let c="";for(let a=0;a<r.length;a++){const l=r[a],h=c.length===0?l:c+" "+l;if(t.measureText(h).width<=n)c=h;else if(c.length>0&&o.push(c),t.measureText(l).width>n){let u="";for(let p=0;p<l.length;p++){const f=l[p],m=u+f;t.measureText(m).width<=n?u=m:(o.length<i&&o.push(u),u=f)}c=u}else c=l;if(o.length>=i)break}if(c.length>0&&o.length<i&&o.push(c),o.length>0&&o.length>=i&&r.length>o.length){const a="...";let h=o[o.length-1];for(;t.measureText(h+a).width>n&&h.length>0;)h=h.slice(0,-1);o[o.length-1]=h+a}return o}static drawTextLines(t,e,n,i,r){e.forEach((o,c)=>{t.fillText(o,n,i+c*r)})}static drawWrappedText(t,e,n,i,r,o=1.3,c=3,a=20,l="normal"){t.save(),t.font=`${l} ${a}px ${le}`;const h=this.wrapText(t,e,r,c);this.drawTextLines(t,h,n,i,a*o),t.restore()}static getWrappedTextHeight(t,e,n,i,r=3){return this.wrapText(t,e,n,r).length*i}}const D=class D extends Ct{constructor({id:t=pt(),x:e=0,y:n=0,title:i="New Task",description:r="",status:o=X.Defined,selected:c=!1,priority:a="medium",dueDate:l=new Date}){super({id:t,x:e,y:n,width:D.width,height:D.height,fillColor:"#ffffff",lineWidth:1,title:i,description:r}),this.status=X.Defined,this.zIndex=2,this.title=i,this.status=o,this.selected=c,this.priority=a,this.dueDate=l}draw(t,e){t.setLineDash([]);const n=this.x,i=this.y,r=D.width,o=D.height,c=ai[this.status],a=24;t.fillStyle=c.fillColor,t.beginPath(),t.roundRect(n,i,r,o,a),t.fill(),t.strokeStyle=this.selected?st:c.borderColor,t.lineWidth=2/e.scale,t.lineJoin="round",t.stroke(),t.fillStyle="#000000",t.font="bold 14px Arial";const l=r-48;ve.drawWrappedText(t,this.title,n+16,i+32,l,1.3,3,20),t.fillStyle=c.borderColor,t.beginPath(),t.arc(n+r-24,i+24,6,0,2*Math.PI),t.fill(),this.drawButton(t,e,n+r-32,i+10,"✏️"),this.drawButton(t,e,n+r-16,i+10,"🗑️");const u=this.getConnectionPoints(),p=this.hoveredPort;if(this.selected||this.isHovered||p)for(const f of u){const m=p?f.x===p.x&&f.y===p.y:!1;if(!(this.selected||this.isHovered)&&!m)continue;const S=(m?8:4)/e.scale;t.save(),t.beginPath(),t.arc(f.x,f.y,S,0,2*Math.PI),t.fillStyle=m?st:"#ffffff",t.fill(),t.strokeStyle="#000000",t.lineWidth=2,t.stroke(),t.restore()}}contains(t,e){return t>=this.x&&t<=this.x+D.width&&e>=this.y&&e<=this.y+D.height}isEditButtonClicked(t,e){const n=this.x+D.width-32,i=this.y+10,r=16;return t>=n&&t<=n+r&&e>=i&&e<=i+r}isDeleteButtonClicked(t,e){const n=this.x+D.width-16,i=this.y+10,r=16;return t>=n&&t<=n+r&&e>=i&&e<=i+r}drawButton(t,e,n,i,r){t.fillStyle="transparent",t.font="14px Arial",t.fillText(r,n,i+12)}onRightClick(){}onDragStart(){}onDrag(t,e){this.x=t,this.y=e}onDragEnd(){}getBoundaryPoint(t){const e=this.x+D.width/2,n=this.y+D.height/2;return{x:e+Math.cos(t)*(D.width/2),y:n+Math.sin(t)*(D.height/2)}}getConnectionPoints(){const t=D.width,e=D.height;return[{x:this.x+t/2,y:this.y,angle:-Math.PI/2,isHovered:!1,direction:"top"},{x:this.x+t,y:this.y+e/2,angle:0,isHovered:!1,direction:"right"},{x:this.x+t/2,y:this.y+e,angle:Math.PI/2,isHovered:!1,direction:"bottom"},{x:this.x,y:this.y+e/2,angle:Math.PI,isHovered:!1,direction:"left"}]}clone(){return new D({x:this.x,y:this.y,title:this.title,status:this.status,priority:this.priority,dueDate:this.dueDate})}onDoubleClick(){qt.next(this)}};D.width=272,D.height=112;let P=D;const Ne={done:{fillColor:Zs,borderColor:wn},"in-progress":{fillColor:Xs,borderColor:xn},pending:{fillColor:Us,borderColor:Bs},defined:{fillColor:$s,borderColor:Ws}},et=class et extends Ct{constructor({id:t=pt(),x:e=0,y:n=0,width:i=320,height:r=240,title:o="New Story",description:c="",status:a=X.Defined,priority:l="medium",tasks:h=[],selected:d=!1}){const u=Ne[a];super({id:t,x:e,y:n,width:i,height:r,fillColor:u.fillColor,lineWidth:2,title:o,description:c}),this.status=X.Defined,this.tasks=[],this.priority="medium",this.hoveredResizeHandle=null,this.zIndex=1,this.status=a,this.priority=l,this.tasks=h,this.selected=d}draw(t,e){const n=Ne[this.status];t.fillStyle=n.fillColor,t.beginPath(),t.roundRect(this.x,this.y,this.width,this.height,8*e.scale),t.fill();const i=6/e.scale,r=2/e.scale;t.setLineDash(this.selected?[]:[i,r]),t.strokeStyle=this.selected?st:n.borderColor,t.lineWidth=this.lineWidth/e.scale,t.stroke(),t.fillStyle="#000000",t.font=`bold ${zs}px ${le}`;const o=this.width-90;ve.drawWrappedText(t,this.title,this.x+16,this.y+32,o,1.3,3,24),super.drawAnchors(t,e),(this.selected||this.isHovered)&&this.getResizeHandles(e).forEach(l=>{const h=this.hoveredResizeHandle===l.direction,d=et.HANDLE_SIZE/e.scale;t.beginPath(),t.arc(l.x,l.y,d,0,2*Math.PI),t.fillStyle=h?"#00A8FF":st,t.fill()})}drawButton(t,e,n,i,r,o){const c=22/e.scale;o!=="transparent"&&(t.fillStyle=o,t.beginPath(),t.roundRect(n,i,c,c,4/e.scale),t.fill()),t.fillStyle="#666666",t.font=`${Ns/e.scale}px ${le}`,t.fillText(r,n+3/e.scale,i+16/e.scale)}contains(t,e){return t>=this.x&&t<=this.x+this.width&&e>=this.y&&e<=this.y+this.height}isEditButtonClicked(t,e){const i=this.x+this.width-80,r=this.y+6;return t>=i&&t<=i+22&&e>=r&&e<=r+22}isDeleteButtonClicked(t,e){const i=this.x+this.width-50,r=this.y+6;return t>=i&&t<=i+22&&e>=r&&e<=r+22}isAddButtonClicked(t,e){const i=this.x+this.width-20,r=this.y+6;return t>=i&&t<=i+22&&e>=r&&e<=r+22}addTask(t){this.tasks.find(e=>e.id===t.id)||this.tasks.push(t)}removeTask(t){this.tasks=this.tasks.filter(e=>e.id!==t)}getBoundaryPoint(t){return{x:this.x+this.width/2,y:this.y+this.height/2}}getConnectionPoints(){const t=[],e=this.width,n=this.height;return t.push({x:this.x+e/2,y:this.y,angle:-Math.PI/2,isHovered:!1,direction:"top"}),t.push({x:this.x+e,y:this.y+n/2,angle:0,isHovered:!1,direction:"right"}),t.push({x:this.x+e/2,y:this.y+n,angle:Math.PI/2,isHovered:!1,direction:"bottom"}),t.push({x:this.x,y:this.y+n/2,angle:Math.PI,isHovered:!1,direction:"left"}),t}onDrag(t,e){const n=t-this.x,i=e-this.y;this.x=t,this.y=e,this.tasks.forEach(r=>{r.x+=n,r.y+=i}),this.hoveredResizeHandle=null}getResizeHandles(t){return[{x:this.x+this.width-1,y:this.y+this.height-1,direction:"se"}]}getResizeHandleDirectionAt(t,e,n){const i=et.HANDLE_SIZE/n.scale,o=this.getResizeHandles(n)[0],c=t-o.x,a=e-o.y;return Math.sqrt(c*c+a*a)<=i?o.direction:null}onDoubleClick(){qt.next(this)}clone(){return new et({x:this.x,y:this.y,width:this.width,height:this.height,title:this.title,description:this.description,status:this.status,priority:this.priority,tasks:[]})}};et.width=320,et.height=240,et.HANDLE_SIZE=8;let O=et;class di{constructor(){this.undoStack=[],this.redoStack=[],this.changes=new it}execute(t){t.execute(),this.undoStack.push(t),this.redoStack=[],this.changes.next()}undo(){const t=this.undoStack.pop();t&&(t.undo(),this.redoStack.push(t),this.changes.next())}redo(){const t=this.redoStack.pop();t&&(t.execute(),this.undoStack.push(t),this.changes.next())}canUndo(){return this.undoStack.length>0}canRedo(){return this.redoStack.length>0}}const M=new di;class F{}class Ye extends F{constructor(t,e,n){super(),this.scene=t,this.initialPositions=new Map(e),this.finalPositions=new Map(n)}execute(){this.applyPositions(this.finalPositions),this.scene.changes.next()}undo(){this.applyPositions(this.initialPositions),this.scene.changes.next()}applyPositions(t){t.forEach((e,n)=>{const i=this.scene.getElements().find(r=>r.id===n);i&&(i.x=e.x,i.y=e.y)})}}class ui extends F{constructor(t,e,n){super(),this.scene=t,this.initial=new Map(e),this.final=new Map(n)}execute(){this.apply(this.final),this.scene.changes.next()}undo(){this.apply(this.initial),this.scene.changes.next()}apply(t){t.forEach((e,n)=>{const i=this.scene.getElements().find(r=>r.id===n);i&&(i.x=e.x,i.y=e.y,i.width=e.width,i.height=e.height)})}}class se{static getDragGroup(t){const e=new Set(t);return t.filter(n=>n instanceof O).forEach(n=>{n.tasks.forEach(i=>e.add(i))}),Array.from(e)}}function Ze(s){const t=s.getShapes(),e=s.getElements().filter(H);return[...t,...e].sort((i,r)=>(i.zIndex??0)-(r.zIndex??0))}var wt=(s=>(s.Straight="straight",s.SShaped="s-shaped",s))(wt||{});class Sn{constructor(t,e,n=pt(),i){this.selected=!1,this.lineType=wt.SShaped,this.zIndex=1,this.tangentAngle=0,this.fromId=t,this.toId=e,this.id=n,i&&(this.lineType=i)}getClosestConnectionPoints(t,e){const n=t.getConnectionPoints(),i=e.getConnectionPoints();let r=1/0,o=n[0],c=i[0];for(const a of n)for(const l of i){const h=Math.sqrt((a.x-l.x)**2+(a.y-l.y)**2);h<r&&(r=h,o=a,c=l)}return{start:o,end:c}}setStrokeProperties(t,e){t.setLineDash([]),t.strokeStyle=this.selected?"#008dff":"#000",t.lineWidth=2}drawLine(t,e,n,i){const{start:r,end:o}=this.getClosestConnectionPoints(e,n);if(t.beginPath(),t.moveTo(r.x,r.y),this.lineType===wt.Straight)t.lineTo(o.x,o.y),this.tangentAngle=Math.atan2(o.y-r.y,o.x-r.x);else if(this.lineType===wt.SShaped){const c=o.x-r.x,a=o.y-r.y,h=Math.sqrt(c*c+a*a)/1.4,d=this.getControlPoint(r,h),u=this.getControlPoint(o,h);t.bezierCurveTo(d.x,d.y,u.x,u.y,o.x,o.y),this.tangentAngle=Math.atan2(o.y-u.y,o.x-u.x)}this.setStrokeProperties(t,i),t.stroke()}getControlPoint(t,e){switch(t.direction){case"left":return{x:t.x-e,y:t.y};case"right":return{x:t.x+e,y:t.y};case"top":return{x:t.x,y:t.y-e};case"bottom":return{x:t.x,y:t.y+e};default:return{x:t.x,y:t.y}}}drawArrowHead(t,e,n,i){const{end:r}=this.getClosestConnectionPoints(e,n),o=this.tangentAngle,c=15;t.beginPath(),t.moveTo(r.x,r.y),t.lineTo(r.x-c*Math.cos(o-Math.PI/6),r.y-c*Math.sin(o-Math.PI/6)),t.lineTo(r.x-c*Math.cos(o+Math.PI/6),r.y-c*Math.sin(o+Math.PI/6)),t.closePath(),t.fillStyle=this.selected?"#008dff":"#000",t.fill()}draw(t,e,n=[]){const i=n.find(o=>o.id===this.fromId),r=n.find(o=>o.id===this.toId);i&&r&&(this.drawLine(t,i,r,e),this.drawArrowHead(t,i,r,e))}distanceToLineSegment(t,e,n,i,r,o){const c=r-n,a=o-i,l=c*c+a*a;if(l===0)return Math.sqrt((t-n)**2+(e-i)**2);const h=Math.max(0,Math.min(1,((t-n)*c+(e-i)*a)/l)),d=n+h*c,u=i+h*a;return Math.sqrt((t-d)**2+(e-u)**2)}isNearPoint(t,e,n,i=5){const r=n.find(l=>l.id===this.fromId),o=n.find(l=>l.id===this.toId);if(!r||!o)return!1;const{start:c,end:a}=this.getClosestConnectionPoints(r,o);if(this.lineType===wt.Straight)return this.distanceToLineSegment(t,e,c.x,c.y,a.x,a.y)<=i;if(this.lineType===wt.SShaped){const l=a.x-c.x,h=a.y-c.y,u=Math.sqrt(l*l+h*h)/1.4,p=this.getControlPoint(c,u),f=this.getControlPoint(a,u),m=20,S=[];for(let w=0;w<=m;w++){const C=w/m,k=1-C,T=k*k*k*c.x+3*k*k*C*p.x+3*k*C*C*f.x+C*C*C*a.x,I=k*k*k*c.y+3*k*k*C*p.y+3*k*C*C*f.y+C*C*C*a.y;S.push({x:T,y:I})}let v=1/0;for(let w=0;w<S.length-1;w++){const C=S[w],k=S[w+1],T=this.distanceToLineSegment(t,e,C.x,C.y,k.x,k.y);T<v&&(v=T)}return v<=i}return!1}setLineType(t){this.lineType=t}}class pi extends F{constructor(t,e,n){super(),this.scene=t,this.fromId=e,this.toId=n,this.connection=new Sn(e,n)}execute(){this.scene.addElement(this.connection)}undo(){this.scene.removeElement(this.connection)}}class fi{constructor(t,e){this.scene=t,this.panZoom=e,this.creating=!1,this.startShape=null,this.startPoint=null,this.tempLine=null}hitTest(t,e){const n=this.scene.getElements().filter(H),i=[...this.scene.getShapes(),...n],r=this.scene.getConnections();for(let o=r.length-1;o>=0;o--){const c=r[o],a=5/this.panZoom.scale;if(c.isNearPoint(t,e,i,a))return c}return null}start(t,e){const n=Ze(this.scene),i=this.findPoint(t,e,n);return i?(this.creating=!0,this.startShape=i.shape,this.startPoint=i.point,this.tempLine={startX:i.point.x,startY:i.point.y,endX:t,endY:e},this.scene.changes.next(),!0):!1}update(t,e){return!this.creating||!this.tempLine?!1:(this.tempLine.endX=t,this.tempLine.endY=e,this.scene.changes.next(),!0)}finish(){var r;if(!this.creating||!this.startShape||!this.tempLine)return!1;let t=null;const e=Ze(this.scene),n=this.tempLine.endX,i=this.tempLine.endY;if(t=((r=this.findPoint(n,i,e))==null?void 0:r.shape)||null,!t)for(let o=e.length-1;o>=0;o--){const c=e[o];if(c!==this.startShape&&c.contains(n,i)){t=c;break}}if(t){const o=this.startShape,c=t;o===c||o instanceof O&&c instanceof P&&o.tasks.some(l=>l.id===c.id)||o instanceof P&&c instanceof O&&c.tasks.some(l=>l.id===o.id)||M.execute(new pi(this.scene,o.id,c.id))}return this.creating=!1,this.startShape=null,this.startPoint=null,this.tempLine=null,this.scene.changes.next(),!0}isCreating(){return this.creating}cancel(){this.creating=!1,this.startShape=null,this.startPoint=null,this.tempLine=null,this.scene.changes.next()}getTemporaryLine(){return this.tempLine}findPoint(t,e,n){for(let i=n.length-1;i>=0;i--){const r=n[i],o=r.getConnectionPoints();for(const c of o){const a=t-c.x,l=e-c.y;if(Math.sqrt(a*a+l*l)<8/this.panZoom.scale)return{shape:r,point:c}}}return null}}function En(s){const t=s.map(n=>n.x),e=s.map(n=>n.y);return{minX:Math.min(...t),minY:Math.min(...e),maxX:Math.max(...t),maxY:Math.max(...e)}}class mi{constructor(t,e,n){this.canvas=t,this.scene=e,this.panZoom=n,this.draggingItem=null,this.dragOffsetX=0,this.dragOffsetY=0,this.initialPositions=new Map,this.hoveredConnectionPoint=null,this.resizingElement=null,this.resizeDirection=null,this.resizeStartX=0,this.resizeStartY=0,this.initialX=0,this.initialY=0,this.initialWidth=0,this.initialHeight=0,this.isRegionSelecting=!1,this.regionStartX=0,this.regionStartY=0,this.regionCurrentX=0,this.regionCurrentY=0,this.draggingGroup=null,this.groupDragStartX=0,this.groupDragStartY=0,this.connectionService=new fi(this.scene,this.panZoom)}getTempConnectionLine(){return this.connectionService.getTemporaryLine()}cancelConnectionCreation(){this.connectionService.cancel(),this.scene.changes.next()}getRegionRect(){if(!this.isRegionSelecting)return null;const t=Math.min(this.regionStartX,this.regionCurrentX),e=Math.min(this.regionStartY,this.regionCurrentY),n=Math.abs(this.regionCurrentX-this.regionStartX),i=Math.abs(this.regionCurrentY-this.regionStartY);return{x:t,y:e,width:n,height:i}}findConnectionPointAt(t,e,n){for(let i=n.length-1;i>=0;i--){const r=n[i],o=r.getConnectionPoints();for(const c of o)if(Math.sqrt((t-c.x)**2+(e-c.y)**2)<8/this.panZoom.scale)return{shape:r,point:c}}return null}updateSelectionOnClick(t,e){const n=this.scene.getSelectedElements();t?e?n.indexOf(t)===-1&&this.scene.setSelected([...n,t]):n.length>1&&n.indexOf(t)!==-1||this.scene.setSelected([t]):this.scene.setSelected([])}handleMouseDown(t,e,n){if(t.button!==0)return!1;const i=this.scene.getShapes(),r=this.scene.getElements().filter(H);let o=null;const c=r.filter(d=>d instanceof O);for(let d=c.length-1;d>=0;d--){const u=c[d],p=u.getResizeHandleDirectionAt(e,n,this.panZoom);if(p)return this.resizingElement=u,this.resizeDirection=p,this.resizeStartX=e,this.resizeStartY=n,this.initialX=u.x,this.initialY=u.y,this.initialWidth=u.width,this.initialHeight=u.height,this.updateSelectionOnClick(u,t.shiftKey),!0}const a=r.filter(d=>d instanceof P);for(let d=a.length-1;d>=0;d--)if(a[d].contains(e,n)){o=a[d];break}if(!o){const d=r.filter(u=>u instanceof O);for(let u=d.length-1;u>=0;u--)if(d[u].contains(e,n)){o=d[u];break}}if(!o)for(let d=r.length-1;d>=0;d--){const u=r[d];if(!(u instanceof P)&&!(u instanceof O)&&u.contains(e,n)){o=u;break}}if(!o)for(let d=i.length-1;d>=0;d--){const u=i[d];if(u.contains(e,n)){o=u;break}}const l=this.connectionService.hitTest(e,n);if(l)return this.updateSelectionOnClick(l,t.shiftKey),!0;if(this.connectionService.start(e,n))return!0;if(o){this.updateSelectionOnClick(o,t.shiftKey);const d=this.scene.getSelectedElements(),u=se.getDragGroup(d);return this.initialPositions.clear(),u.forEach(p=>this.initialPositions.set(p.id,{x:p.x,y:p.y})),this.draggingItem=o,this.dragOffsetX=e-o.x,this.dragOffsetY=n-o.y,o.onDragStart&&o.onDragStart(),!0}const h=this.scene.getSelectedElements();if(h.length>1){const d=[];h.forEach(S=>{const v=S;v.width!==void 0&&v.height!==void 0?d.push({x:v.x,y:v.y},{x:v.x+v.width,y:v.y+v.height}):v.radius!==void 0?d.push({x:v.x-v.radius,y:v.y-v.radius},{x:v.x+v.radius,y:v.y+v.radius}):d.push({x:v.x,y:v.y})});const{minX:u,minY:p,maxX:f,maxY:m}=En(d);if(e>=u&&e<=f&&n>=p&&n<=m)return this.draggingGroup=se.getDragGroup(h),this.initialPositions.clear(),this.draggingGroup.forEach(S=>this.initialPositions.set(S.id,{x:S.x,y:S.y})),this.groupDragStartX=e,this.groupDragStartY=n,!0}return!i.some(d=>d.contains(e,n))&&!r.some(d=>d.contains(e,n))?(this.isRegionSelecting=!0,this.regionStartX=e,this.regionStartY=n,this.regionCurrentX=e,this.regionCurrentY=n,this.updateSelectionOnClick(null,!1),!0):(this.updateSelectionOnClick(null,!1),!1)}handleMouseMove(t,e){const n=this.scene.getShapes(),i=this.scene.getElements().filter(H);let r;if(this.connectionService.isCreating()){const h=i.filter(u=>u instanceof P),d=i.filter(u=>!(u instanceof P));r=[...n,...d,...h]}else r=[...n,...i];let o=null;r.forEach(h=>h.isHovered=!1);for(let h=r.length-1;h>=0;h--){const d=r[h];if(d.contains(t,e)){o=d;break}}o&&(o.isHovered=!0),r.forEach(h=>delete h.hoveredPort);const c=this.findConnectionPointAt(t,e,r);if(c?(this.hoveredConnectionPoint=c.point,c.shape.hoveredPort=c.point):this.hoveredConnectionPoint=null,this.connectionService.isCreating()){this.connectionService.update(t,e);return}const a=i.filter(h=>h instanceof O);let l=!1;for(const h of a)if(h.selected){const d=h.getResizeHandleDirectionAt(t,e,this.panZoom);if(h.hoveredResizeHandle=d,d){l=!0;break}}if(!this.resizingElement)if(l){const h=a.find(d=>d.hoveredResizeHandle);h&&(this.canvas.style.cursor=`${h.hoveredResizeHandle}-resize`)}else this.canvas.style.cursor="default";if(this.draggingGroup){const h=t-this.groupDragStartX,d=e-this.groupDragStartY;this.draggingGroup.forEach(u=>{const p=this.initialPositions.get(u.id);if(p){const f=u;f.x=p.x+h,f.y=p.y+d}}),this.scene.changes.next();return}if(this.isRegionSelecting){this.regionCurrentX=t,this.regionCurrentY=e;const h=Math.min(this.regionStartX,this.regionCurrentX),d=Math.min(this.regionStartY,this.regionCurrentY),u=Math.abs(this.regionCurrentX-this.regionStartX),p=Math.abs(this.regionCurrentY-this.regionStartY),f=this.scene.getShapes(),m=this.scene.getElements().filter(H),v=[...f,...m].filter(w=>{let C,k,T,I;return he(w)?(C=w.x-w.radius,k=w.y-w.radius,T=w.x+w.radius,I=w.y+w.radius):(C=w.x,k=w.y,T=w.x+w.width,I=w.y+w.height),T>=h&&C<=h+u&&I>=d&&k<=d+p});this.scene.setSelected(v),this.scene.changes.next();return}if(this.draggingItem){const h=this.initialPositions.get(this.draggingItem.id);if(h){const d=t-(h.x+this.dragOffsetX),u=e-(h.y+this.dragOffsetY),p=this.scene.getSelectedElements();se.getDragGroup(p).forEach(m=>{const S=this.initialPositions.get(m.id);if(S){const v=S.x+d,w=S.y+u;m.x=v,m.y=w,m.onDrag&&m.onDrag(v,w)}}),this.scene.changes.next()}return}if(this.resizingElement&&this.resizeDirection){const h=t-this.resizeStartX,d=e-this.resizeStartY;let u=this.initialX,p=this.initialY,f=this.initialWidth,m=this.initialHeight;switch(this.resizeDirection){case"se":f+=h,m+=d;break;case"ne":f+=h,m-=d,p+=d;break;case"sw":f-=h,m+=d,u+=h;break;case"nw":f-=h,m-=d,u+=h,p+=d;break}f=Math.max(f,1),m=Math.max(m,1),this.resizingElement.x=u,this.resizingElement.y=p,this.resizingElement.width=f,this.resizingElement.height=m,this.scene.changes.next();return}}handleMouseUp(){if(this.connectionService.isCreating()){this.connectionService.finish();return}if(this.isRegionSelecting){const t=Math.min(this.regionStartX,this.regionCurrentX),e=Math.min(this.regionStartY,this.regionCurrentY),n=Math.abs(this.regionCurrentX-this.regionStartX),i=Math.abs(this.regionCurrentY-this.regionStartY),r=this.scene.getShapes(),o=this.scene.getElements().filter(H),a=[...r,...o].filter(l=>{let h,d,u,p;return he(l)?(h=l.x-l.radius,d=l.y-l.radius,u=l.x+l.radius,p=l.y+l.radius):(h=l.x,d=l.y,u=l.x+l.width,p=l.y+l.height),u>=t&&h<=t+n&&p>=e&&d<=e+i});this.scene.setSelected(a),this.isRegionSelecting=!1,this.scene.changes.next();return}if(this.draggingGroup){const t=new Map(this.initialPositions),e=new Map;this.draggingGroup.forEach(n=>{const i=n;e.set(n.id,{x:i.x,y:i.y})}),M.execute(new Ye(this.scene,t,e)),this.initialPositions.clear(),this.draggingGroup=null,this.scene.changes.next();return}if(this.draggingItem){if(this.draggingItem instanceof P){const n=this.scene.getSelectedElements().filter(r=>r instanceof P);this.scene.getElements().filter(H).filter(r=>r instanceof O).forEach(r=>{n.forEach(o=>{r.contains(o.x,o.y)?r.addTask(o):r.removeTask(o.id)})})}this.draggingItem.onDragEnd&&this.draggingItem.onDragEnd();const t=new Map(this.initialPositions);if(t.size>0){const e=new Map;t.forEach((n,i)=>{const r=this.scene.getElements().find(o=>o.id===i);r&&e.set(i,{x:r.x,y:r.y})}),M.execute(new Ye(this.scene,t,e))}this.initialPositions.clear(),this.draggingItem=null,this.scene.changes.next()}if(this.resizingElement){const t=this.resizingElement,e=new Map;e.set(t.id,{x:this.initialX,y:this.initialY,width:this.initialWidth,height:this.initialHeight});const n=new Map;n.set(t.id,{x:t.x,y:t.y,width:t.width,height:t.height}),M.execute(new ui(this.scene,e,n)),this.resizingElement=null,this.resizeDirection=null,this.canvas.style.cursor="default",this.scene.getElements().filter(H).filter(i=>i instanceof O).forEach(i=>i.hoveredResizeHandle=null),this.scene.changes.next();return}}handleDoubleClick(t,e){const n=this.scene.getShapes();for(let r=n.length-1;r>=0;r--){const o=n[r];if(o.contains(t,e)&&o.onDoubleClick){o.onDoubleClick();break}}const i=[...this.scene.getElements().filter(H)];i.sort((r,o)=>(o.zIndex??0)-(r.zIndex??0));for(const r of i)if(r.contains(t,e)&&r.onDoubleClick){r.onDoubleClick();break}}handleRightClick(t,e,n){t.preventDefault();const i=this.scene.getShapes();for(let r=i.length-1;r>=0;r--){const o=i[r];if(o.contains(e,n)&&o.onRightClick){o.onRightClick();break}}}get isCreatingConnection(){return this.connectionService.isCreating()}get isDraggingTask(){return this.draggingItem instanceof P}}class gi{constructor(){this.openCount=0}register(){this.openCount+=1}unregister(){this.openCount=Math.max(0,this.openCount-1)}isOpen(){return this.openCount>0}}const jt=new gi;class bi{constructor(t,e){this.scene=t,this.canvasManager=e,this.clipboard=[],document.addEventListener("keydown",this.onKeyDown.bind(this))}getCanvasCenter(){const t=this.canvasManager.getCanvas(),e=t.width,n=t.height,i=this.canvasManager.getPanZoomManager(),r=(e/2+i.scrollX)/i.scale,o=(n/2+i.scrollY)/i.scale;return{x:r,y:o}}onKeyDown(t){if(jt.isOpen()||document.querySelector('[role="dialog"]'))return;const e=t.target;if(!(e.tagName==="INPUT"||e.tagName==="TEXTAREA"||e.tagName==="SELECT"||e.isContentEditable)){if(console.log({key:t.key}),t.key==="Escape"){this.canvasManager.getInteractionManager().cancelConnectionCreation();return}if((t.ctrlKey||t.metaKey)&&t.key.toLowerCase()==="c"){const n=this.scene.getSelectedShapes();n.length>0&&(this.clipboard=n.map(i=>i.clone()),console.log(`Copied ${this.clipboard.length} shapes to clipboard`)),t.preventDefault()}if((t.ctrlKey||t.metaKey)&&t.key.toLowerCase()==="v"){if(this.clipboard.length>0){let n=this.canvasManager.getLastMouseCoords();n||(n=this.getCanvasCenter(),console.log(`Mouse coordinates not available, pasting at canvas center (${n.x}, ${n.y})`)),this.scene.getShapes().forEach(i=>i.selected=!1),this.clipboard.forEach(i=>{const r=i.clone();r.x=n.x+(r.x-i.x),r.y=n.y+(r.y-i.y),r.selected=!0,this.scene.addElement(r)}),console.log(`Pasted ${this.clipboard.length} shapes at (${n.x}, ${n.y})`)}t.preventDefault()}if((t.ctrlKey||t.metaKey)&&t.key.toLowerCase()==="a"){const n=this.scene.getElements();this.scene.setSelected(n),t.preventDefault()}if(t.key==="Backspace"){t.preventDefault(),t.stopPropagation();const n=[...this.scene.getSelectedElements()];this.scene.removeElements(n)}}}}const Xe={done:{fillColor:Qs,borderColor:ti},"in-progress":{fillColor:ei,borderColor:ni},pending:{fillColor:si,borderColor:ii},defined:{fillColor:ri,borderColor:oi}},G=class G extends Ct{constructor({id:t=pt(),x:e=0,y:n=0,title:i="New Goal",status:r=X.Defined,priority:o="medium",selected:c=!1,description:a=""}){super({id:t,x:e,y:n,width:G.width,height:G.height,fillColor:Xe[r].fillColor,lineWidth:2,title:i}),this.links=[],this.progress=0,this.status=X.Defined,this.priority="medium",this.zIndex=3,this.status=r,this.priority=o,this.selected=c,this.description=a}draw(t,e){const{x:n,y:i,width:r,height:o,title:c,progress:a}=this,l=Xe[this.status],h=n+r/2,d=i+o/2,u=r/2;t.fillStyle=l.fillColor,t.beginPath(),t.arc(h,d,u,0,Math.PI*2),t.fill();const p=12,m=u+8+p/2;t.beginPath(),t.strokeStyle="rgba(224,224,224,0.5)",t.lineWidth=p,t.arc(h,d,m,0,Math.PI*2),t.stroke(),t.beginPath(),t.strokeStyle=l.borderColor,t.lineWidth=p,t.arc(h,d,m,-Math.PI/2,-Math.PI/2+Math.PI*2*a),t.stroke(),t.strokeStyle=this.selected?st:l.borderColor,t.lineWidth=this.lineWidth/e.scale,t.beginPath(),t.arc(h,d,u,0,Math.PI*2),t.stroke(),t.fillStyle="#000000";const S=26,v=1.3,w=r*.8;ve.drawWrappedText(t,c,h-w/2,d-S,w,v,3,S),super.drawAnchors(t,e)}contains(t,e){const n=this.x+this.width/2,i=this.y+this.height/2,a=this.width/2+8+12,l=t-n,h=e-i;return l*l+h*h<=a*a}getBoundaryPoint(t){const e=this.width/2;return{x:this.x+this.width/2+Math.cos(t)*e,y:this.y+this.height/2+Math.sin(t)*e}}getConnectionPoints(){const t=this.width,e=this.height;return[{x:this.x+t/2,y:this.y,angle:-Math.PI/2,isHovered:!1,direction:"top"},{x:this.x+t,y:this.y+e/2,angle:0,isHovered:!1,direction:"right"},{x:this.x+t/2,y:this.y+e,angle:Math.PI/2,isHovered:!1,direction:"bottom"},{x:this.x,y:this.y+e/2,angle:Math.PI,isHovered:!1,direction:"left"}]}clone(){const t=new G({x:this.x,y:this.y,title:this.title,status:this.status,priority:this.priority});return t.progress=this.progress,t.links=[...this.links],t}onDoubleClick(){qt.next(this)}};G.diameter=320,G.width=G.diameter,G.height=G.diameter;let ft=G;class vi{constructor(t,e){this.draggingScrollbar=null,this.dragStartX=0,this.dragStartY=0,this.dragStartScrollX=0,this.dragStartScrollY=0,this.lastMouseCoords=null,this.activePointers=new Map,this.pinchInitialDist=null,this.pinchInitialRect=null,this.pinchCenter=null,this.pinchElement=null,this.pinchZoomInitialDist=null,this.pinchZoomInitialScale=1,this.pinchZoomCenterScene=null,this.gestureInitialScale=1,this.canvas=t,this.canvas.style.touchAction="none",this.canvas.style.userSelect="none",this.scene=e;const n=t.getContext("2d");if(!n)throw new Error("Canvas 2D context not available");this.ctx=n,this.panZoom=new ks(t),this.renderer=new Ts(this.ctx,this.panZoom),this.scrollbarManager=new Is(t,this.ctx,this.panZoom),this.interactionManager=new mi(t,e,this.panZoom),this.keyboardManager=new bi(e,this),this.scene.changes.subscribe(()=>this.draw()),this.canvas.addEventListener("wheel",this.onWheel.bind(this)),window.addEventListener("resize",this.onResize.bind(this)),this.canvas.addEventListener("mousedown",this.onMouseDown.bind(this)),this.canvas.addEventListener("mousemove",this.onMouseMove.bind(this)),this.canvas.addEventListener("mouseup",this.onMouseUp.bind(this)),this.canvas.addEventListener("dblclick",this.onDoubleClick.bind(this)),this.canvas.addEventListener("contextmenu",this.onRightClick.bind(this)),this.canvas.addEventListener("pointerdown",this.onPointerDown.bind(this)),this.canvas.addEventListener("pointermove",this.onPointerMove.bind(this)),this.canvas.addEventListener("pointerup",this.onPointerUp.bind(this)),this.canvas.addEventListener("pointercancel",this.onPointerUp.bind(this)),this.canvas.addEventListener("gesturestart",this.onGestureStart.bind(this)),this.canvas.addEventListener("gesturechange",this.onGestureChange.bind(this)),this.canvas.addEventListener("gestureend",this.onGestureEnd.bind(this)),this.resizeCanvas()}init(){this.draw()}resizeCanvas(){this.canvas.width=window.innerWidth-2,this.canvas.height=window.innerHeight-2,this.draw()}onResize(){this.resizeCanvas()}draw(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.save(),this.ctx.translate(-this.panZoom.scrollX,-this.panZoom.scrollY),this.ctx.scale(this.panZoom.scale,this.panZoom.scale),this.renderer.drawContent();const t=this.scene.getElements(),e=this.scene.getShapes(),n=t.filter(H),i=[...e,...n],r=this.scene.getConnections();if(n.filter(l=>l instanceof ft).forEach(l=>{const h=r.filter(p=>p.fromId===l.id||p.toId===l.id).map(p=>p.fromId===l.id?p.toId:p.fromId);l.links=Array.from(new Set(h));const u=n.filter(p=>p instanceof P).filter(p=>l.links.indexOf(p.id)!==-1);l.progress=u.length?u.filter(p=>p.status==="done").length/u.length:0}),e.forEach(l=>l.draw(this.ctx,this.panZoom)),n.sort((l,h)=>l.zIndex-h.zIndex).forEach(l=>l.draw(this.ctx,this.panZoom)),this.interactionManager.isCreatingConnection){const l=4/this.panZoom.scale;i.forEach(h=>{h.isHovered&&(this.ctx.save(),this.ctx.fillStyle=Ds,this.ctx.strokeStyle=_s,this.ctx.lineWidth=2/this.panZoom.scale,"radius"in h?(this.ctx.beginPath(),this.ctx.arc(h.x,h.y,h.radius+l,0,2*Math.PI)):(this.ctx.beginPath(),this.ctx.roundRect(h.x-l,h.y-l,h.width+l*2,h.height+l*2,6/this.panZoom.scale)),this.ctx.fill(),this.ctx.stroke(),this.ctx.restore())})}this.scene.getConnections().forEach(l=>{l.draw(this.ctx,this.panZoom,i)});const o=this.interactionManager.getTempConnectionLine();o&&(this.ctx.save(),this.ctx.beginPath(),this.ctx.moveTo(o.startX,o.startY),this.ctx.lineTo(o.endX,o.endY),this.ctx.strokeStyle="#000000",this.ctx.lineWidth=2,this.ctx.setLineDash([5,5]),this.ctx.globalAlpha=.5,this.ctx.stroke(),this.ctx.restore(),this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(o.endX,o.endY,8,0,2*Math.PI),this.ctx.fillStyle=st,this.ctx.fill(),this.ctx.strokeStyle="#000000",this.ctx.lineWidth=1,this.ctx.stroke(),this.ctx.restore());const c=this.scene.getSelectedElements();if(c.length>1){const l=[];c.forEach(f=>{f.width!==void 0&&f.height!==void 0?l.push({x:f.x,y:f.y},{x:f.x+f.width,y:f.y},{x:f.x,y:f.y+f.height},{x:f.x+f.width,y:f.y+f.height}):f.radius!==void 0?l.push({x:f.x-f.radius,y:f.y-f.radius},{x:f.x+f.radius,y:f.y+f.radius}):l.push({x:f.x,y:f.y})});const{minX:h,minY:d,maxX:u,maxY:p}=En(l);this.ctx.save(),this.ctx.setLineDash([]),this.ctx.strokeStyle=ze,this.ctx.strokeRect(h,d,u-h,p-d),this.ctx.restore()}const a=this.interactionManager.getRegionRect();a&&(this.ctx.save(),this.ctx.fillStyle=Os,this.ctx.fillRect(a.x,a.y,a.width,a.height),this.ctx.strokeStyle=ze,this.ctx.setLineDash([]),this.ctx.strokeRect(a.x,a.y,a.width,a.height),this.ctx.restore()),this.ctx.restore(),this.scrollbarManager.drawScrollbars()}getSceneCoords(t){const e=this.canvas.getBoundingClientRect(),n=t.clientX-e.left,i=t.clientY-e.top,r=(n+this.panZoom.scrollX)/this.panZoom.scale,o=(i+this.panZoom.scrollY)/this.panZoom.scale;return{sceneX:r,sceneY:o}}getLastMouseCoords(){return this.lastMouseCoords}onMouseDown(t){const{sceneX:e,sceneY:n}=this.getSceneCoords(t);this.lastMouseCoords={x:e,y:n};const i=this.canvas.getBoundingClientRect(),r=t.clientX-i.left,o=t.clientY-i.top,c=this.scrollbarManager.hitTestScrollbars(r,o);if(c==="horizontal"){this.draggingScrollbar="horizontal",this.dragStartX=r,this.dragStartScrollX=this.panZoom.scrollX;return}else if(c==="vertical"){this.draggingScrollbar="vertical",this.dragStartY=o,this.dragStartScrollY=this.panZoom.scrollY;return}this.interactionManager.handleMouseDown(t,e,n)&&this.draw()}onMouseMove(t){const{sceneX:e,sceneY:n}=this.getSceneCoords(t);this.lastMouseCoords={x:e,y:n};const i=this.canvas.getBoundingClientRect(),r=t.clientX-i.left,o=t.clientY-i.top;if(this.draggingScrollbar==="horizontal"){const c=this.canvas.width-this.panZoom.scrollbarWidth,l=this.panZoom.virtualWidth*this.panZoom.scale-c,h=r-this.dragStartX,d=l/c;this.panZoom.scrollX=Math.max(0,Math.min(this.dragStartScrollX+h*d,l)),this.draw()}else if(this.draggingScrollbar==="vertical"){const c=this.canvas.height-this.panZoom.scrollbarWidth,l=this.panZoom.virtualHeight*this.panZoom.scale-c,h=o-this.dragStartY,d=l/c;this.panZoom.scrollY=Math.max(0,Math.min(this.dragStartScrollY+h*d,l)),this.draw()}else this.interactionManager.handleMouseMove(e,n),this.draw()}onMouseUp(t){this.draggingScrollbar=null,this.interactionManager.handleMouseUp(),this.draw()}onDoubleClick(t){const{sceneX:e,sceneY:n}=this.getSceneCoords(t);this.interactionManager.handleDoubleClick(e,n),this.draw()}onRightClick(t){const{sceneX:e,sceneY:n}=this.getSceneCoords(t);this.interactionManager.handleRightClick(t,e,n),this.draw()}onClick(t){const{sceneX:e,sceneY:n}=this.getSceneCoords(t);this.interactionManager.handleDoubleClick(e,n),this.draw()}onWheel(t){t.preventDefault();const e=this.canvas.getBoundingClientRect(),n=t.clientX-e.left,i=t.clientY-e.top;this.panZoom.handleWheelEvent(t,this.canvas,n,i),this.draw()}zoomIn(){this.panZoom.zoomIn(this.canvas),this.draw()}zoomOut(){this.panZoom.zoomOut(this.canvas),this.draw()}centerCanvas(){this.panZoom.center(this.canvas),this.draw()}addElement(t){if("x"in t&&"y"in t){const e=this.lastMouseCoords??{x:(this.canvas.width/2+this.panZoom.scrollX)/this.panZoom.scale,y:(this.canvas.height/2+this.panZoom.scrollY)/this.panZoom.scale};t.x=e.x,t.y=e.y}this.scene.addElement(t),this.draw(),console.log("Added item to canvas:",t)}getCanvas(){return this.canvas}getPanZoomManager(){return this.panZoom}getInteractionManager(){return this.interactionManager}onPointerDown(t){if(this.activePointers.set(t.pointerId,{x:t.clientX,y:t.clientY}),this.activePointers.size===2){const[e,n]=Array.from(this.activePointers.values()),i=Math.hypot(e.x-n.x,e.y-n.y),r=this.scene.getSelectedElements().filter(o=>o instanceof O);if(r.length===1){this.pinchElement=r[0],this.pinchInitialDist=i,this.pinchInitialRect={x:this.pinchElement.x,y:this.pinchElement.y,width:this.pinchElement.width,height:this.pinchElement.height};const o=this.canvas.getBoundingClientRect(),c=(e.x+n.x)/2-o.left,a=(e.y+n.y)/2-o.top;this.pinchCenter={x:(c+this.panZoom.scrollX)/this.panZoom.scale,y:(a+this.panZoom.scrollY)/this.panZoom.scale}}else{this.pinchZoomInitialDist=i,this.pinchZoomInitialScale=this.panZoom.scale;const o=this.canvas.getBoundingClientRect(),c=(e.x+n.x)/2-o.left,a=(e.y+n.y)/2-o.top;this.pinchZoomCenterScene={x:(c+this.panZoom.scrollX)/this.panZoom.scale,y:(a+this.panZoom.scrollY)/this.panZoom.scale}}return}this.canvas.setPointerCapture(t.pointerId),this.onMouseDown(t)}onPointerMove(t){if(this.pinchZoomInitialDist!==null&&this.activePointers.size>=2&&this.pinchZoomCenterScene){this.activePointers.set(t.pointerId,{x:t.clientX,y:t.clientY});const[e,n]=Array.from(this.activePointers.values()),i=Math.hypot(e.x-n.x,e.y-n.y);let r=this.pinchZoomInitialScale*(i/this.pinchZoomInitialDist);const o=Math.max((this.canvas.width-this.panZoom.scrollbarWidth)/this.panZoom.virtualWidth,(this.canvas.height-this.panZoom.scrollbarWidth)/this.panZoom.virtualHeight);r=Math.min(Math.max(r,o),3);const c=this.canvas.getBoundingClientRect(),a=(e.x+n.x)/2-c.left,l=(e.y+n.y)/2-c.top;this.panZoom.scale=r,this.panZoom.scrollX=this.pinchZoomCenterScene.x*r-a,this.panZoom.scrollY=this.pinchZoomCenterScene.y*r-l,this.panZoom.clampScroll(),this.draw();return}if(this.pinchInitialDist!==null&&this.activePointers.size>=2&&this.pinchElement&&this.pinchInitialRect&&this.pinchCenter){this.activePointers.set(t.pointerId,{x:t.clientX,y:t.clientY});const[e,n]=Array.from(this.activePointers.values()),r=Math.hypot(e.x-n.x,e.y-n.y)/this.pinchInitialDist,o=this.pinchInitialRect.width*r,c=this.pinchInitialRect.height*r;this.pinchElement.width=Math.max(o,1),this.pinchElement.height=Math.max(c,1),this.pinchElement.x=this.pinchCenter.x-o/2,this.pinchElement.y=this.pinchCenter.y-c/2,this.scene.changes.next();return}this.onMouseMove(t)}onPointerUp(t){this.pinchInitialDist=null,this.pinchInitialRect=null,this.pinchCenter=null,this.pinchElement=null,this.pinchZoomInitialDist=null,this.pinchZoomInitialScale=1,this.pinchZoomCenterScene=null,this.onMouseUp(t),this.canvas.releasePointerCapture(t.pointerId),t.pointerType==="touch"&&this.onClick(t)}onGestureStart(t){t.preventDefault(),this.gestureInitialScale=this.panZoom.scale}onGestureChange(t){t.preventDefault();let e=this.gestureInitialScale*t.scale;const n=Math.max((this.canvas.width-this.panZoom.scrollbarWidth)/this.panZoom.virtualWidth,(this.canvas.height-this.panZoom.scrollbarWidth)/this.panZoom.virtualHeight);e=Math.min(Math.max(e,n),3);const i=this.canvas.width/2,r=this.canvas.height/2,o=(i+this.panZoom.scrollX)/this.panZoom.scale,c=(r+this.panZoom.scrollY)/this.panZoom.scale;this.panZoom.scale=e,this.panZoom.scrollX=o*e-i,this.panZoom.scrollY=c*e-r,this.draw()}onGestureEnd(t){t.preventDefault()}}class yi{constructor(){this.elements=[],this.changes=new it}addElement(t){this.elements.push(t),this.changes.next()}removeElement(t){const e=this.elements.indexOf(t);e>-1&&(this.elements.splice(e,1),this.changes.next())}removeElements(t){t.forEach(e=>{const n=this.elements.indexOf(e);n>-1&&this.elements.splice(n,1)}),this.changes.next()}getElements(){return this.elements}getShapes(){return this.elements.filter(he)}getConnections(){return this.elements.filter(Ys)}setSelected(t){this.getElements().forEach(e=>{e.selected=!1}),t.forEach(e=>{e.selected=!0}),this.changes.next()}getSelectedElements(){return this.getElements().filter(t=>t.selected)}getSelectedShapes(){return this.getShapes().filter(t=>t.selected)}clear(){this.elements=[],this.changes.next()}}class wi{constructor(t){this.dataProvider=t}async loadDiagram(t){const e=await this.dataProvider.loadTasks(),n=await this.dataProvider.loadDependencies();e.forEach(o=>{const c=new P({id:o.id,x:o.x,y:o.y,title:o.title,description:o.description,status:o.status,priority:o.priority,dueDate:o.dueDate instanceof Date?o.dueDate:new Date(o.dueDate)});t.addElement(c)}),(await this.dataProvider.loadStories()).forEach(o=>{const c=t.getElements().filter(l=>l instanceof P&&o.tasks.indexOf(l.id)!==-1),a=new O({id:o.id,x:o.x,y:o.y,width:o.width,height:o.height,title:o.title,description:o.description,status:o.status,priority:o.priority,tasks:c});t.addElement(a)}),(await this.dataProvider.loadGoals()).forEach(o=>{const c=new ft({id:o.id,x:o.x,y:o.y,title:o.title,status:o.status,priority:o.priority});c.progress=o.progress,c.links=o.links,t.addElement(c)}),n.forEach(o=>{const c=t.getElements().find(l=>l.id===o.fromTaskId),a=t.getElements().find(l=>l.id===o.toTaskId);if(c&&a){const l=new Sn(c.id,a.id);t.addElement(l)}})}async saveDiagram(t){const e=t.getElements().filter(a=>a instanceof P).map(a=>({id:a.id,x:a.x,y:a.y,title:a.title,description:a.description,status:a.status,priority:a.priority,dueDate:a.dueDate}));await this.dataProvider.saveTasks(e);const n=t.getConnections().map(a=>({fromTaskId:a.fromId,toTaskId:a.toId,type:"dependsOn"}));await this.dataProvider.saveDependencies(n);const r=t.getElements().filter(a=>a instanceof O).map(a=>({id:a.id,x:a.x,y:a.y,width:a.width,height:a.height,title:a.title,description:a.description,status:a.status,priority:a.priority,tasks:a.tasks.map(l=>l.id)}));await this.dataProvider.saveStories(r);const c=t.getElements().filter(a=>a instanceof ft).map(a=>({id:a.id,x:a.x,y:a.y,width:a.width,height:a.height,title:a.title,status:a.status,priority:a.priority,progress:a.progress,links:a.links}));await this.dataProvider.saveGoals(c)}}class mt{constructor(t){this.props=t,this.element=this.createElement()}render(t){t.appendChild(this.element)}updateProps(t){this.props={...this.props,...t},this.update()}update(){const t=this.createElement();this.element.replaceWith(t),this.element=t}getElement(){return this.element}}function Cn(s,t){const e=document.createElement("div");jt.register(),e.className="fixed inset-0 bg-black/15 backdrop-blur-xs flex items-center justify-center";const n=(t==null?void 0:t.zIndex)??200;e.style.zIndex=n.toString();const i=document.createElement("div");i.className="bg-white rounded-lg p-6 w-96 space-y-4 shadow-lg",i.tabIndex=0;const r=document.createElement("h2");r.className="text-lg font-semibold",r.textContent=s,i.appendChild(r),e.appendChild(i),document.body.appendChild(e);const o=e.remove;e.remove=function(){const u=document.activeElement;u&&typeof u.blur=="function"&&u.blur(),jt.unregister(),o.call(this)},t!=null&&t.onClose&&e.addEventListener("click",u=>{u.target===e&&t.onClose()}),i.setAttribute("role","dialog"),i.setAttribute("aria-modal","true");const c=`modal-title-${Math.random().toString(36).substr(2,9)}`;r.id=c,i.setAttribute("aria-labelledby",c),i.focus();const l=Array.from(i.querySelectorAll('a[href], area[href], input, select, textarea, button, iframe, object, embed, [tabindex]:not([tabindex="-1"])')).filter(u=>!u.hasAttribute("disabled")),h=l[0],d=l[l.length-1];return i.addEventListener("keydown",u=>{u.key==="Tab"&&(u.shiftKey?document.activeElement===h&&(u.preventDefault(),d.focus()):document.activeElement===d&&(u.preventDefault(),h.focus()))}),{overlay:e,container:i}}const kn=new it;function B(s,t="info"){kn.next({message:s,type:t})}const ye="-",xi=s=>{const t=Ei(s),{conflictingClassGroups:e,conflictingClassGroupModifiers:n}=s;return{getClassGroupId:o=>{const c=o.split(ye);return c[0]===""&&c.length!==1&&c.shift(),In(c,t)||Si(o)},getConflictingClassGroupIds:(o,c)=>{const a=e[o]||[];return c&&n[o]?[...a,...n[o]]:a}}},In=(s,t)=>{var o;if(s.length===0)return t.classGroupId;const e=s[0],n=t.nextPart.get(e),i=n?In(s.slice(1),n):void 0;if(i)return i;if(t.validators.length===0)return;const r=s.join(ye);return(o=t.validators.find(({validator:c})=>c(r)))==null?void 0:o.classGroupId},Ue=/^\[(.+)\]$/,Si=s=>{if(Ue.test(s)){const t=Ue.exec(s)[1],e=t==null?void 0:t.substring(0,t.indexOf(":"));if(e)return"arbitrary.."+e}},Ei=s=>{const{theme:t,classGroups:e}=s,n={nextPart:new Map,validators:[]};for(const i in e)de(e[i],n,i,t);return n},de=(s,t,e,n)=>{s.forEach(i=>{if(typeof i=="string"){const r=i===""?t:Be(t,i);r.classGroupId=e;return}if(typeof i=="function"){if(Ci(i)){de(i(n),t,e,n);return}t.validators.push({validator:i,classGroupId:e});return}Object.entries(i).forEach(([r,o])=>{de(o,Be(t,r),e,n)})})},Be=(s,t)=>{let e=s;return t.split(ye).forEach(n=>{e.nextPart.has(n)||e.nextPart.set(n,{nextPart:new Map,validators:[]}),e=e.nextPart.get(n)}),e},Ci=s=>s.isThemeGetter,ki=s=>{if(s<1)return{get:()=>{},set:()=>{}};let t=0,e=new Map,n=new Map;const i=(r,o)=>{e.set(r,o),t++,t>s&&(t=0,n=e,e=new Map)};return{get(r){let o=e.get(r);if(o!==void 0)return o;if((o=n.get(r))!==void 0)return i(r,o),o},set(r,o){e.has(r)?e.set(r,o):i(r,o)}}},ue="!",pe=":",Ii=pe.length,Ti=s=>{const{prefix:t,experimentalParseClassName:e}=s;let n=i=>{const r=[];let o=0,c=0,a=0,l;for(let f=0;f<i.length;f++){let m=i[f];if(o===0&&c===0){if(m===pe){r.push(i.slice(a,f)),a=f+Ii;continue}if(m==="/"){l=f;continue}}m==="["?o++:m==="]"?o--:m==="("?c++:m===")"&&c--}const h=r.length===0?i:i.substring(a),d=Mi(h),u=d!==h,p=l&&l>a?l-a:void 0;return{modifiers:r,hasImportantModifier:u,baseClassName:d,maybePostfixModifierPosition:p}};if(t){const i=t+pe,r=n;n=o=>o.startsWith(i)?r(o.substring(i.length)):{isExternal:!0,modifiers:[],hasImportantModifier:!1,baseClassName:o,maybePostfixModifierPosition:void 0}}if(e){const i=n;n=r=>e({className:r,parseClassName:i})}return n},Mi=s=>s.endsWith(ue)?s.substring(0,s.length-1):s.startsWith(ue)?s.substring(1):s,Pi=s=>{const t=Object.fromEntries(s.orderSensitiveModifiers.map(n=>[n,!0]));return n=>{if(n.length<=1)return n;const i=[];let r=[];return n.forEach(o=>{o[0]==="["||t[o]?(i.push(...r.sort(),o),r=[]):r.push(o)}),i.push(...r.sort()),i}},Li=s=>({cache:ki(s.cacheSize),parseClassName:Ti(s),sortModifiers:Pi(s),...xi(s)}),Ri=/\s+/,Ai=(s,t)=>{const{parseClassName:e,getClassGroupId:n,getConflictingClassGroupIds:i,sortModifiers:r}=t,o=[],c=s.trim().split(Ri);let a="";for(let l=c.length-1;l>=0;l-=1){const h=c[l],{isExternal:d,modifiers:u,hasImportantModifier:p,baseClassName:f,maybePostfixModifierPosition:m}=e(h);if(d){a=h+(a.length>0?" "+a:a);continue}let S=!!m,v=n(S?f.substring(0,m):f);if(!v){if(!S){a=h+(a.length>0?" "+a:a);continue}if(v=n(f),!v){a=h+(a.length>0?" "+a:a);continue}S=!1}const w=r(u).join(":"),C=p?w+ue:w,k=C+v;if(o.includes(k))continue;o.push(k);const T=i(v,S);for(let I=0;I<T.length;++I){const Tt=T[I];o.push(C+Tt)}a=h+(a.length>0?" "+a:a)}return a};function Di(){let s=0,t,e,n="";for(;s<arguments.length;)(t=arguments[s++])&&(e=Tn(t))&&(n&&(n+=" "),n+=e);return n}const Tn=s=>{if(typeof s=="string")return s;let t,e="";for(let n=0;n<s.length;n++)s[n]&&(t=Tn(s[n]))&&(e&&(e+=" "),e+=t);return e};function _i(s,...t){let e,n,i,r=o;function o(a){const l=t.reduce((h,d)=>d(h),s());return e=Li(l),n=e.cache.get,i=e.cache.set,r=c,c(a)}function c(a){const l=n(a);if(l)return l;const h=Ai(a,e);return i(a,h),h}return function(){return r(Di.apply(null,arguments))}}const A=s=>{const t=e=>e[s]||[];return t.isThemeGetter=!0,t},Mn=/^\[(?:(\w[\w-]*):)?(.+)\]$/i,Pn=/^\((?:(\w[\w-]*):)?(.+)\)$/i,Oi=/^\d+\/\d+$/,zi=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,Ni=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,Yi=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,Zi=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,Xi=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,bt=s=>Oi.test(s),E=s=>!!s&&!Number.isNaN(Number(s)),tt=s=>!!s&&Number.isInteger(Number(s)),ie=s=>s.endsWith("%")&&E(s.slice(0,-1)),J=s=>zi.test(s),Ui=()=>!0,Bi=s=>Ni.test(s)&&!Yi.test(s),Ln=()=>!1,$i=s=>Zi.test(s),Wi=s=>Xi.test(s),Gi=s=>!g(s)&&!b(s),Hi=s=>kt(s,Dn,Ln),g=s=>Mn.test(s),ot=s=>kt(s,_n,Bi),re=s=>kt(s,Ki,E),$e=s=>kt(s,Rn,Ln),ji=s=>kt(s,An,Wi),Xt=s=>kt(s,On,$i),b=s=>Pn.test(s),Mt=s=>It(s,_n),Vi=s=>It(s,Ji),We=s=>It(s,Rn),Fi=s=>It(s,Dn),qi=s=>It(s,An),Ut=s=>It(s,On,!0),kt=(s,t,e)=>{const n=Mn.exec(s);return n?n[1]?t(n[1]):e(n[2]):!1},It=(s,t,e=!1)=>{const n=Pn.exec(s);return n?n[1]?t(n[1]):e:!1},Rn=s=>s==="position"||s==="percentage",An=s=>s==="image"||s==="url",Dn=s=>s==="length"||s==="size"||s==="bg-size",_n=s=>s==="length",Ki=s=>s==="number",Ji=s=>s==="family-name",On=s=>s==="shadow",Qi=()=>{const s=A("color"),t=A("font"),e=A("text"),n=A("font-weight"),i=A("tracking"),r=A("leading"),o=A("breakpoint"),c=A("container"),a=A("spacing"),l=A("radius"),h=A("shadow"),d=A("inset-shadow"),u=A("text-shadow"),p=A("drop-shadow"),f=A("blur"),m=A("perspective"),S=A("aspect"),v=A("ease"),w=A("animate"),C=()=>["auto","avoid","all","avoid-page","page","left","right","column"],k=()=>["center","top","bottom","left","right","top-left","left-top","top-right","right-top","bottom-right","right-bottom","bottom-left","left-bottom"],T=()=>[...k(),b,g],I=()=>["auto","hidden","clip","visible","scroll"],Tt=()=>["auto","contain","none"],x=()=>[b,g,a],q=()=>[bt,"full","auto",...x()],Ee=()=>[tt,"none","subgrid",b,g],Ce=()=>["auto",{span:["full",tt,b,g]},tt,b,g],_t=()=>[tt,"auto",b,g],ke=()=>["auto","min","max","fr",b,g],Kt=()=>["start","end","center","between","around","evenly","stretch","baseline","center-safe","end-safe"],gt=()=>["start","end","center","stretch","center-safe","end-safe"],K=()=>["auto",...x()],rt=()=>[bt,"auto","full","dvw","dvh","lvw","lvh","svw","svh","min","max","fit",...x()],y=()=>[s,b,g],Ie=()=>[...k(),We,$e,{position:[b,g]}],Te=()=>["no-repeat",{repeat:["","x","y","space","round"]}],Me=()=>["auto","cover","contain",Fi,Hi,{size:[b,g]}],Jt=()=>[ie,Mt,ot],Y=()=>["","none","full",l,b,g],U=()=>["",E,Mt,ot],Ot=()=>["solid","dashed","dotted","double"],Pe=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],z=()=>[E,ie,We,$e],Le=()=>["","none",f,b,g],zt=()=>["none",E,b,g],Nt=()=>["none",E,b,g],Qt=()=>[E,b,g],Yt=()=>[bt,"full",...x()];return{cacheSize:500,theme:{animate:["spin","ping","pulse","bounce"],aspect:["video"],blur:[J],breakpoint:[J],color:[Ui],container:[J],"drop-shadow":[J],ease:["in","out","in-out"],font:[Gi],"font-weight":["thin","extralight","light","normal","medium","semibold","bold","extrabold","black"],"inset-shadow":[J],leading:["none","tight","snug","normal","relaxed","loose"],perspective:["dramatic","near","normal","midrange","distant","none"],radius:[J],shadow:[J],spacing:["px",E],text:[J],"text-shadow":[J],tracking:["tighter","tight","normal","wide","wider","widest"]},classGroups:{aspect:[{aspect:["auto","square",bt,g,b,S]}],container:["container"],columns:[{columns:[E,g,b,c]}],"break-after":[{"break-after":C()}],"break-before":[{"break-before":C()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],sr:["sr-only","not-sr-only"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:T()}],overflow:[{overflow:I()}],"overflow-x":[{"overflow-x":I()}],"overflow-y":[{"overflow-y":I()}],overscroll:[{overscroll:Tt()}],"overscroll-x":[{"overscroll-x":Tt()}],"overscroll-y":[{"overscroll-y":Tt()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:q()}],"inset-x":[{"inset-x":q()}],"inset-y":[{"inset-y":q()}],start:[{start:q()}],end:[{end:q()}],top:[{top:q()}],right:[{right:q()}],bottom:[{bottom:q()}],left:[{left:q()}],visibility:["visible","invisible","collapse"],z:[{z:[tt,"auto",b,g]}],basis:[{basis:[bt,"full","auto",c,...x()]}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["nowrap","wrap","wrap-reverse"]}],flex:[{flex:[E,bt,"auto","initial","none",g]}],grow:[{grow:["",E,b,g]}],shrink:[{shrink:["",E,b,g]}],order:[{order:[tt,"first","last","none",b,g]}],"grid-cols":[{"grid-cols":Ee()}],"col-start-end":[{col:Ce()}],"col-start":[{"col-start":_t()}],"col-end":[{"col-end":_t()}],"grid-rows":[{"grid-rows":Ee()}],"row-start-end":[{row:Ce()}],"row-start":[{"row-start":_t()}],"row-end":[{"row-end":_t()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":ke()}],"auto-rows":[{"auto-rows":ke()}],gap:[{gap:x()}],"gap-x":[{"gap-x":x()}],"gap-y":[{"gap-y":x()}],"justify-content":[{justify:[...Kt(),"normal"]}],"justify-items":[{"justify-items":[...gt(),"normal"]}],"justify-self":[{"justify-self":["auto",...gt()]}],"align-content":[{content:["normal",...Kt()]}],"align-items":[{items:[...gt(),{baseline:["","last"]}]}],"align-self":[{self:["auto",...gt(),{baseline:["","last"]}]}],"place-content":[{"place-content":Kt()}],"place-items":[{"place-items":[...gt(),"baseline"]}],"place-self":[{"place-self":["auto",...gt()]}],p:[{p:x()}],px:[{px:x()}],py:[{py:x()}],ps:[{ps:x()}],pe:[{pe:x()}],pt:[{pt:x()}],pr:[{pr:x()}],pb:[{pb:x()}],pl:[{pl:x()}],m:[{m:K()}],mx:[{mx:K()}],my:[{my:K()}],ms:[{ms:K()}],me:[{me:K()}],mt:[{mt:K()}],mr:[{mr:K()}],mb:[{mb:K()}],ml:[{ml:K()}],"space-x":[{"space-x":x()}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":x()}],"space-y-reverse":["space-y-reverse"],size:[{size:rt()}],w:[{w:[c,"screen",...rt()]}],"min-w":[{"min-w":[c,"screen","none",...rt()]}],"max-w":[{"max-w":[c,"screen","none","prose",{screen:[o]},...rt()]}],h:[{h:["screen",...rt()]}],"min-h":[{"min-h":["screen","none",...rt()]}],"max-h":[{"max-h":["screen",...rt()]}],"font-size":[{text:["base",e,Mt,ot]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:[n,b,re]}],"font-stretch":[{"font-stretch":["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded",ie,g]}],"font-family":[{font:[Vi,g,t]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:[i,b,g]}],"line-clamp":[{"line-clamp":[E,"none",b,re]}],leading:[{leading:[r,...x()]}],"list-image":[{"list-image":["none",b,g]}],"list-style-position":[{list:["inside","outside"]}],"list-style-type":[{list:["disc","decimal","none",b,g]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"placeholder-color":[{placeholder:y()}],"text-color":[{text:y()}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...Ot(),"wavy"]}],"text-decoration-thickness":[{decoration:[E,"from-font","auto",b,ot]}],"text-decoration-color":[{decoration:y()}],"underline-offset":[{"underline-offset":[E,"auto",b,g]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:x()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",b,g]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],wrap:[{wrap:["break-word","anywhere","normal"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",b,g]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:Ie()}],"bg-repeat":[{bg:Te()}],"bg-size":[{bg:Me()}],"bg-image":[{bg:["none",{linear:[{to:["t","tr","r","br","b","bl","l","tl"]},tt,b,g],radial:["",b,g],conic:[tt,b,g]},qi,ji]}],"bg-color":[{bg:y()}],"gradient-from-pos":[{from:Jt()}],"gradient-via-pos":[{via:Jt()}],"gradient-to-pos":[{to:Jt()}],"gradient-from":[{from:y()}],"gradient-via":[{via:y()}],"gradient-to":[{to:y()}],rounded:[{rounded:Y()}],"rounded-s":[{"rounded-s":Y()}],"rounded-e":[{"rounded-e":Y()}],"rounded-t":[{"rounded-t":Y()}],"rounded-r":[{"rounded-r":Y()}],"rounded-b":[{"rounded-b":Y()}],"rounded-l":[{"rounded-l":Y()}],"rounded-ss":[{"rounded-ss":Y()}],"rounded-se":[{"rounded-se":Y()}],"rounded-ee":[{"rounded-ee":Y()}],"rounded-es":[{"rounded-es":Y()}],"rounded-tl":[{"rounded-tl":Y()}],"rounded-tr":[{"rounded-tr":Y()}],"rounded-br":[{"rounded-br":Y()}],"rounded-bl":[{"rounded-bl":Y()}],"border-w":[{border:U()}],"border-w-x":[{"border-x":U()}],"border-w-y":[{"border-y":U()}],"border-w-s":[{"border-s":U()}],"border-w-e":[{"border-e":U()}],"border-w-t":[{"border-t":U()}],"border-w-r":[{"border-r":U()}],"border-w-b":[{"border-b":U()}],"border-w-l":[{"border-l":U()}],"divide-x":[{"divide-x":U()}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":U()}],"divide-y-reverse":["divide-y-reverse"],"border-style":[{border:[...Ot(),"hidden","none"]}],"divide-style":[{divide:[...Ot(),"hidden","none"]}],"border-color":[{border:y()}],"border-color-x":[{"border-x":y()}],"border-color-y":[{"border-y":y()}],"border-color-s":[{"border-s":y()}],"border-color-e":[{"border-e":y()}],"border-color-t":[{"border-t":y()}],"border-color-r":[{"border-r":y()}],"border-color-b":[{"border-b":y()}],"border-color-l":[{"border-l":y()}],"divide-color":[{divide:y()}],"outline-style":[{outline:[...Ot(),"none","hidden"]}],"outline-offset":[{"outline-offset":[E,b,g]}],"outline-w":[{outline:["",E,Mt,ot]}],"outline-color":[{outline:y()}],shadow:[{shadow:["","none",h,Ut,Xt]}],"shadow-color":[{shadow:y()}],"inset-shadow":[{"inset-shadow":["none",d,Ut,Xt]}],"inset-shadow-color":[{"inset-shadow":y()}],"ring-w":[{ring:U()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:y()}],"ring-offset-w":[{"ring-offset":[E,ot]}],"ring-offset-color":[{"ring-offset":y()}],"inset-ring-w":[{"inset-ring":U()}],"inset-ring-color":[{"inset-ring":y()}],"text-shadow":[{"text-shadow":["none",u,Ut,Xt]}],"text-shadow-color":[{"text-shadow":y()}],opacity:[{opacity:[E,b,g]}],"mix-blend":[{"mix-blend":[...Pe(),"plus-darker","plus-lighter"]}],"bg-blend":[{"bg-blend":Pe()}],"mask-clip":[{"mask-clip":["border","padding","content","fill","stroke","view"]},"mask-no-clip"],"mask-composite":[{mask:["add","subtract","intersect","exclude"]}],"mask-image-linear-pos":[{"mask-linear":[E]}],"mask-image-linear-from-pos":[{"mask-linear-from":z()}],"mask-image-linear-to-pos":[{"mask-linear-to":z()}],"mask-image-linear-from-color":[{"mask-linear-from":y()}],"mask-image-linear-to-color":[{"mask-linear-to":y()}],"mask-image-t-from-pos":[{"mask-t-from":z()}],"mask-image-t-to-pos":[{"mask-t-to":z()}],"mask-image-t-from-color":[{"mask-t-from":y()}],"mask-image-t-to-color":[{"mask-t-to":y()}],"mask-image-r-from-pos":[{"mask-r-from":z()}],"mask-image-r-to-pos":[{"mask-r-to":z()}],"mask-image-r-from-color":[{"mask-r-from":y()}],"mask-image-r-to-color":[{"mask-r-to":y()}],"mask-image-b-from-pos":[{"mask-b-from":z()}],"mask-image-b-to-pos":[{"mask-b-to":z()}],"mask-image-b-from-color":[{"mask-b-from":y()}],"mask-image-b-to-color":[{"mask-b-to":y()}],"mask-image-l-from-pos":[{"mask-l-from":z()}],"mask-image-l-to-pos":[{"mask-l-to":z()}],"mask-image-l-from-color":[{"mask-l-from":y()}],"mask-image-l-to-color":[{"mask-l-to":y()}],"mask-image-x-from-pos":[{"mask-x-from":z()}],"mask-image-x-to-pos":[{"mask-x-to":z()}],"mask-image-x-from-color":[{"mask-x-from":y()}],"mask-image-x-to-color":[{"mask-x-to":y()}],"mask-image-y-from-pos":[{"mask-y-from":z()}],"mask-image-y-to-pos":[{"mask-y-to":z()}],"mask-image-y-from-color":[{"mask-y-from":y()}],"mask-image-y-to-color":[{"mask-y-to":y()}],"mask-image-radial":[{"mask-radial":[b,g]}],"mask-image-radial-from-pos":[{"mask-radial-from":z()}],"mask-image-radial-to-pos":[{"mask-radial-to":z()}],"mask-image-radial-from-color":[{"mask-radial-from":y()}],"mask-image-radial-to-color":[{"mask-radial-to":y()}],"mask-image-radial-shape":[{"mask-radial":["circle","ellipse"]}],"mask-image-radial-size":[{"mask-radial":[{closest:["side","corner"],farthest:["side","corner"]}]}],"mask-image-radial-pos":[{"mask-radial-at":k()}],"mask-image-conic-pos":[{"mask-conic":[E]}],"mask-image-conic-from-pos":[{"mask-conic-from":z()}],"mask-image-conic-to-pos":[{"mask-conic-to":z()}],"mask-image-conic-from-color":[{"mask-conic-from":y()}],"mask-image-conic-to-color":[{"mask-conic-to":y()}],"mask-mode":[{mask:["alpha","luminance","match"]}],"mask-origin":[{"mask-origin":["border","padding","content","fill","stroke","view"]}],"mask-position":[{mask:Ie()}],"mask-repeat":[{mask:Te()}],"mask-size":[{mask:Me()}],"mask-type":[{"mask-type":["alpha","luminance"]}],"mask-image":[{mask:["none",b,g]}],filter:[{filter:["","none",b,g]}],blur:[{blur:Le()}],brightness:[{brightness:[E,b,g]}],contrast:[{contrast:[E,b,g]}],"drop-shadow":[{"drop-shadow":["","none",p,Ut,Xt]}],"drop-shadow-color":[{"drop-shadow":y()}],grayscale:[{grayscale:["",E,b,g]}],"hue-rotate":[{"hue-rotate":[E,b,g]}],invert:[{invert:["",E,b,g]}],saturate:[{saturate:[E,b,g]}],sepia:[{sepia:["",E,b,g]}],"backdrop-filter":[{"backdrop-filter":["","none",b,g]}],"backdrop-blur":[{"backdrop-blur":Le()}],"backdrop-brightness":[{"backdrop-brightness":[E,b,g]}],"backdrop-contrast":[{"backdrop-contrast":[E,b,g]}],"backdrop-grayscale":[{"backdrop-grayscale":["",E,b,g]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[E,b,g]}],"backdrop-invert":[{"backdrop-invert":["",E,b,g]}],"backdrop-opacity":[{"backdrop-opacity":[E,b,g]}],"backdrop-saturate":[{"backdrop-saturate":[E,b,g]}],"backdrop-sepia":[{"backdrop-sepia":["",E,b,g]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":x()}],"border-spacing-x":[{"border-spacing-x":x()}],"border-spacing-y":[{"border-spacing-y":x()}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["","all","colors","opacity","shadow","transform","none",b,g]}],"transition-behavior":[{transition:["normal","discrete"]}],duration:[{duration:[E,"initial",b,g]}],ease:[{ease:["linear","initial",v,b,g]}],delay:[{delay:[E,b,g]}],animate:[{animate:["none",w,b,g]}],backface:[{backface:["hidden","visible"]}],perspective:[{perspective:[m,b,g]}],"perspective-origin":[{"perspective-origin":T()}],rotate:[{rotate:zt()}],"rotate-x":[{"rotate-x":zt()}],"rotate-y":[{"rotate-y":zt()}],"rotate-z":[{"rotate-z":zt()}],scale:[{scale:Nt()}],"scale-x":[{"scale-x":Nt()}],"scale-y":[{"scale-y":Nt()}],"scale-z":[{"scale-z":Nt()}],"scale-3d":["scale-3d"],skew:[{skew:Qt()}],"skew-x":[{"skew-x":Qt()}],"skew-y":[{"skew-y":Qt()}],transform:[{transform:[b,g,"","none","gpu","cpu"]}],"transform-origin":[{origin:T()}],"transform-style":[{transform:["3d","flat"]}],translate:[{translate:Yt()}],"translate-x":[{"translate-x":Yt()}],"translate-y":[{"translate-y":Yt()}],"translate-z":[{"translate-z":Yt()}],"translate-none":["translate-none"],accent:[{accent:y()}],appearance:[{appearance:["none","auto"]}],"caret-color":[{caret:y()}],"color-scheme":[{scheme:["normal","dark","light","light-dark","only-dark","only-light"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",b,g]}],"field-sizing":[{"field-sizing":["fixed","content"]}],"pointer-events":[{"pointer-events":["auto","none"]}],resize:[{resize:["none","","y","x"]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":x()}],"scroll-mx":[{"scroll-mx":x()}],"scroll-my":[{"scroll-my":x()}],"scroll-ms":[{"scroll-ms":x()}],"scroll-me":[{"scroll-me":x()}],"scroll-mt":[{"scroll-mt":x()}],"scroll-mr":[{"scroll-mr":x()}],"scroll-mb":[{"scroll-mb":x()}],"scroll-ml":[{"scroll-ml":x()}],"scroll-p":[{"scroll-p":x()}],"scroll-px":[{"scroll-px":x()}],"scroll-py":[{"scroll-py":x()}],"scroll-ps":[{"scroll-ps":x()}],"scroll-pe":[{"scroll-pe":x()}],"scroll-pt":[{"scroll-pt":x()}],"scroll-pr":[{"scroll-pr":x()}],"scroll-pb":[{"scroll-pb":x()}],"scroll-pl":[{"scroll-pl":x()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",b,g]}],fill:[{fill:["none",...y()]}],"stroke-w":[{stroke:[E,Mt,ot,re]}],stroke:[{stroke:["none",...y()]}],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-x","border-w-y","border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-x","border-color-y","border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],translate:["translate-x","translate-y","translate-none"],"translate-none":["translate","translate-x","translate-y","translate-z"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]},orderSensitiveModifiers:["*","**","after","backdrop","before","details-content","file","first-letter","first-line","marker","placeholder","selection"]}},j=_i(Qi);class zn extends mt{createElement(){const t=document.createElement("button");t.type=this.props.type||"button",this.props.text&&(t.innerText=this.props.text),this.props.children&&(typeof this.props.children=="string"?t.innerText=this.props.children:t.appendChild(this.props.children)),this.props.onClick&&t.addEventListener("click",this.props.onClick),this.props.disabled&&(t.disabled=!0),this.props.tooltip&&(t.title=this.props.tooltip);const e=["inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors","focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2","disabled:pointer-events-none disabled:brightness-150 disabled:contrast-98 disabled:opacity-90 disabled:saturate-2 disabled:cursor-not-allowed","[&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0","cursor-pointer"].join(" "),n={default:"bg-primary text-white hover:bg-primary/90 active:bg-primary/80 transition-colors",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90 active:bg-destructive/80 transition-colors",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground active:bg-accent/80 transition-colors",secondary:"bg-gray-100 text-gray-900 hover:bg-gray-200 active:bg-gray-300 transition-colors",ghost:"hover:bg-accent hover:text-accent-foreground active:bg-accent/80 transition-colors",link:"text-primary underline-offset-4 hover:underline active:text-primary/80 transition-colors",lightgray:"bg-gray-200 text-gray-900 hover:bg-gray-300 active:bg-gray-400 border border-gray-300 transition-colors",success:"bg-green-600 text-white hover:bg-green-700 active:bg-green-800 transition-colors",accent:"bg-blue-600 text-white hover:bg-blue-700 active:bg-blue-800 transition-colors"},i={default:"h-10 px-4 py-2",sm:"h-9 px-3",lg:"h-11 px-8",icon:"h-10 w-10","icon-sm":"h-9 w-9","icon-lg":"h-11 w-11"},r=this.props.variant||"default",o=this.props.size||"default";return t.className=j(e,n[r],i[o],this.props.className||"","rounded-full"),t}}class we{constructor(){this.listeners=[]}on(t){this.listeners.push(t)}emit(t){this.listeners.forEach(e=>e(t))}}class tr extends mt{constructor(t){super(t),this.changeEmitter=new we,t.onChange&&this.onChange(t.onChange)}createElement(){const t=document.createElement("input");t.type=this.props.type||"text",this.props.value!==void 0&&(t.value=this.props.value),this.props.placeholder&&(t.placeholder=this.props.placeholder),this.props.disabled&&(t.disabled=!0),this.props.name&&(t.name=this.props.name),this.props.id&&(t.id=this.props.id),this.props.autoFocus&&(t.autofocus=!0),this.props.autoComplete&&(t.autocomplete=this.props.autoComplete),this.props.required&&(t.required=!0),this.props.minLength!==void 0&&(t.minLength=this.props.minLength),this.props.maxLength!==void 0&&(t.maxLength=this.props.maxLength),this.props.pattern&&(t.pattern=this.props.pattern),t.addEventListener("input",()=>{this.changeEmitter.emit(t.value)});const e=["flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background","placeholder:text-muted-foreground","focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2","disabled:cursor-not-allowed disabled:opacity-50"].join(" ");return t.className=j(e,this.props.className||""),t}onChange(t){this.changeEmitter.on(t)}setValue(t){this.updateProps({value:t})}getValue(){return this.element.value}}const Ge={button:{primary:"bg-blue-500 text-white hover:bg-blue-600",secondary:"bg-gray-500 text-white hover:bg-gray-600",danger:"bg-red-500 text-white hover:bg-red-600"},input:"border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",checkbox:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"},Se=class Se{static setTheme(t){this.theme={...Ge,...t}}static getTheme(){return this.theme}};Se.theme=Ge;let fe=Se;class er extends mt{constructor(t){super(t),this.changeEmitter=new we,t.onChange&&this.onChange(t.onChange)}createElement(){this.container=document.createElement("div"),this.container.className="flex items-center",this.input=document.createElement("input"),this.input.type="checkbox",this.input.checked=this.props.checked,this.input.addEventListener("change",()=>{this.changeEmitter.emit(this.input.checked)});const e=fe.getTheme().checkbox;return this.input.className=j(e,this.props.className||""),this.container.appendChild(this.input),this.props.label&&(this.labelElement=document.createElement("label"),this.labelElement.innerText=this.props.label,this.labelElement.className="ml-2",this.container.appendChild(this.labelElement)),this.container}onChange(t){this.changeEmitter.on(t)}setChecked(t){this.updateProps({checked:t})}isChecked(){return this.input.checked}}class nr extends mt{constructor(t){super(t),this.props=t,this.isListVisible=!1}createElement(){var i;this.filteredItems=[...this.props.items];const t=this.props.selectedValue&&((i=this.props.items.find(r=>r.value===this.props.selectedValue))==null?void 0:i.label)||"";this.filterInput=L.createInput({value:t,placeholder:this.props.placeholder??"Search items...",onChange:r=>this.filterItems(r)}),this.props.selectedValue&&(this.filteredItems=this.props.items.filter(r=>r.value===this.props.selectedValue)),this.props.onSelect&&(this.selectEmitter||(this.selectEmitter=new we),this.onSelect(this.props.onSelect));const e=document.createElement("div");e.className=j("relative flex flex-col gap-2",this.props.className||"");const n=document.createElement("div");return this.filterInput.render(n),e.appendChild(n),this.listContainer=document.createElement("ul"),this.listContainer.className=j("absolute z-60 top-full left-0 w-full flex flex-col gap-2 mt-1 bg-gray-100 rounded-lg shadow-lg max-h-60 overflow-y-auto",this.isListVisible?"block":"hidden"),this.renderItems(),e.appendChild(this.listContainer),this.filterInput.getElement().addEventListener("focus",()=>{this.isListVisible=!0,this.updateListVisibility()}),this.filterInput.getElement().addEventListener("blur",()=>{setTimeout(()=>{this.isListVisible=!1,this.updateListVisibility()},150)}),e}filterItems(t){const e=t.toLowerCase();this.filteredItems=this.props.items.filter(n=>n.label.toLowerCase().includes(e)),this.isListVisible=!0,this.renderItems()}renderItems(){if(this.listContainer.innerHTML="",this.filteredItems.length===0){const t=document.createElement("li");t.textContent="No items found",t.className=j("px-3 py-2 text-gray-500 italic text-center bg-white rounded-lg border-2 border-gray-200"),this.listContainer.appendChild(t)}else this.filteredItems.forEach(t=>{const e=document.createElement("li");e.textContent=t.label,e.className=j("px-3 py-2 text-gray-800 hover:bg-gray-200 cursor-pointer"),e.addEventListener("click",()=>{this.selectItem(t)}),this.listContainer.appendChild(e)});this.updateListVisibility()}selectItem(t){this.filterInput.setValue(t.label),this.isListVisible=!1,this.selectEmitter.emit(t.value),this.updateListVisibility()}updateListVisibility(){this.listContainer.className=j("absolute z-60 top-full left-0 w-full flex flex-col gap-2 mt-1 bg-gray-100 rounded-lg shadow-lg max-h-60 overflow-y-auto",this.isListVisible?"block":"hidden")}updateItems(t){this.props.items=t,this.filteredItems=[...t],this.filterItems(this.filterInput.getValue())}onSelect(t){this.selectEmitter.on(t)}getSelectedValue(){return this.filterInput.getValue()}}class sr extends mt{constructor(t){super(t),this.props=t}createElement(){const t=document.createElement("select"),e=["appearance-none inline-flex items-center justify-between w-full gap-2 whitespace-nowrap rounded-md border border-input bg-background px-4 py-2 text-sm font-medium text-foreground ring-offset-background transition-colors cursor-pointer","focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2","disabled:pointer-events-none disabled:opacity-50"].join(" ");return t.className=j(e,this.props.className??""),this.props.items.forEach(n=>{const i=document.createElement("option");i.value=n.value,i.textContent=n.label,this.props.selectedValue===n.value&&(i.selected=!0),t.appendChild(i)}),t.addEventListener("change",n=>{const i=n.target.value;this.props.onChange&&this.props.onChange(i)}),t}}class L{static createButton(t){return new zn(t)}static createInput(t){return new tr(t)}static createCheckbox(t){return new er(t)}static createSearchSelect(t){return new nr(t)}static createSelect(t){return new sr(t)}}const He="ui-lib-toast-progress-style";if(typeof document<"u"&&!document.getElementById(He)){const s=document.createElement("style");s.id=He,s.textContent=`
@keyframes toast-progress {
  from { width: 100%; }
  to { width: 0%; }
}`,document.head.appendChild(s)}const ir={success:'<svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-green-500 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>',error:'<svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-red-500 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>',info:'<svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-blue-500 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01"/><circle cx="12" cy="12" r="9"/></svg>'},rr='<svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 text-gray-500" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>';class or extends mt{constructor(t){super(t),this.timeoutId=null,this.remaining=t.duration??3e3,this.startTime=0}render(t){super.render(t);const e=this.getElement();if(!e)return;requestAnimationFrame(()=>e.classList.remove("opacity-0","translate-x-2"));const n=e.querySelector(".progress-bar");this.startTime=Date.now(),n&&(n.style.animationPlayState="running");const i=()=>{this.props.onDismiss&&this.props.onDismiss(),e.remove(),n&&(n.style.animationPlayState="paused"),this.timeoutId&&clearTimeout(this.timeoutId)};this.timeoutId=window.setTimeout(i,this.remaining),e.addEventListener("mouseenter",()=>{this.timeoutId&&clearTimeout(this.timeoutId),n&&(n.style.animationPlayState="paused"),this.remaining-=Date.now()-this.startTime}),e.addEventListener("mouseleave",()=>{this.startTime=Date.now(),n&&(n.style.animationPlayState="running"),this.timeoutId=window.setTimeout(i,this.remaining)})}createElement(){const{message:t,type:e="info",className:n="",onDismiss:i,duration:r=3e3}=this.props,o=document.createElement("div"),c="opacity-0 translate-x-2 transition ease-out duration-300",a="flex items-start justify-between p-4 rounded-md shadow-md transition relative overflow-hidden",l={success:"bg-green-50 text-green-800",error:"bg-red-50 text-red-800",info:"bg-blue-50 text-blue-800"}[e];o.className=j(a,l,n,c);const h=document.createElement("div");h.className="absolute bottom-0 left-0 w-full h-1 bg-gray-200";const d=document.createElement("div");d.className="h-full bg-current progress-bar",d.style.width="100%",d.style.animationName="toast-progress",d.style.animationDuration=`${r}ms`,d.style.animationTimingFunction="linear",d.style.animationFillMode="forwards",d.style.animationPlayState="paused",h.appendChild(d),o.appendChild(h);const u=document.createElement("span");u.innerHTML=ir[e];const p=document.createElement("div");p.className="ml-3 flex-1 text-sm font-medium",p.textContent=t;const f=document.createElement("button");return f.type="button",f.className="ml-4 p-1 rounded-full hover:bg-black/10 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary",f.innerHTML=rr,i&&f.addEventListener("click",i),o.append(u,p,f),o}}class ar extends mt{constructor(t,e){super(t),this.modal=null,this.errorMessage=null,this.isLoading=!1,this.authService=e,this.avatarContainer=document.createElement("div"),this.avatarContainer.className="absolute top-5 right-4",this.loginButton=L.createButton({text:"Login",onClick:()=>this.showLoginModal(),variant:"default",className:"w-full"}).createElement(),this.logoutButton=L.createButton({text:"Logout",onClick:()=>this.handleLogout(),variant:"destructive",className:"w-full",size:"lg"}).createElement(),this.dropdownMenu=document.createElement("div"),this.dropdownMenu.className="absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg z-10 hidden",this.dropdownMenu.appendChild(this.logoutButton),this.avatarContainer.appendChild(this.dropdownMenu),t instanceof Node?this.avatarContainer instanceof Node?t.appendChild(this.avatarContainer):console.error("avatarContainer is not a valid DOM node",this.avatarContainer):console.error("Container is not a valid DOM node",t),this.updateUI(),M.changes.subscribe(()=>this.updateUI()),window.addEventListener("refreshCanvasData",()=>this.updateUI())}createElement(){return this.avatarContainer}updateUI(){var t;if(this.authService.isLoggedIn())this.authService.getAuthToken(),this.avatarContainer.innerHTML='<img src="https://cdn.thegreatprojects.com/thegreatprojects/images/c/c/c/d/9/cccd9ab3a8832417497e233c1cb92b9e.jpg?width=364&height=364&format=jpg" alt="User Avatar" class="w-10 h-10 bg-gray-100 rounded-full cursor-pointer">',(t=this.avatarContainer.firstChild)==null||t.addEventListener("click",()=>this.toggleDropdown()),this.avatarContainer.appendChild(this.dropdownMenu);else{this.avatarContainer.innerHTML="";const e=M.canUndo();this.loginButton.textContent=e?"Login to Save":"Login",this.avatarContainer.appendChild(this.loginButton)}}toggleDropdown(){this.dropdownMenu.classList.contains("hidden")?this.dropdownMenu.classList.remove("hidden"):this.dropdownMenu.classList.add("hidden")}showLoginModal(){if(this.modal)return;const{overlay:t,container:e}=Cn("Login to Majom Canvas",{onClose:()=>this.closeModal()});this.modal=t;const n=document.createElement("form");n.id="loginForm";const i=document.createElement("div");i.className="mb-4";const r=document.createElement("label");r.htmlFor="username",r.className="block text-sm font-medium text-gray-700",r.textContent="Username";const o=L.createInput({id:"username",name:"username",type:"text",placeholder:"Enter your username",className:"mt-1"}).createElement();i.append(r,o);const c=document.createElement("div");c.className="mb-4";const a=document.createElement("label");a.htmlFor="password",a.className="block text-sm font-medium text-gray-700",a.textContent="Password";const l=L.createInput({id:"password",name:"password",type:"password",placeholder:"Enter your password",className:"mt-1"}).createElement();c.append(a,l),this.errorMessage=document.createElement("div"),this.errorMessage.className="mt-2 text-red-500 hidden";const h=L.createButton({text:"Login",type:"submit",variant:"default",className:"w-full"}).createElement();h.id="loginSubmit",n.append(i,c,h),e.append(n,this.errorMessage),n.addEventListener("submit",d=>this.handleLoginSubmit(d))}closeModal(){this.modal&&(this.modal.remove(),this.modal=null,this.errorMessage=null)}async handleLoginSubmit(t){if(t.preventDefault(),this.isLoading||!this.modal)return;const e=this.modal.querySelector("#username"),n=this.modal.querySelector("#password"),i=this.modal.querySelector("#loginSubmit"),r={username:e.value,password:n.value};this.isLoading=!0,i.disabled=!0,i.textContent="Logging in...";try{await this.authService.login(r),this.isLoading=!1,B("Logged in successfully","success"),this.closeModal(),this.updateUI(),window.dispatchEvent(new CustomEvent("refreshCanvasData"))}catch(o){this.isLoading=!1,i.disabled=!1,i.textContent="Login";const c=o instanceof Error?o.message:"Login failed. Please try again.";B(c,"error"),this.errorMessage&&(this.errorMessage.classList.remove("hidden"),this.errorMessage.textContent=c)}}handleLogout(){this.authService.logout(),B("Logged out","info"),this.updateUI(),this.dropdownMenu.classList.add("hidden"),window.dispatchEvent(new CustomEvent("refreshCanvasData"))}}const Nn={apiUrl:"https://mxll.pythonanywhere.com"};class Rt extends Error{}Rt.prototype.name="InvalidTokenError";function cr(s){return decodeURIComponent(atob(s).replace(/(.)/g,(t,e)=>{let n=e.charCodeAt(0).toString(16).toUpperCase();return n.length<2&&(n="0"+n),"%"+n}))}function lr(s){let t=s.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return cr(t)}catch{return atob(t)}}function hr(s,t){if(typeof s!="string")throw new Rt("Invalid token specified: must be a string");t||(t={});const e=t.header===!0?0:1,n=s.split(".")[e];if(typeof n!="string")throw new Rt(`Invalid token specified: missing part #${e+1}`);let i;try{i=lr(n)}catch(r){throw new Rt(`Invalid token specified: invalid base64 for part #${e+1} (${r.message})`)}try{return JSON.parse(i)}catch(r){throw new Rt(`Invalid token specified: invalid json for part #${e+1} (${r.message})`)}}const At="jwt",Bt="refresh";class xe{constructor(t){this.baseUrl=Nn.apiUrl,t&&(this.baseUrl=t)}async login(t){try{const e=await fetch(`${this.baseUrl}/token/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!e.ok)throw new Error("Login failed. Please check your credentials.");const n=await e.json();return this.setTokens({access:n.access,refresh:n.refresh}),n}catch(e){throw new Error(e instanceof Error?e.message:"An error occurred during login.")}}async refreshToken(){try{const t=this.getRefreshToken();if(!t)throw new Error("No refresh token available.");const e=await fetch(`${this.baseUrl}/token/refresh/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refresh:t})});if(!e.ok)throw new Error("Token refresh failed.");const n=await e.json();return this.setToken(n.access),{access:n.access}}catch(t){throw new Error(t instanceof Error?t.message:"An error occurred during token refresh.")}}logout(){this.removeTokens()}setTokens(t){localStorage.setItem(At,t.access),localStorage.setItem(Bt,t.refresh)}setToken(t){localStorage.setItem(At,t)}setRefreshToken(t){localStorage.setItem(Bt,t)}removeTokens(){localStorage.removeItem(At),localStorage.removeItem(Bt)}getAuthToken(){return localStorage.getItem(At)}async getUser(){try{const t=this.getAuthToken();if(!t)throw new Error("No auth token found. User is not authenticated.");const e=await fetch(`${this.baseUrl}/user/`,{headers:{Authorization:`Bearer ${t}`}});if(!e.ok)throw new Error("Failed to fetch user data.");return await e.json()}catch(t){throw new Error(t instanceof Error?t.message:"An error occurred while fetching user data.")}}getRefreshToken(){return localStorage.getItem(Bt)}isLoggedIn(){const t=this.getRefreshToken();return t?!this.isTokenExpired(t):!1}isTokenExpired(t){try{const e=hr(t);if(!(e!=null&&e.exp))return!0;const n=e.exp*1e3;return Date.now()>n}catch{return!0}}}class dr{constructor(t){this.canvasManager=t,this.container=document.createElement("div"),this.container.style.position="absolute",this.container.style.right="12px",this.container.style.bottom="12px",this.container.style.display="flex",this.container.style.flexDirection="column",this.container.style.gap="6px",this.container.style.background="rgba(255,255,255,0.95)",this.container.style.borderRadius="10px",this.container.style.boxShadow="0 2px 10px rgba(0,0,0,0.08)",this.container.style.padding="6px";const e="secondary",n=L.createButton({text:"+",variant:e,size:"icon-lg",onClick:()=>this.canvasManager.zoomIn(),tooltip:"Zoom In"}).createElement(),i=L.createButton({text:"-",variant:e,size:"icon-lg",onClick:()=>this.canvasManager.zoomOut(),tooltip:"Zoom Out"}).createElement(),r=L.createButton({text:"⦿",variant:e,size:"icon-lg",onClick:()=>this.canvasManager.centerCanvas(),tooltip:"Center Canvas"}).createElement();this.container.appendChild(n),this.container.appendChild(i),this.container.appendChild(r)}mount(t=document.body){t.appendChild(this.container)}unmount(){this.container.remove()}}class ur{constructor(t){this.canvasManager=t,this.container=document.createElement("div"),this.container.style.position="absolute",this.container.style.left="12px",this.container.style.bottom="12px",this.container.style.background="rgba(255,255,255,0.95)",this.container.style.borderRadius="8px",this.container.style.boxShadow="0 1px 4px rgba(0,0,0,0.08)",this.container.style.padding="6px 16px",this.container.style.fontSize="1.1rem",this.container.style.fontWeight="500",this.container.style.color="#222",this.valueEl=document.createElement("span"),this.container.appendChild(this.valueEl),this.update(),this.canvasManager.panZoom.onZoomChange(()=>this.update())}mount(t=document.body){t.appendChild(this.container)}update(){const t=Math.round(this.canvasManager.panZoom.scale*100);this.valueEl.textContent=`${t}%`}unmount(){this.container.remove()}}class pr{constructor(t,e){this.scene=t,this.canvasManager=e,this.container=this.createToolbarContainer(),this.addButtons()}createToolbarContainer(){const t=document.createElement("div");return t.className="canvas-toolbar",t.style.position="absolute",t.style.top="12px",t.style.left="50%",t.style.transform="translateX(-50%)",t.style.display="flex",t.style.gap="6px",t.style.padding="6px",t.style.background="white",t.style.borderRadius="10px",t.style.boxShadow="0 2px 10px rgba(0,0,0,0.1)",t.style.zIndex="100",t}addButtons(){L.createButton({text:"Select",variant:"secondary",onClick:()=>this.handleSelectMode(),tooltip:"Select elements on canvas",size:"lg"}).createElement();const t=L.createButton({text:"Task",variant:"secondary",onClick:()=>this.createTask(),tooltip:"Create a new task on canvas",size:"lg"}).createElement(),e=L.createButton({text:"Story",variant:"secondary",onClick:()=>this.createStory(),tooltip:"Create a new story on canvas",size:"lg"}).createElement(),n=L.createButton({text:"Goal",variant:"secondary",onClick:()=>this.createGoal(),tooltip:"Create a new goal on canvas",size:"lg"}).createElement();this.container.appendChild(t),this.container.appendChild(e),this.container.appendChild(n)}handleSelectMode(){console.log("Select mode activated")}createTask(){const t=this.canvasManager.canvas.width/2,e=this.canvasManager.canvas.height/2,n=this.canvasManager.getPanZoomManager(),i=(t+n.scrollX)/n.scale-P.width/2,r=(e+n.scrollY)/n.scale-P.height/2,o=new P({x:i,y:r});this.scene.addElement(o),this.scene.setSelected([o]),this.canvasManager.draw(),B("Task created","success")}createStory(){const t=this.canvasManager.canvas.width/2,e=this.canvasManager.canvas.height/2,n=this.canvasManager.getPanZoomManager(),i=(t+n.scrollX)/n.scale-O.width/2,r=(e+n.scrollY)/n.scale-O.height/2,o=new O({x:i,y:r});this.scene.addElement(o),this.scene.setSelected([o]),this.canvasManager.draw(),B("Story created","success")}createGoal(){const t=this.canvasManager.canvas.width/2,e=this.canvasManager.canvas.height/2,n=this.canvasManager.getPanZoomManager(),i=(t+n.scrollX)/n.scale-100,r=(e+n.scrollY)/n.scale-60,o=new ft({x:i,y:r});this.scene.addElement(o),this.scene.setSelected([o]),this.canvasManager.draw(),B("Goal created","success")}mount(t=document.body){t.appendChild(this.container)}unmount(){this.container.parentElement&&this.container.parentElement.removeChild(this.container)}}class fr{constructor(t,e){this.element=t,this.scene=e,this.modal=null}show(){const t=this.element instanceof P?"Task":this.element instanceof O?"Story":"Goal",{overlay:e,container:n}=Cn(`Edit ${t}`,{onClose:()=>this.close()});let i=this.element.title,r=this.element.description,o=this.element.status,c=this.element.priority;const a=document.createElement("div");a.className="mb-4";const l=document.createElement("label");l.className="block text-sm font-medium text-gray-700",l.textContent="Title",a.appendChild(l),L.createInput({value:i,onChange:I=>{i=I},autoFocus:!0,className:"w-full"}).render(a),n.appendChild(a);const d=document.createElement("div");d.className="mb-4";const u=document.createElement("label");u.className="block text-sm font-medium text-gray-700",u.textContent="Description",d.appendChild(u);const p=document.createElement("textarea");p.value=r,p.className="w-full border rounded p-2",p.rows=3,p.addEventListener("input",I=>{r=I.target.value}),d.appendChild(p),n.appendChild(d);const f=document.createElement("div");f.className="mb-4";const m=document.createElement("label");m.className="block text-sm font-medium text-gray-700",m.textContent="Status",f.appendChild(m),L.createSelect({items:hi,selectedValue:o,onChange:I=>{o=I},className:"w-full"}).render(f),n.appendChild(f);const v=document.createElement("div");v.className="mb-4";const w=document.createElement("label");w.className="block text-sm font-medium text-gray-700",w.textContent="Priority",v.appendChild(w),L.createSelect({items:[{value:"low",label:"Low"},{value:"medium",label:"Medium"},{value:"high",label:"High"}],selectedValue:c,onChange:I=>{c=I},className:"w-full"}).render(v),n.appendChild(v);const k=()=>{this.element.title=i,this.element.description=r,this.element.status=o,this.element.priority=c,this.scene.changes.next(),B("Saved!","success"),this.close()},T=document.createElement("div");T.className="flex justify-end space-x-2",L.createButton({text:"Cancel",onClick:()=>this.close(),variant:"outline"}).render(T),L.createButton({text:"Save",onClick:k,variant:"default"}).render(T),n.appendChild(T),n.addEventListener("keydown",I=>{I.stopPropagation(),I.key==="Enter"&&(I.preventDefault(),k()),I.key==="Escape"&&(I.preventDefault(),this.close())}),this.modal=e}close(){this.modal&&(this.modal.remove(),this.modal=null)}}class mr{constructor(){this.subscription=null,this.container=document.createElement("div"),this.container.className="fixed top-4 right-4 flex flex-col space-y-2 z-50"}mount(t=document.body){t.appendChild(this.container),this.subscription=kn.subscribe(({message:e,type:n})=>{const i=new or({message:e,type:n,onDismiss:()=>i.getElement().remove()});i.render(this.container),setTimeout(()=>i.getElement().remove(),3e3)})}unmount(){var t;(t=this.subscription)==null||t.unsubscribe(),this.container.parentElement&&this.container.remove()}}class gr{constructor(t){this.toolbarContainer=t,this.container=document.createElement("div"),this.container.style.position="absolute",this.container.style.display="flex",this.container.style.gap="6px",this.container.style.background="rgba(255,255,255,0.95)",this.container.style.borderRadius="10px",this.container.style.boxShadow="0 2px 10px rgba(0,0,0,0.08)",this.container.style.padding="6px",this.container.style.zIndex="100";const e="secondary";this.undoBtn=L.createButton({text:"↺",variant:e,size:"icon-lg",onClick:()=>M.undo(),tooltip:"Undo"}).createElement(),this.undoBtn.style.transform="rotate(-90deg)",this.redoBtn=L.createButton({text:"↻",variant:e,size:"icon-lg",onClick:()=>M.redo(),tooltip:"Redo"}).createElement(),this.redoBtn.style.transform="rotate(90deg)",this.container.appendChild(this.undoBtn),this.container.appendChild(this.redoBtn),this.subscription=M.changes.subscribe(()=>this.updateButtons()),this.updateButtons()}mount(t=document.body){const e=this.toolbarContainer.getBoundingClientRect();this.container.style.left=`${e.right+12}px`,this.container.style.top=`${e.top}px`,t.appendChild(this.container)}updateButtons(){this.undoBtn.disabled=!M.canUndo(),this.redoBtn.disabled=!M.canRedo()}unmount(){this.subscription.unsubscribe(),this.container.remove()}}var br=Object.defineProperty,vr=(s,t,e)=>t in s?br(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e,_=(s,t,e)=>vr(s,typeof t!="symbol"?t+"":t,e),lt=(s=>(s.POST="POST",s.GET="GET",s.PUT="PUT",s.PATCH="PATCH",s.DELETE="DELETE",s))(lt||{});class Pt{static for(t,e){return{cache:t.cache,mode:t.mode,credentials:t.credentials,headers:t.headers,redirect:t.redirect,referrer:t.referrer,method:e,body:this.formatBody(t,e)}}static formatBody(t,e){var n;return e===lt.GET||!t.body?null:((n=t.body)==null?void 0:n.constructor)===Object?JSON.stringify(t.body):t.body}}function Lt(){return function(s){return s.pipe(be(t=>t.ok?gs(t):vt(()=>t)))}}class je{constructor(t){_(this,"_interceptors"),this._interceptors=t}execute(t){return this._interceptors.length>0?this._interceptors.reduce((e,n)=>n.intercept(e),t):t}}const yr=/https?:\/\/(www\.)?[-a-zA-Z0-9@:%._\+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b([-a-zA-Z0-9()@:%_\+.~#?&//=]*)?/gi;class ht{constructor(t,e){_(this,"url"),_(this,"headers"),_(this,"mode"),_(this,"cache"),_(this,"credentials"),_(this,"redirect"),_(this,"referrer"),_(this,"body"),this.url=new RegExp(yr).test(t)?t:`${window.location.origin}${t}`,this.mode=e.mode||void 0,this.cache=e.cache||void 0,this.credentials=e.credentials||void 0,this.headers=e.headers||{},this.redirect=e.redirect||void 0,this.referrer=e.referrer||void 0,this.body=e.body||void 0}clone(){return new ht(this.url,{body:this.body,cache:this.cache,mode:this.mode,credentials:this.credentials,headers:this.headers,redirect:this.redirect,referrer:this.referrer})}}class dt{constructor(t){_(this,"headers"),_(this,"ok"),_(this,"redirected"),_(this,"status"),_(this,"statusText"),_(this,"type"),_(this,"url"),_(this,"_response"),this._response=t,this.headers=t.headers,this.ok=t.ok,this.redirected=t.redirected,this.status=t.status,this.statusText=t.statusText,this.type=t.type,this.url=t.url}arrayBuffer(){return Z(this._response.arrayBuffer())}blob(){return Z(this._response.blob())}formData(){return Z(this._response.formData())}json(){return Z(this._response.json())}text(){return Z(this._response.text())}clone(){return new dt(this._response.clone())}}class wr{constructor(t=[],e=[]){_(this,"_reqInterceptors"),_(this,"_resInterceptors"),this._reqInterceptors=new je(t),this._resInterceptors=new je(e)}get(t,e={}){const n=this._reqInterceptors.execute(new ht(t,e)),i=Pt.for(n,lt.GET);return Z(fetch(t,i)).pipe(ct(r=>this._resInterceptors.execute(new dt(r))),Lt())}post(t,e){const n=this._reqInterceptors.execute(new ht(t,e)),i=Pt.for(n,lt.POST);return Z(fetch(t,i)).pipe(ct(r=>this._resInterceptors.execute(new dt(r))),Lt())}put(t,e){const n=this._reqInterceptors.execute(new ht(t,e)),i=Pt.for(n,lt.PUT);return Z(fetch(t,i)).pipe(ct(r=>this._resInterceptors.execute(new dt(r))),Lt())}patch(t,e){const n=this._reqInterceptors.execute(new ht(t,e)),i=Pt.for(n,lt.PATCH);return Z(fetch(t,i)).pipe(ct(r=>this._resInterceptors.execute(new dt(r))),Lt())}delete(t,e){const n=this._reqInterceptors.execute(new ht(t,e)),i=Pt.for(n,lt.DELETE);return Z(fetch(t,i)).pipe(ct(r=>this._resInterceptors.execute(new dt(r))),Lt())}}class xr{constructor(t){this.baseUrl=t,this.client=new wr,this.authService=new xe(this.baseUrl)}attachAuth(t={}){const e=localStorage.getItem(At);return{...t,Authorization:e?`Bearer ${e}`:""}}getRefreshedAccessToken(){return this.refreshAccessToken$||(this.refreshAccessToken$=Z(this.authService.refreshToken()).pipe(ct(({access:t})=>t),Ss(()=>{this.refreshAccessToken$=void 0}),Cs(1))),this.refreshAccessToken$}get(t,e={}){const n=this.authService;let i=this.attachAuth(e.headers);const r=n.getAuthToken();return(r&&n.isTokenExpired(r)?this.getRefreshedAccessToken().pipe($(c=>(i=this.attachAuth(e.headers),this.client.get(`${this.baseUrl}${t}`,{...e,headers:i})))):this.client.get(`${this.baseUrl}${t}`,{...e,headers:i})).pipe($(c=>Z(c.json())),yt(c=>c.status===401?this.getRefreshedAccessToken().pipe($(a=>(i=this.attachAuth(e.headers),this.client.get(`${this.baseUrl}${t}`,{...e,headers:i})))):(console.error("GET Error:",c),vt(()=>c))))}post(t,e,n={}){const i=this.authService;let r=this.attachAuth(n.headers);const o=i.getAuthToken();return(o&&i.isTokenExpired(o)?this.getRefreshedAccessToken().pipe($(a=>(r=this.attachAuth(n.headers),this.client.post(`${this.baseUrl}${t}`,e,{...n,headers:r})))):this.client.post(`${this.baseUrl}${t}`,e,{...n,headers:r})).pipe(yt(a=>a.status===401?this.getRefreshedAccessToken().pipe($(l=>(r=this.attachAuth(n.headers),this.client.post(`${this.baseUrl}${t}`,e,{...n,headers:r})))):(console.error("POST Error:",a),vt(()=>a))))}put(t,e,n={}){const i=this.authService;let r=this.attachAuth(n.headers);const o=i.getAuthToken();return(o&&i.isTokenExpired(o)?this.getRefreshedAccessToken().pipe($(a=>(r=this.attachAuth(n.headers),this.client.put(`${this.baseUrl}${t}`,e,{...n,headers:r})))):this.client.put(`${this.baseUrl}${t}`,e,{...n,headers:r})).pipe(yt(a=>a.status===401?this.getRefreshedAccessToken().pipe($(l=>(r=this.attachAuth(n.headers),this.client.put(`${this.baseUrl}${t}`,e,{...n,headers:r})))):(console.error("PUT Error:",a),vt(()=>a))))}patch(t,e,n={}){const i=this.authService;let r=this.attachAuth(n.headers);const o=i.getAuthToken();return(o&&i.isTokenExpired(o)?this.getRefreshedAccessToken().pipe($(a=>(r=this.attachAuth(n.headers),this.client.patch(`${this.baseUrl}${t}`,e,{...n,headers:r})))):this.client.patch(`${this.baseUrl}${t}`,e,{...n,headers:r})).pipe(yt(a=>a.status===401?this.getRefreshedAccessToken().pipe($(l=>(r=this.attachAuth(n.headers),this.client.patch(`${this.baseUrl}${t}`,e,{...n,headers:r})))):(console.error("PATCH Error:",a),vt(()=>a))))}delete(t,e={}){const n=this.authService;let i=this.attachAuth(e.headers);const r=n.getAuthToken();return(r&&n.isTokenExpired(r)?this.getRefreshedAccessToken().pipe($(c=>(i=this.attachAuth(e.headers),this.client.delete(`${this.baseUrl}${t}`,{...e,headers:i})))):this.client.delete(`${this.baseUrl}${t}`,{...e,headers:i})).pipe($(c=>Z(c.json())),yt(c=>c.status===401?this.getRefreshedAccessToken().pipe($(a=>(i=this.attachAuth(e.headers),this.client.delete(`${this.baseUrl}${t}`,{...e,headers:i})))):(console.error("DELETE Error:",c),vt(()=>c))))}}class Sr{constructor(t){this.http=t}getTasks(t){let e="";if(t){const n=[];t.is_standalone!==void 0&&n.push(`is_standalone=${encodeURIComponent(t.is_standalone.toString())}`),t.project!==void 0&&n.push(`project=${encodeURIComponent(t.project.toString())}`),t.stage!==void 0&&n.push(`stage=${encodeURIComponent(t.stage.toString())}`),t.goal!==void 0&&n.push(`goal=${encodeURIComponent(t.goal.toString())}`),t.resolvedDateAfter&&n.push(`resolved_date_range_after=${encodeURIComponent(t.resolvedDateAfter)}`),t.resolvedDateBefore&&n.push(`resolved_date_range_before=${encodeURIComponent(t.resolvedDateBefore)}`),n.length&&(e=`?${n.join("&")}`)}return this.http.get(`/tasks/${e}`)}getTask(t){return this.http.get(`/tasks/${t}/`)}createTask(t){return this.http.post("/tasks/",t)}updateTask(t,e){return this.http.put(`/tasks/${t}/`,e)}deleteTask(t){return this.http.delete(`/tasks/${t}/`)}getTags(){return this.http.get("/tags/")}createSubtask(t){return this.http.post("/subtasks/",t)}updateSubtask(t,e){return this.http.put(`/subtasks/${t}/`,e)}deleteSubtask(t){return this.http.delete(`/subtasks/${t}/`)}deleteAllTaskSubtasks(t){return Z(t.subtasks).pipe(be(e=>this.deleteSubtask(e.id)),xs())}}class Er{constructor(t){this.http=t}getStories(){return this.http.get("/stories/")}getStory(t){return this.http.get(`/stories/${t}/`)}createStory(t){return this.http.post("/stories/",t)}updateStory(t,e){return this.http.put(`/stories/${t}/`,e)}deleteStory(t){return this.http.delete(`/stories/${t}/`)}}class Cr{constructor(t){this.http=t}getGoals(){return this.http.get("/goals/")}getGoal(t){return this.http.get(`/goals/${t}/`)}createGoal(t){return this.http.post("/goals/",t,{headers:{}})}updateGoal(t,e){return this.http.put(`/goals/${t}/`,e,{headers:{}})}deleteGoal(t){return this.http.delete(`/goals/${t}/`,{headers:{}})}}class kr{constructor(t){this.scene=t,this.isOpen=!1,this.container=document.createElement("div"),this.container.className="absolute top-4 left-4 z-20 bg-white p-2 rounded shadow-lg";const e=document.createElement("button");e.textContent="+ Add Element",e.className="bg-blue-600 text-white px-3 py-1 rounded focus:outline-none hover:bg-blue-700",this.container.appendChild(e),this.panel=document.createElement("div"),this.panel.className="mt-2 bg-white border border-gray-300 rounded shadow-lg p-2 w-64 max-h-96 overflow-auto",this.panel.style.display="none";const n=document.createElement("input");n.type="search",n.placeholder="Search...",n.className="border border-gray-300 rounded px-2 py-1 w-full mb-2 focus:outline-none",this.panel.appendChild(n),["Task","Story","Goal"].forEach(l=>{const h=document.createElement("div");h.className="mb-4";const d=document.createElement("h3");d.className="font-semibold text-gray-700 mb-1",d.textContent=l+"s",h.appendChild(d);const u=document.createElement("ul");u.className=`list-disc pl-5 space-y-1 h-32 overflow-y-auto palette-${l.toLowerCase()}`,h.appendChild(u),this.panel.appendChild(h)}),this.container.appendChild(this.panel),e.addEventListener("click",()=>{this.isOpen=!this.isOpen,this.panel.style.display=this.isOpen?"block":"none"});const i=new xr(Nn.apiUrl),r=new Sr(i),o=new Er(i),c=new Cr(i),a={task:this.panel.querySelector(".palette-task"),story:this.panel.querySelector(".palette-story"),goal:this.panel.querySelector(".palette-goal")};r.getTasks().subscribe(l=>{console.log("tasks response:",l),l.forEach(h=>{const d=document.createElement("li");d.textContent=h.title,d.draggable=!0,d.addEventListener("dragstart",u=>{const p=u.dataTransfer;p&&(p.setData("application/json",JSON.stringify({type:"task",dto:h})),p.effectAllowed="copy")}),a.task.appendChild(d)})}),o.getStories().subscribe(l=>{console.log("stories response:",l),l.forEach(h=>{const d=document.createElement("li");d.textContent=h.title,d.draggable=!0,d.addEventListener("dragstart",u=>{const p=u.dataTransfer;p&&(p.setData("application/json",JSON.stringify({type:"story",dto:h})),p.effectAllowed="copy")}),a.story.appendChild(d)})}),c.getGoals().subscribe(l=>{console.log("goals response:",l),l.forEach(h=>{const d=document.createElement("li");d.textContent=h.title,d.draggable=!0,d.addEventListener("dragstart",u=>{const p=u.dataTransfer;p&&(p.setData("application/json",JSON.stringify({type:"goal",dto:h})),p.effectAllowed="copy")}),a.goal.appendChild(d)})}),n.addEventListener("input",()=>{const l=n.value.toLowerCase();[a.task,a.story,a.goal].forEach(h=>{Array.from(h.children).forEach(d=>{const u=d,p=u.textContent||"";u.style.display=p.toLowerCase().includes(l)?"":"none"})})})}mount(t=document.body){t.appendChild(this.container)}unmount(){this.container.remove()}}class Ir{constructor(t){this.scene=t,this.authService=new xe,this.container=document.createElement("div"),this.container.className="absolute top-5 right-20 z-20",this.container.style.display="none",this.button=new zn({text:"Save",variant:"success",disabled:!0,onClick:()=>{this.authService.isLoggedIn()?window.dispatchEvent(new CustomEvent("saveCanvasLayout")):window.dispatchEvent(new CustomEvent("showLoginModal"))}}).createElement(),this.container.appendChild(this.button),M.changes.subscribe(()=>this.updateButton()),window.addEventListener("refreshCanvasData",()=>this.updateButton()),this.updateButton()}updateButton(){const t=M.canUndo();this.container.style.display=this.authService.isLoggedIn()?"block":"none",this.button.disabled=!t}mount(t=document.body){t.appendChild(this.container)}unmount(){this.container.remove()}}var at=(s=>(s.Active="active",s.Completed="completed",s.Archived="archived",s.Described="described",s.Draft="draft",s.Cancelled="cancelled",s))(at||{});function oe(s){switch(s){case at.Active:return X.InProgress;case at.Completed:return X.Done;case at.Archived:return X.Done;case at.Described:return X.Pending;case at.Draft:return X.Defined;case at.Cancelled:return X.Done;default:return X.Defined}}class Tr{constructor(t,e){this.canvasManager=t,this.scene=e,this.components=[],this.canvasToolbar=new pr(this.scene,this.canvasManager),this.canvasControls=new dr(this.canvasManager),this.zoomIndicator=new ur(this.canvasManager),this.undoRedoControls=new gr(this.canvasToolbar.container);const n=new kr(this.scene),i=new Ir(this.scene);this.components.push(this.canvasControls,this.zoomIndicator,n,i,this.canvasToolbar,this.undoRedoControls);const r=new mr;this.components.push(r),qt.subscribe(o=>new fr(o,this.scene).show())}mountAll(t=document.body){this.components.forEach(n=>n.mount(t));const e=this.canvasManager.getCanvas();e.addEventListener("dragover",n=>n.preventDefault()),e.addEventListener("drop",n=>{var u;n.preventDefault();const i=(u=n.dataTransfer)==null?void 0:u.getData("application/json");if(!i)return;const{type:r,dto:o}=JSON.parse(i),c=e.getBoundingClientRect(),a=this.canvasManager.getPanZoomManager(),l=(n.clientX-c.left+a.scrollX)/a.scale,h=(n.clientY-c.top+a.scrollY)/a.scale;let d;r==="task"?d=new P({...o,status:oe(o.status),x:l,y:h}):r==="story"?d=new O({...o,status:oe(o.status),x:l,y:h}):r==="goal"&&(d=new ft({...o,status:oe(o.status),x:l,y:h})),d&&this.scene.addElement(d)})}unmountAll(){this.components.forEach(t=>t.unmount())}}class Mr{constructor(){this.handlers=new Map,document.addEventListener("keydown",this.handleKeyDown.bind(this))}register(t,e){const n=t.toLowerCase();this.handlers.has(n)||this.handlers.set(n,[]),this.handlers.get(n).push(e)}unregister(t,e){const n=t.toLowerCase();if(this.handlers.has(n))if(!e)this.handlers.delete(n);else{const i=this.handlers.get(n).filter(r=>r!==e);i.length?this.handlers.set(n,i):this.handlers.delete(n)}}handleKeyDown(t){if(jt.isOpen()||document.querySelector('[role="dialog"]'))return;const e=t.target;if(e.tagName==="INPUT"||e.tagName==="TEXTAREA"||e.tagName==="SELECT"||e.isContentEditable)return;const n=this.normalize(t),i=this.handlers.get(n)||[];i.length&&(t.preventDefault(),t.stopPropagation(),i.forEach(r=>r(t)))}normalize(t){const e=[];return t.ctrlKey&&e.push("ctrl"),t.shiftKey&&e.push("shift"),t.altKey&&e.push("alt"),t.metaKey&&e.push("meta"),e.push(t.key.toLowerCase()),e.join("+")}}const Pr=new Mr;class Lr{constructor(){this.commands=new Map}register(t,e){this.commands.set(t,e)}bindShortcut(t,e){if(!this.commands.has(t)){console.warn(`Command "${t}" is not registered.`);return}Pr.register(e,()=>{this.execute(t)})}execute(t){const e=this.commands.get(t);e?e():console.warn(`No handler found for command "${t}".`)}list(){return Array.from(this.commands.keys())}}const Ve=new Lr;class Rr{constructor(){this.items=[]}copy(t){this.items=t.map(e=>{const n=e.clone();return n.id=pt(),n})}paste(t,e){if(!e||this.items.length===0)return[];let n=1/0,i=1/0,r=-1/0,o=-1/0;this.items.forEach(u=>{const p=u.x,f=u.y,m=u.width||0,S=u.height||0;n=Math.min(n,p),i=Math.min(i,f),r=Math.max(r,p+m),o=Math.max(o,f+S)});const c=n+(r-n)/2,a=i+(o-i)/2,l=e.x-c,h=e.y-a;return this.items.map(u=>{const p=u.clone();return p.id=pt(),p.x=u.x+l,p.y=u.y+h,t.addElement(p),p})}clear(){this.items=[]}getItems(){return this.items}}const Vt=new Rr;class Ar extends F{constructor(t){super(),this.scene=t,this.elements=[]}execute(){const t=this.scene.getSelectedElements().filter(e=>e instanceof Ct);this.elements=t,Vt.copy(this.elements),B(`Copied ${this.elements.length} items`,"info")}undo(){Vt.clear(),B("Clipboard cleared","info")}}class Dr extends F{constructor(t,e){super(),this.scene=t,this.canvasManager=e,this.clones=[]}execute(){let t=this.canvasManager.getLastMouseCoords();if(!t){const e=this.canvasManager.getCanvas(),n=this.canvasManager.getPanZoomManager();t={x:(e.width/2+n.scrollX)/n.scale,y:(e.height/2+n.scrollY)/n.scale}}this.clones=Vt.paste(this.scene,t),B(`Pasted ${this.clones.length} items`,"success")}undo(){this.clones.forEach(t=>this.scene.removeElement(t)),B(`Undid paste of ${this.clones.length} items`,"info")}}class _r extends F{constructor(t){super(),this.elements=[],this.scene=t}execute(){const t=this.scene.getSelectedElements().filter(e=>e instanceof Ct);this.elements=t,Vt.copy(this.elements),this.scene.removeElements(this.elements),B(`Cut ${this.elements.length} items`,"info")}undo(){this.elements.forEach(t=>this.scene.addElement(t)),B(`Restored ${this.elements.length} items`,"success")}}class Or extends F{constructor(t,e){super(),this.scene=t,this.elements=[...e]}execute(){this.scene.removeElements(this.elements)}undo(){this.elements.forEach(t=>this.scene.addElement(t))}}class zr extends F{constructor(t){super(),this.canvasManager=t}execute(){const t=this.canvasManager.getPanZoomManager();this.prevState={scrollX:t.scrollX,scrollY:t.scrollY,scale:t.scale},this.canvasManager.zoomIn()}undo(){this.canvasManager.getPanZoomManager().setViewState(this.prevState),this.canvasManager.draw()}}class Nr extends F{constructor(t){super(),this.canvasManager=t}execute(){const t=this.canvasManager.getPanZoomManager();this.prevState={scrollX:t.scrollX,scrollY:t.scrollY,scale:t.scale},this.canvasManager.zoomOut()}undo(){this.canvasManager.getPanZoomManager().setViewState(this.prevState),this.canvasManager.draw()}}class $t extends F{constructor(t,e,n){super(),this.canvasManager=t,this.dx=e,this.dy=n}execute(){const t=this.canvasManager.getPanZoomManager();this.prevState={scrollX:t.scrollX,scrollY:t.scrollY,scale:t.scale},t.scrollX+=this.dx,t.scrollY+=this.dy,t.clampScroll(),this.canvasManager.draw()}undo(){this.canvasManager.getPanZoomManager().setViewState(this.prevState),this.canvasManager.draw()}}function Yr(s,t){return[{name:"undo",handler:()=>M.undo(),keys:["ctrl+z","meta+z"]},{name:"redo",handler:()=>M.redo(),keys:["ctrl+y","meta+y","meta+shift+z"]},{name:"copy",handler:()=>M.execute(new Ar(s)),keys:["ctrl+c","meta+c"]},{name:"paste",handler:()=>M.execute(new Dr(s,t)),keys:["ctrl+v","meta+v"]},{name:"cut",handler:()=>M.execute(new _r(s)),keys:["ctrl+x","meta+x"]},{name:"delete",handler:()=>{const e=s.getSelectedElements();M.execute(new Or(s,e))},keys:["delete","backspace"]},{name:"zoomIn",handler:()=>M.execute(new zr(t)),keys:["]","ї"]},{name:"zoomOut",handler:()=>M.execute(new Nr(t)),keys:["[","х"]},{name:"panLeft",handler:()=>M.execute(new $t(t,-50,0)),keys:["arrowleft"]},{name:"panRight",handler:()=>M.execute(new $t(t,50,0)),keys:["arrowright"]},{name:"panUp",handler:()=>M.execute(new $t(t,0,-50)),keys:["arrowup"]},{name:"panDown",handler:()=>M.execute(new $t(t,0,50)),keys:["arrowdown"]}]}class Zr{constructor(t){this.dataProvider=t;const e=document.getElementById("myCanvas");if(!e||!(e instanceof HTMLCanvasElement))throw new Error("Canvas element not found");this.canvas=e,this.scene=new yi,this.canvasManager=new vi(this.canvas,this.scene),this.diagramRepository=new wi(t),this.authService=new xe;const n=document.getElementById("app")||document.body;this.authComponent=new ar(n,this.authService),this.uiManager=new Tr(this.canvasManager,this.scene),this.uiManager.mountAll(document.body),Yr(this.scene,this.canvasManager).forEach(i=>{Ve.register(i.name,i.handler),i.keys.forEach(r=>Ve.bindShortcut(i.name,r))})}async init(){this.canvasManager.init(),await this.diagramRepository.loadDiagram(this.scene);const t=await this.dataProvider.loadViewState(),e=this.canvasManager.getPanZoomManager();e.setViewState(t),this.canvasManager.draw(),e.viewChanges.subscribe(n=>this.dataProvider.saveViewState(n)),this.scene.changes.subscribe(()=>this.diagramRepository.saveDiagram(this.scene))}}const Fe="canvas-tasks",qe="canvas-dependencies",Ke="canvas-stories",Je="canvas-view",Qe="canvas-goals";class Xr{async loadTasks(){const t=localStorage.getItem(Fe);return t?JSON.parse(t):[]}async loadDependencies(){const t=localStorage.getItem(qe);return t?JSON.parse(t):[]}async loadStories(){const t=localStorage.getItem(Ke);return t?JSON.parse(t):[]}async loadGoals(){const t=localStorage.getItem(Qe);return t?JSON.parse(t):[]}async saveTasks(t){localStorage.setItem(Fe,JSON.stringify(t))}async saveDependencies(t){localStorage.setItem(qe,JSON.stringify(t))}async saveStories(t){localStorage.setItem(Ke,JSON.stringify(t))}async saveGoals(t){localStorage.setItem(Qe,JSON.stringify(t))}async loadViewState(){const t=localStorage.getItem(Je);return t?JSON.parse(t):{scrollX:0,scrollY:0,scale:1.4}}async saveViewState(t){localStorage.setItem(Je,JSON.stringify(t))}}document.addEventListener("DOMContentLoaded",()=>{const s=new Xr;new Zr(s).init()});
