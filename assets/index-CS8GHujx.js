(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function e(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(n){if(n.ep)return;n.ep=!0;const o=e(n);fetch(n.href,o)}})();var Ot=function(i,t){return Ot=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,s){e.__proto__=s}||function(e,s){for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&(e[n]=s[n])},Ot(i,t)};function Ct(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");Ot(i,t);function e(){this.constructor=i}i.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}function _t(i){var t=typeof Symbol=="function"&&Symbol.iterator,e=t&&i[t],s=0;if(e)return e.call(i);if(i&&typeof i.length=="number")return{next:function(){return i&&s>=i.length&&(i=void 0),{value:i&&i[s++],done:!i}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function Nt(i,t){var e=typeof Symbol=="function"&&i[Symbol.iterator];if(!e)return i;var s=e.call(i),n,o=[],r;try{for(;(t===void 0||t-- >0)&&!(n=s.next()).done;)o.push(n.value)}catch(a){r={error:a}}finally{try{n&&!n.done&&(e=s.return)&&e.call(s)}finally{if(r)throw r.error}}return o}function Yt(i,t,e){if(e||arguments.length===2)for(var s=0,n=t.length,o;s<n;s++)(o||!(s in t))&&(o||(o=Array.prototype.slice.call(t,0,s)),o[s]=t[s]);return i.concat(o||Array.prototype.slice.call(t))}function H(i){return typeof i=="function"}function Te(i){var t=function(s){Error.call(s),s.stack=new Error().stack},e=i(t);return e.prototype=Object.create(Error.prototype),e.prototype.constructor=e,e}var Lt=Te(function(i){return function(e){i(this),this.message=e?e.length+` errors occurred during unsubscription:
`+e.map(function(s,n){return n+1+") "+s.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=e}});function Xt(i,t){if(i){var e=i.indexOf(t);0<=e&&i.splice(e,1)}}var kt=function(){function i(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._finalizers=null}return i.prototype.unsubscribe=function(){var t,e,s,n,o;if(!this.closed){this.closed=!0;var r=this._parentage;if(r)if(this._parentage=null,Array.isArray(r))try{for(var a=_t(r),l=a.next();!l.done;l=a.next()){var h=l.value;h.remove(this)}}catch(b){t={error:b}}finally{try{l&&!l.done&&(e=a.return)&&e.call(a)}finally{if(t)throw t.error}}else r.remove(this);var c=this.initialTeardown;if(H(c))try{c()}catch(b){o=b instanceof Lt?b.errors:[b]}var d=this._finalizers;if(d){this._finalizers=null;try{for(var u=_t(d),f=u.next();!f.done;f=u.next()){var p=f.value;try{oe(p)}catch(b){o=o??[],b instanceof Lt?o=Yt(Yt([],Nt(o)),Nt(b.errors)):o.push(b)}}}catch(b){s={error:b}}finally{try{f&&!f.done&&(n=u.return)&&n.call(u)}finally{if(s)throw s.error}}}if(o)throw new Lt(o)}},i.prototype.add=function(t){var e;if(t&&t!==this)if(this.closed)oe(t);else{if(t instanceof i){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=(e=this._finalizers)!==null&&e!==void 0?e:[]).push(t)}},i.prototype._hasParent=function(t){var e=this._parentage;return e===t||Array.isArray(e)&&e.includes(t)},i.prototype._addParent=function(t){var e=this._parentage;this._parentage=Array.isArray(e)?(e.push(t),e):e?[e,t]:t},i.prototype._removeParent=function(t){var e=this._parentage;e===t?this._parentage=null:Array.isArray(e)&&Xt(e,t)},i.prototype.remove=function(t){var e=this._finalizers;e&&Xt(e,t),t instanceof i&&t._removeParent(this)},i.EMPTY=function(){var t=new i;return t.closed=!0,t}(),i}(),Pe=kt.EMPTY;function Le(i){return i instanceof kt||i&&"closed"in i&&H(i.remove)&&H(i.add)&&H(i.unsubscribe)}function oe(i){H(i)?i():i.unsubscribe()}var $e={Promise:void 0},Ke={setTimeout:function(i,t){for(var e=[],s=2;s<arguments.length;s++)e[s-2]=arguments[s];return setTimeout.apply(void 0,Yt([i,t],Nt(e)))},clearTimeout:function(i){return clearTimeout(i)},delegate:void 0};function qe(i){Ke.setTimeout(function(){throw i})}function re(){}function vt(i){i()}var De=function(i){Ct(t,i);function t(e){var s=i.call(this)||this;return s.isStopped=!1,e?(s.destination=e,Le(e)&&e.add(s)):s.destination=ts,s}return t.create=function(e,s,n){return new Zt(e,s,n)},t.prototype.next=function(e){this.isStopped||this._next(e)},t.prototype.error=function(e){this.isStopped||(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,i.prototype.unsubscribe.call(this),this.destination=null)},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){try{this.destination.error(e)}finally{this.unsubscribe()}},t.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},t}(kt),Je=function(){function i(t){this.partialObserver=t}return i.prototype.next=function(t){var e=this.partialObserver;if(e.next)try{e.next(t)}catch(s){gt(s)}},i.prototype.error=function(t){var e=this.partialObserver;if(e.error)try{e.error(t)}catch(s){gt(s)}else gt(t)},i.prototype.complete=function(){var t=this.partialObserver;if(t.complete)try{t.complete()}catch(e){gt(e)}},i}(),Zt=function(i){Ct(t,i);function t(e,s,n){var o=i.call(this)||this,r;return H(e)||!e?r={next:e??void 0,error:s??void 0,complete:n??void 0}:r=e,o.destination=new Je(r),o}return t}(De);function gt(i){qe(i)}function Qe(i){throw i}var ts={closed:!0,next:re,error:Qe,complete:re},es=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function ss(i){return i}function ns(i){return i.length===0?ss:i.length===1?i[0]:function(e){return i.reduce(function(s,n){return n(s)},e)}}var ae=function(){function i(t){t&&(this._subscribe=t)}return i.prototype.lift=function(t){var e=new i;return e.source=this,e.operator=t,e},i.prototype.subscribe=function(t,e,s){var n=this,o=os(t)?t:new Zt(t,e,s);return vt(function(){var r=n,a=r.operator,l=r.source;o.add(a?a.call(o,l):l?n._subscribe(o):n._trySubscribe(o))}),o},i.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(e){t.error(e)}},i.prototype.forEach=function(t,e){var s=this;return e=le(e),new e(function(n,o){var r=new Zt({next:function(a){try{t(a)}catch(l){o(l),r.unsubscribe()}},error:o,complete:n});s.subscribe(r)})},i.prototype._subscribe=function(t){var e;return(e=this.source)===null||e===void 0?void 0:e.subscribe(t)},i.prototype[es]=function(){return this},i.prototype.pipe=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return ns(t)(this)},i.prototype.toPromise=function(t){var e=this;return t=le(t),new t(function(s,n){var o;e.subscribe(function(r){return o=r},function(r){return n(r)},function(){return s(o)})})},i.create=function(t){return new i(t)},i}();function le(i){var t;return(t=i??$e.Promise)!==null&&t!==void 0?t:Promise}function is(i){return i&&H(i.next)&&H(i.error)&&H(i.complete)}function os(i){return i&&i instanceof De||is(i)&&Le(i)}var rs=Te(function(i){return function(){i(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),it=function(i){Ct(t,i);function t(){var e=i.call(this)||this;return e.closed=!1,e.currentObservers=null,e.observers=[],e.isStopped=!1,e.hasError=!1,e.thrownError=null,e}return t.prototype.lift=function(e){var s=new ce(this,this);return s.operator=e,s},t.prototype._throwIfClosed=function(){if(this.closed)throw new rs},t.prototype.next=function(e){var s=this;vt(function(){var n,o;if(s._throwIfClosed(),!s.isStopped){s.currentObservers||(s.currentObservers=Array.from(s.observers));try{for(var r=_t(s.currentObservers),a=r.next();!a.done;a=r.next()){var l=a.value;l.next(e)}}catch(h){n={error:h}}finally{try{a&&!a.done&&(o=r.return)&&o.call(r)}finally{if(n)throw n.error}}}})},t.prototype.error=function(e){var s=this;vt(function(){if(s._throwIfClosed(),!s.isStopped){s.hasError=s.isStopped=!0,s.thrownError=e;for(var n=s.observers;n.length;)n.shift().error(e)}})},t.prototype.complete=function(){var e=this;vt(function(){if(e._throwIfClosed(),!e.isStopped){e.isStopped=!0;for(var s=e.observers;s.length;)s.shift().complete()}})},t.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(t.prototype,"observed",{get:function(){var e;return((e=this.observers)===null||e===void 0?void 0:e.length)>0},enumerable:!1,configurable:!0}),t.prototype._trySubscribe=function(e){return this._throwIfClosed(),i.prototype._trySubscribe.call(this,e)},t.prototype._subscribe=function(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)},t.prototype._innerSubscribe=function(e){var s=this,n=this,o=n.hasError,r=n.isStopped,a=n.observers;return o||r?Pe:(this.currentObservers=null,a.push(e),new kt(function(){s.currentObservers=null,Xt(a,e)}))},t.prototype._checkFinalizedStatuses=function(e){var s=this,n=s.hasError,o=s.thrownError,r=s.isStopped;n?e.error(o):r&&e.complete()},t.prototype.asObservable=function(){var e=new ae;return e.source=this,e},t.create=function(e,s){return new ce(e,s)},t}(ae),ce=function(i){Ct(t,i);function t(e,s){var n=i.call(this)||this;return n.destination=e,n.source=s,n}return t.prototype.next=function(e){var s,n;(n=(s=this.destination)===null||s===void 0?void 0:s.next)===null||n===void 0||n.call(s,e)},t.prototype.error=function(e){var s,n;(n=(s=this.destination)===null||s===void 0?void 0:s.error)===null||n===void 0||n.call(s,e)},t.prototype.complete=function(){var e,s;(s=(e=this.destination)===null||e===void 0?void 0:e.complete)===null||s===void 0||s.call(e)},t.prototype._subscribe=function(e){var s,n;return(n=(s=this.source)===null||s===void 0?void 0:s.subscribe(e))!==null&&n!==void 0?n:Pe},t}(it);class as{constructor(t){this.canvas=t,this.scrollX=0,this.scrollY=0,this.scale=1.4,this.virtualWidth=2e4,this.virtualHeight=12e3,this.scrollbarWidth=6,this.viewChanges=new it,this.zoomListeners=[]}clampScroll(){const t=this.canvas.width-this.scrollbarWidth,e=this.canvas.height-this.scrollbarWidth,s=Math.max(0,this.virtualWidth*this.scale-t),n=Math.max(0,this.virtualHeight*this.scale-e);this.scrollX=Math.min(Math.max(0,this.scrollX),s),this.scrollY=Math.min(Math.max(0,this.scrollY),n)}zoomIn(t){const e=this.scale,s=t.width/2,n=t.height/2,o=(s+this.scrollX)/e,r=(n+this.scrollY)/e,a=3;this.scale=Math.min(e*1.15,a),this.scrollX=o*this.scale-s,this.scrollY=r*this.scale-n,this.clampScroll(),this.emitZoomChange()}zoomOut(t){const e=this.scale,s=t.width/2,n=t.height/2,o=(s+this.scrollX)/e,r=(n+this.scrollY)/e,a=Math.max((t.width-this.scrollbarWidth)/this.virtualWidth,(t.height-this.scrollbarWidth)/this.virtualHeight);this.scale=Math.max(e/1.15,a),this.scrollX=o*this.scale-s,this.scrollY=r*this.scale-n,this.clampScroll(),this.emitZoomChange()}center(t){this.scale=1,this.scrollX=(this.virtualWidth*this.scale-t.width)/2,this.scrollY=(this.virtualHeight*this.scale-t.height)/2,this.clampScroll(),this.emitZoomChange()}handleWheelEvent(t,e,s,n){if(t.ctrlKey||t.metaKey){const o=Math.pow(1.005,-t.deltaY),r=this.scale;let a=r*o;const l=e.width-this.scrollbarWidth,h=e.height-this.scrollbarWidth,c=Math.max(l/this.virtualWidth,h/this.virtualHeight);a=Math.min(Math.max(a,c),3);const u=(s+this.scrollX)/r,f=(n+this.scrollY)/r;this.scale=a,this.scrollX=u*a-s,this.scrollY=f*a-n}else this.scrollX+=t.deltaX,this.scrollY+=t.deltaY;this.clampScroll(),this.emitZoomChange()}onZoomChange(t){this.zoomListeners.push(t)}emitZoomChange(){this.zoomListeners.forEach(t=>t()),this.viewChanges.next({scrollX:this.scrollX,scrollY:this.scrollY,scale:this.scale})}setViewState(t){this.scrollX=t.scrollX,this.scrollY=t.scrollY,this.scale=t.scale,this.clampScroll(),this.emitZoomChange()}}class ls{constructor(t,e,s){this.canvas=t,this.ctx=e,this.panZoom=s}drawRoundedRect(t,e,s,n,o){const r=this.ctx;r.beginPath(),r.moveTo(t+o,e),r.lineTo(t+s-o,e),r.quadraticCurveTo(t+s,e,t+s,e+o),r.lineTo(t+s,e+n-o),r.quadraticCurveTo(t+s,e+n,t+s-o,e+n),r.lineTo(t+o,e+n),r.quadraticCurveTo(t,e+n,t,e+n-o),r.lineTo(t,e+o),r.quadraticCurveTo(t,e,t+o,e),r.closePath(),r.fill(),r.stroke()}drawScrollbars(){const{canvas:t,panZoom:e,ctx:s}=this,n=t.width-e.scrollbarWidth,o=t.height-e.scrollbarWidth,r=e.virtualWidth*e.scale,a=e.virtualHeight*e.scale;if(r>n){const l=n/r,h=n*l,c=e.scrollX/r*n,d=t.height-e.scrollbarWidth;s.fillStyle="#5D5D5D80",s.strokeStyle="#5D5D5D80",s.lineWidth=1,this.drawRoundedRect(c,d,h,e.scrollbarWidth,e.scrollbarWidth/2)}if(a>o){const l=o/a,h=o*l,c=e.scrollY/a*o,d=t.width-e.scrollbarWidth;s.fillStyle="#5D5D5D80",s.strokeStyle="#5D5D5D80",s.lineWidth=1,this.drawRoundedRect(d,c,e.scrollbarWidth,h,e.scrollbarWidth/2)}}hitTestScrollbars(t,e){const{canvas:s,panZoom:n}=this,o=s.width-n.scrollbarWidth,r=s.height-n.scrollbarWidth,a=n.virtualWidth*n.scale,l=n.virtualHeight*n.scale;if(a>o&&e>r){const h=o/a,c=o*h,d=n.scrollX/a*o;if(t>=d&&t<=d+c)return"horizontal"}if(l>r&&t>o){const h=r/l,c=r*h,d=n.scrollY/l*r;if(e>=d&&e<=d+c)return"vertical"}return null}}class cs{constructor(t,e){this.ctx=t,this.panZoom=e}drawContent(){const t=this.ctx;t.strokeStyle="#ddd",t.lineWidth=1;const e=this.panZoom.virtualWidth,s=this.panZoom.virtualHeight;for(let n=0;n<e;n+=50)t.beginPath(),t.moveTo(n,0),t.lineTo(n,s),t.stroke();for(let n=0;n<s;n+=50)t.beginPath(),t.moveTo(0,n),t.lineTo(e,n),t.stroke()}}const A=[];for(let i=0;i<256;++i)A.push((i+256).toString(16).slice(1));function hs(i,t=0){return(A[i[t+0]]+A[i[t+1]]+A[i[t+2]]+A[i[t+3]]+"-"+A[i[t+4]]+A[i[t+5]]+"-"+A[i[t+6]]+A[i[t+7]]+"-"+A[i[t+8]]+A[i[t+9]]+"-"+A[i[t+10]]+A[i[t+11]]+A[i[t+12]]+A[i[t+13]]+A[i[t+14]]+A[i[t+15]]).toLowerCase()}let Dt;const ds=new Uint8Array(16);function us(){if(!Dt){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");Dt=crypto.getRandomValues.bind(crypto)}return Dt(ds)}const ps=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),he={randomUUID:ps};function q(i,t,e){var n;if(he.randomUUID&&!i)return he.randomUUID();i=i||{};const s=i.random??((n=i.rng)==null?void 0:n.call(i))??us();if(s.length<16)throw new Error("Random bytes length must be >= 16");return s[6]=s[6]&15|64,s[8]=s[8]&63|128,hs(s)}class ms{constructor(t=0,e=0){this.selected=!1,this.isHovered=!1,this.zIndex=0,this.id=q(),this.x=t,this.y=e}onDoubleClick(){}onRightClick(){}onDragStart(){}onDrag(t,e){}onDragEnd(){}}const F="#1890ff",gs="rgba(24,144,255,0.1)",fs="rgba(24,144,255,0.5)",de=F,bs="rgba(24,144,255,0.2)",wt="Arial",Re=14,ze=12;class ot extends ms{constructor({id:t,x:e=0,y:s=0,width:n,height:o,fillColor:r="#e6f7ff",lineWidth:a=2,title:l="",description:h="",dueDate:c,tags:d}){super(e,s),t&&(this.id=t),this.width=n,this.height=o,this.fillColor=r,this.lineWidth=a,this.title=l,this.description=h,this.dueDate=c,this.tags=d}getNearestPoint(t,e){const s=this.getConnectionPoints();let n=s[0],o=1/0;for(const r of s){const a=(r.x-t)**2+(r.y-e)**2;a<o&&(o=a,n=r)}return{x:n.x,y:n.y}}drawAnchors(t,e){if(this.selected||this.isHovered){const s=this.getConnectionPoints();for(const n of s)t.save(),t.setLineDash([]),t.beginPath(),t.arc(n.x,n.y,4/e.scale,0,2*Math.PI),t.fillStyle=n.isHovered?F:"#ffffff",t.strokeStyle="#000000",t.lineWidth=1/e.scale,t.fill(),t.stroke(),t.restore()}}drawConnectionLine(t,e,s){const n=this.getNearestPoint(s.x,s.y),o=s.getNearestPoint(this.x,this.y);t.save(),t.beginPath(),t.moveTo(n.x,n.y),t.lineTo(o.x,o.y),t.strokeStyle="#888",t.lineWidth=1/e.scale,t.stroke(),t.restore()}}function X(i){return i instanceof ot}function Bt(i){return"id"in i&&"x"in i&&"y"in i&&"radius"in i&&"contains"in i}function ys(i){return"id"in i&&"selected"in i&&"fromId"in i&&"toId"in i}const vs="rgba(82,196,26,0.03)",Ae="#73d13d",xs="rgba(24,144,255,0.03)",Oe="#1890ff",ws="rgba(255,165,0,0.03)",Ss="#faad14",Es="rgba(140,140,140,0.03)",Cs="#bfbfbf",ks="#ffffff",Ms="#52c41a",Is="#ffffff",Ts="#1890ff",Ps="#ffffff",Ls="#faad14",Ds="#ffffff",Rs="#808080",zs="rgba(82,196,26,0.1)",As=Ae,Os="rgba(24,144,255,0.1)",_s=Oe,Ns="rgba(255,165,0,0.1)",Ys="#fa8c16",Xs="rgba(169,169,169,0.1)",Zs="#a9a9a9",Bs={done:{fillColor:ks,borderColor:Ms},"in-progress":{fillColor:Is,borderColor:Ts},pending:{fillColor:Ps,borderColor:Ls},defined:{fillColor:Ds,borderColor:Rs}};var J=(i=>(i.Defined="defined",i.Pending="pending",i.InProgress="in-progress",i.Done="done",i))(J||{});const Ws={defined:"Defined",pending:"Pending","in-progress":"In Progress",done:"Done"},Gs=["defined","pending","in-progress","done"],Us=Gs.map(i=>({value:i,label:Ws[i]})),Mt=new it,L=class L extends ot{constructor({id:t=q(),x:e=0,y:s=0,title:n="New Task",description:o="",status:r=J.Defined,selected:a=!1,priority:l="medium",dueDate:h=new Date}){super({id:t,x:e,y:s,width:L.width,height:L.height,fillColor:"#ffffff",lineWidth:1,title:n,description:o}),this.status=J.Defined,this.zIndex=2,this.title=n,this.status=r,this.selected=a,this.priority=l,this.dueDate=h}draw(t,e){t.setLineDash([]);const s=this.x,n=this.y,o=L.width,r=L.height,a=Bs[this.status];t.fillStyle=a.fillColor,t.strokeStyle=this.selected?F:a.borderColor,t.lineWidth=(this.selected?2:1)/e.scale,t.beginPath(),t.roundRect(s,n,o,r,8*e.scale),t.fill(),t.stroke(),t.fillStyle="#000000",t.font="bold 14px Arial",t.fillText(this.title,s+10,n+20),t.fillStyle=a.borderColor,t.beginPath(),t.arc(s+o-12,n+12,6,0,2*Math.PI),t.fill(),this.drawButton(t,e,s+o-32,n+10,"✏️"),this.drawButton(t,e,s+o-16,n+10,"🗑️");const l=this.getConnectionPoints(),h=this.hoveredPort;if(this.selected||this.isHovered||h)for(const c of l){const d=h?c.x===h.x&&c.y===h.y:!1;if(!(this.selected||this.isHovered)&&!d)continue;const u=(d?8:4)/e.scale;t.save(),t.beginPath(),t.arc(c.x,c.y,u,0,2*Math.PI),t.fillStyle=d?F:"#ffffff",t.fill(),t.strokeStyle="#000000",t.lineWidth=1/e.scale,t.stroke(),t.restore()}}contains(t,e){return t>=this.x&&t<=this.x+L.width&&e>=this.y&&e<=this.y+L.height}isEditButtonClicked(t,e){const s=this.x+L.width-32,n=this.y+10,o=16;return t>=s&&t<=s+o&&e>=n&&e<=n+o}isDeleteButtonClicked(t,e){const s=this.x+L.width-16,n=this.y+10,o=16;return t>=s&&t<=s+o&&e>=n&&e<=n+o}drawButton(t,e,s,n,o){t.fillStyle="transparent",t.font="14px Arial",t.fillText(o,s,n+12)}onRightClick(){}onDragStart(){}onDrag(t,e){this.x=t,this.y=e}onDragEnd(){}getBoundaryPoint(t){const e=this.x+L.width/2,s=this.y+L.height/2;return{x:e+Math.cos(t)*(L.width/2),y:s+Math.sin(t)*(L.height/2)}}getConnectionPoints(){const t=L.width,e=L.height;return[{x:this.x+t/2,y:this.y,angle:-Math.PI/2,isHovered:!1,direction:"top"},{x:this.x+t,y:this.y+e/2,angle:0,isHovered:!1,direction:"right"},{x:this.x+t/2,y:this.y+e,angle:Math.PI/2,isHovered:!1,direction:"bottom"},{x:this.x,y:this.y+e/2,angle:Math.PI,isHovered:!1,direction:"left"}]}clone(){return new L({x:this.x,y:this.y,title:this.title,status:this.status,priority:this.priority,dueDate:this.dueDate})}onDoubleClick(){Mt.next(this)}};L.width=180,L.height=90;let D=L;const ue={done:{fillColor:vs,borderColor:Ae},"in-progress":{fillColor:xs,borderColor:Oe},pending:{fillColor:ws,borderColor:Ss},defined:{fillColor:Es,borderColor:Cs}},j=class j extends ot{constructor({id:t=q(),x:e=0,y:s=0,width:n=320,height:o=240,title:r="New Story",description:a="",status:l=J.Defined,priority:h="medium",tasks:c=[],selected:d=!1}){const u=ue[l];super({id:t,x:e,y:s,width:n,height:o,fillColor:u.fillColor,lineWidth:2,title:r,description:a}),this.status=J.Defined,this.tasks=[],this.priority="medium",this.hoveredResizeHandle=null,this.zIndex=1,this.status=l,this.priority=h,this.tasks=c,this.selected=d}draw(t,e){const s=ue[this.status];t.fillStyle=s.fillColor,t.beginPath(),t.roundRect(this.x,this.y,this.width,this.height,8*e.scale),t.fill();const n=6/e.scale,o=2/e.scale;if(t.setLineDash(this.selected?[]:[n,o]),t.strokeStyle=this.selected?F:s.borderColor,t.lineWidth=this.lineWidth/e.scale,t.stroke(),t.fillStyle="#000000",t.font=`bold ${Re}px ${wt}`,t.fillText(this.title,this.x+10,this.y+20),super.drawAnchors(t,e),this.selected||this.isHovered){const r=j.HANDLE_SIZE/e.scale;t.fillStyle=F,this.getResizeHandles(e).forEach(a=>{t.beginPath(),t.arc(a.x,a.y,r/2,0,2*Math.PI),t.fill()})}}drawButton(t,e,s,n,o,r){const a=22/e.scale;r!=="transparent"&&(t.fillStyle=r,t.beginPath(),t.roundRect(s,n,a,a,4/e.scale),t.fill()),t.fillStyle="#666666",t.font=`${ze/e.scale}px ${wt}`,t.fillText(o,s+3/e.scale,n+16/e.scale)}contains(t,e){return t>=this.x&&t<=this.x+this.width&&e>=this.y&&e<=this.y+this.height}isEditButtonClicked(t,e){const n=this.x+this.width-80,o=this.y+6;return t>=n&&t<=n+22&&e>=o&&e<=o+22}isDeleteButtonClicked(t,e){const n=this.x+this.width-50,o=this.y+6;return t>=n&&t<=n+22&&e>=o&&e<=o+22}isAddButtonClicked(t,e){const n=this.x+this.width-20,o=this.y+6;return t>=n&&t<=n+22&&e>=o&&e<=o+22}addTask(t){this.tasks.find(e=>e.id===t.id)||this.tasks.push(t)}removeTask(t){this.tasks=this.tasks.filter(e=>e.id!==t)}getBoundaryPoint(t){return{x:this.x+this.width/2,y:this.y+this.height/2}}getConnectionPoints(){const t=[],e=this.width,s=this.height;return t.push({x:this.x+e/2,y:this.y,angle:-Math.PI/2,isHovered:!1,direction:"top"}),t.push({x:this.x+e,y:this.y+s/2,angle:0,isHovered:!1,direction:"right"}),t.push({x:this.x+e/2,y:this.y+s,angle:Math.PI/2,isHovered:!1,direction:"bottom"}),t.push({x:this.x,y:this.y+s/2,angle:Math.PI,isHovered:!1,direction:"left"}),t}onDrag(t,e){const s=t-this.x,n=e-this.y;this.x=t,this.y=e,this.tasks.forEach(o=>{o.x+=s,o.y+=n})}getResizeHandles(t){return[{x:this.x+this.width-1,y:this.y+this.height-1,direction:"se"}]}getResizeHandleDirectionAt(t,e,s){const n=j.HANDLE_SIZE/s.scale;for(const o of this.getResizeHandles(s))if(t>=o.x-n/2&&t<=o.x+n/2&&e>=o.y-n/2&&e<=o.y+n/2)return o.direction;return null}onDoubleClick(){Mt.next(this)}clone(){return new j({x:this.x,y:this.y,width:this.width,height:this.height,title:this.title,description:this.description,status:this.status,priority:this.priority,tasks:[]})}};j.width=320,j.height=240,j.HANDLE_SIZE=16;let z=j;class Hs{constructor(){this.undoStack=[],this.redoStack=[],this.changes=new it}execute(t){t.execute(),this.undoStack.push(t),this.redoStack=[],this.changes.next()}undo(){const t=this.undoStack.pop();t&&(t.undo(),this.redoStack.push(t),this.changes.next())}redo(){const t=this.redoStack.pop();t&&(t.execute(),this.undoStack.push(t),this.changes.next())}canUndo(){return this.undoStack.length>0}canRedo(){return this.redoStack.length>0}}const I=new Hs;class B{}class pe extends B{constructor(t,e,s){super(),this.scene=t,this.initialPositions=new Map(e),this.finalPositions=new Map(s)}execute(){this.applyPositions(this.finalPositions),this.scene.changes.next()}undo(){this.applyPositions(this.initialPositions),this.scene.changes.next()}applyPositions(t){t.forEach((e,s)=>{const n=this.scene.getElements().find(o=>o.id===s);n&&(n.x=e.x,n.y=e.y)})}}class Vs extends B{constructor(t,e,s){super(),this.scene=t,this.initial=new Map(e),this.final=new Map(s)}execute(){this.apply(this.final),this.scene.changes.next()}undo(){this.apply(this.initial),this.scene.changes.next()}apply(t){t.forEach((e,s)=>{const n=this.scene.getElements().find(o=>o.id===s);n&&(n.x=e.x,n.y=e.y,n.width=e.width,n.height=e.height)})}}class Rt{static getDragGroup(t){const e=new Set(t);return t.filter(s=>s instanceof z).forEach(s=>{s.tasks.forEach(n=>e.add(n))}),Array.from(e)}}function me(i){const t=i.getShapes(),e=i.getElements().filter(X);return[...t,...e].sort((n,o)=>(n.zIndex??0)-(o.zIndex??0))}var st=(i=>(i.Straight="straight",i.SShaped="s-shaped",i))(st||{});class _e{constructor(t,e,s=q(),n){this.selected=!1,this.lineType=st.SShaped,this.zIndex=1,this.tangentAngle=0,this.fromId=t,this.toId=e,this.id=s,n&&(this.lineType=n)}getClosestConnectionPoints(t,e){const s=t.getConnectionPoints(),n=e.getConnectionPoints();let o=1/0,r=s[0],a=n[0];for(const l of s)for(const h of n){const c=Math.sqrt((l.x-h.x)**2+(l.y-h.y)**2);c<o&&(o=c,r=l,a=h)}return{start:r,end:a}}setStrokeProperties(t,e){t.setLineDash([]),t.strokeStyle=this.selected?"#008dff":"#000",t.lineWidth=2}drawLine(t,e,s,n){const{start:o,end:r}=this.getClosestConnectionPoints(e,s);if(t.beginPath(),t.moveTo(o.x,o.y),this.lineType===st.Straight)t.lineTo(r.x,r.y),this.tangentAngle=Math.atan2(r.y-o.y,r.x-o.x);else if(this.lineType===st.SShaped){const a=r.x-o.x,l=r.y-o.y,c=Math.sqrt(a*a+l*l)/1.4,d=this.getControlPoint(o,c),u=this.getControlPoint(r,c);t.bezierCurveTo(d.x,d.y,u.x,u.y,r.x,r.y),this.tangentAngle=Math.atan2(r.y-u.y,r.x-u.x)}this.setStrokeProperties(t,n),t.stroke()}getControlPoint(t,e){switch(t.direction){case"left":return{x:t.x-e,y:t.y};case"right":return{x:t.x+e,y:t.y};case"top":return{x:t.x,y:t.y-e};case"bottom":return{x:t.x,y:t.y+e};default:return{x:t.x,y:t.y}}}drawArrowHead(t,e,s,n){const{end:o}=this.getClosestConnectionPoints(e,s),r=this.tangentAngle,a=15;t.beginPath(),t.moveTo(o.x,o.y),t.lineTo(o.x-a*Math.cos(r-Math.PI/6),o.y-a*Math.sin(r-Math.PI/6)),t.lineTo(o.x-a*Math.cos(r+Math.PI/6),o.y-a*Math.sin(r+Math.PI/6)),t.closePath(),t.fillStyle=this.selected?"#008dff":"#000",t.fill()}draw(t,e,s=[]){const n=s.find(r=>r.id===this.fromId),o=s.find(r=>r.id===this.toId);n&&o&&(this.drawLine(t,n,o,e),this.drawArrowHead(t,n,o,e))}distanceToLineSegment(t,e,s,n,o,r){const a=o-s,l=r-n,h=a*a+l*l;if(h===0)return Math.sqrt((t-s)**2+(e-n)**2);const c=Math.max(0,Math.min(1,((t-s)*a+(e-n)*l)/h)),d=s+c*a,u=n+c*l;return Math.sqrt((t-d)**2+(e-u)**2)}isNearPoint(t,e,s,n=5){const o=s.find(h=>h.id===this.fromId),r=s.find(h=>h.id===this.toId);if(!o||!r)return!1;const{start:a,end:l}=this.getClosestConnectionPoints(o,r);if(this.lineType===st.Straight)return this.distanceToLineSegment(t,e,a.x,a.y,l.x,l.y)<=n;if(this.lineType===st.SShaped){const h=l.x-a.x,c=l.y-a.y,u=Math.sqrt(h*h+c*c)/1.4,f=this.getControlPoint(a,u),p=this.getControlPoint(l,u),b=20,x=[];for(let S=0;S<=b;S++){const C=S/b,E=1-C,T=E*E*E*a.x+3*E*E*C*f.x+3*E*C*C*p.x+C*C*C*l.x,k=E*E*E*a.y+3*E*E*C*f.y+3*E*C*C*p.y+C*C*C*l.y;x.push({x:T,y:k})}let M=1/0;for(let S=0;S<x.length-1;S++){const C=x[S],E=x[S+1],T=this.distanceToLineSegment(t,e,C.x,C.y,E.x,E.y);T<M&&(M=T)}return M<=n}return!1}setLineType(t){this.lineType=t}}class js extends B{constructor(t,e,s){super(),this.scene=t,this.fromId=e,this.toId=s,this.connection=new _e(e,s)}execute(){this.scene.addElement(this.connection)}undo(){this.scene.removeElement(this.connection)}}class Fs{constructor(t,e){this.scene=t,this.panZoom=e,this.creating=!1,this.startShape=null,this.startPoint=null,this.tempLine=null}hitTest(t,e){const s=this.scene.getElements().filter(X),n=[...this.scene.getShapes(),...s],o=this.scene.getConnections();for(let r=o.length-1;r>=0;r--){const a=o[r],l=5/this.panZoom.scale;if(a.isNearPoint(t,e,n,l))return a}return null}start(t,e){const s=me(this.scene),n=this.findPoint(t,e,s);return n?(this.creating=!0,this.startShape=n.shape,this.startPoint=n.point,this.tempLine={startX:n.point.x,startY:n.point.y,endX:t,endY:e},this.scene.changes.next(),!0):!1}update(t,e){return!this.creating||!this.tempLine?!1:(this.tempLine.endX=t,this.tempLine.endY=e,this.scene.changes.next(),!0)}finish(){var o;if(!this.creating||!this.startShape||!this.tempLine)return!1;let t=null;const e=me(this.scene),s=this.tempLine.endX,n=this.tempLine.endY;if(t=((o=this.findPoint(s,n,e))==null?void 0:o.shape)||null,!t)for(let r=e.length-1;r>=0;r--){const a=e[r];if(a!==this.startShape&&a.contains(s,n)){t=a;break}}if(t){const r=this.startShape,a=t;r instanceof z&&a instanceof D&&r.tasks.some(h=>h.id===a.id)||r instanceof D&&a instanceof z&&a.tasks.some(h=>h.id===r.id)||I.execute(new js(this.scene,r.id,a.id))}return this.creating=!1,this.startShape=null,this.startPoint=null,this.tempLine=null,this.scene.changes.next(),!0}isCreating(){return this.creating}cancel(){this.creating=!1,this.startShape=null,this.startPoint=null,this.tempLine=null,this.scene.changes.next()}getTemporaryLine(){return this.tempLine}findPoint(t,e,s){for(let n=s.length-1;n>=0;n--){const o=s[n],r=o.getConnectionPoints();for(const a of r){const l=t-a.x,h=e-a.y;if(Math.sqrt(l*l+h*h)<8/this.panZoom.scale)return{shape:o,point:a}}}return null}}function jt(i){const t=i.map(s=>s.x),e=i.map(s=>s.y);return{minX:Math.min(...t),minY:Math.min(...e),maxX:Math.max(...t),maxY:Math.max(...e)}}class $s{constructor(t,e,s){this.canvas=t,this.scene=e,this.panZoom=s,this.draggingItem=null,this.dragOffsetX=0,this.dragOffsetY=0,this.initialPositions=new Map,this.hoveredConnectionPoint=null,this.resizingElement=null,this.resizeDirection=null,this.resizeStartX=0,this.resizeStartY=0,this.initialX=0,this.initialY=0,this.initialWidth=0,this.initialHeight=0,this.isRegionSelecting=!1,this.regionStartX=0,this.regionStartY=0,this.regionCurrentX=0,this.regionCurrentY=0,this.draggingGroup=null,this.groupDragStartX=0,this.groupDragStartY=0,this.connectionService=new Fs(this.scene,this.panZoom)}getTempConnectionLine(){return this.connectionService.getTemporaryLine()}cancelConnectionCreation(){this.connectionService.cancel(),this.scene.changes.next()}getRegionRect(){if(!this.isRegionSelecting)return null;const t=Math.min(this.regionStartX,this.regionCurrentX),e=Math.min(this.regionStartY,this.regionCurrentY),s=Math.abs(this.regionCurrentX-this.regionStartX),n=Math.abs(this.regionCurrentY-this.regionStartY);return{x:t,y:e,width:s,height:n}}findConnectionPointAt(t,e,s){for(let n=s.length-1;n>=0;n--){const o=s[n],r=o.getConnectionPoints();for(const a of r)if(Math.sqrt((t-a.x)**2+(e-a.y)**2)<8/this.panZoom.scale)return{shape:o,point:a}}return null}updateSelectionOnClick(t,e){const s=this.scene.getSelectedElements();t?e?s.indexOf(t)===-1&&this.scene.setSelected([...s,t]):s.length>1&&s.indexOf(t)!==-1||this.scene.setSelected([t]):this.scene.setSelected([])}handleMouseDown(t,e,s){if(t.button!==0)return!1;const n=this.scene.getShapes(),o=this.scene.getElements().filter(X);let r=null;const a=o.filter(c=>c instanceof D);for(let c=a.length-1;c>=0;c--)if(a[c].contains(e,s)){r=a[c];break}if(!r){const c=o.filter(d=>d instanceof z);for(let d=c.length-1;d>=0;d--)if(c[d].contains(e,s)){r=c[d];break}}if(!r)for(let c=o.length-1;c>=0;c--){const d=o[c];if(!(d instanceof D)&&!(d instanceof z)&&d.contains(e,s)){r=d;break}}if(!r)for(let c=n.length-1;c>=0;c--){const d=n[c];if(d.contains(e,s)){r=d;break}}if(r instanceof z){const c=r.getResizeHandleDirectionAt(e,s,this.panZoom);if(c)return this.resizingElement=r,this.resizeDirection=c,this.resizeStartX=e,this.resizeStartY=s,this.initialX=r.x,this.initialY=r.y,this.initialWidth=r.width,this.initialHeight=r.height,this.updateSelectionOnClick(r,t.shiftKey),!0}const l=this.connectionService.hitTest(e,s);if(l)return this.updateSelectionOnClick(l,t.shiftKey),!0;if(this.connectionService.start(e,s))return!0;if(r){this.updateSelectionOnClick(r,t.shiftKey);const c=this.scene.getSelectedElements(),d=Rt.getDragGroup(c);return this.initialPositions.clear(),d.forEach(u=>this.initialPositions.set(u.id,{x:u.x,y:u.y})),this.draggingItem=r,this.dragOffsetX=e-r.x,this.dragOffsetY=s-r.y,r.onDragStart&&r.onDragStart(),!0}const h=this.scene.getSelectedElements();if(h.length>1){const c=[];h.forEach(b=>{const x=b;x.width!==void 0&&x.height!==void 0?c.push({x:x.x,y:x.y},{x:x.x+x.width,y:x.y+x.height}):x.radius!==void 0?c.push({x:x.x-x.radius,y:x.y-x.radius},{x:x.x+x.radius,y:x.y+x.radius}):c.push({x:x.x,y:x.y})});const{minX:d,minY:u,maxX:f,maxY:p}=jt(c);if(e>=d&&e<=f&&s>=u&&s<=p)return this.draggingGroup=Rt.getDragGroup(h),this.initialPositions.clear(),this.draggingGroup.forEach(b=>this.initialPositions.set(b.id,{x:b.x,y:b.y})),this.groupDragStartX=e,this.groupDragStartY=s,!0}return!n.some(c=>c.contains(e,s))&&!o.some(c=>c.contains(e,s))?(this.isRegionSelecting=!0,this.regionStartX=e,this.regionStartY=s,this.regionCurrentX=e,this.regionCurrentY=s,this.updateSelectionOnClick(null,!1),!0):(this.updateSelectionOnClick(null,!1),!1)}handleMouseMove(t,e){const s=this.scene.getShapes(),n=this.scene.getElements().filter(X);let o;if(this.connectionService.isCreating()){const c=n.filter(u=>u instanceof D),d=n.filter(u=>!(u instanceof D));o=[...s,...d,...c]}else o=[...s,...n];let r=null;o.forEach(c=>c.isHovered=!1);for(let c=o.length-1;c>=0;c--){const d=o[c];if(d.contains(t,e)){r=d;break}}r&&(r.isHovered=!0),o.forEach(c=>delete c.hoveredPort);const a=this.findConnectionPointAt(t,e,o);if(a?(this.hoveredConnectionPoint=a.point,a.shape.hoveredPort=a.point):this.hoveredConnectionPoint=null,this.connectionService.isCreating()){this.connectionService.update(t,e);return}const l=n.filter(c=>c instanceof z);let h=!1;for(const c of l)if(c.selected){const d=c.getResizeHandleDirectionAt(t,e,this.panZoom);if(c.hoveredResizeHandle=d,d){h=!0;break}}if(!this.resizingElement)if(h){const c=l.find(d=>d.hoveredResizeHandle);c&&(this.canvas.style.cursor=`${c.hoveredResizeHandle}-resize`)}else this.canvas.style.cursor="default";if(this.draggingGroup){const c=t-this.groupDragStartX,d=e-this.groupDragStartY;this.draggingGroup.forEach(u=>{const f=this.initialPositions.get(u.id);if(f){const p=u;p.x=f.x+c,p.y=f.y+d}}),this.scene.changes.next();return}if(this.isRegionSelecting){this.regionCurrentX=t,this.regionCurrentY=e;const c=Math.min(this.regionStartX,this.regionCurrentX),d=Math.min(this.regionStartY,this.regionCurrentY),u=Math.abs(this.regionCurrentX-this.regionStartX),f=Math.abs(this.regionCurrentY-this.regionStartY),p=this.scene.getShapes(),b=this.scene.getElements().filter(X),M=[...p,...b].filter(S=>{let C,E,T,k;return Bt(S)?(C=S.x-S.radius,E=S.y-S.radius,T=S.x+S.radius,k=S.y+S.radius):(C=S.x,E=S.y,T=S.x+S.width,k=S.y+S.height),T>=c&&C<=c+u&&k>=d&&E<=d+f});this.scene.setSelected(M),this.scene.changes.next();return}if(this.draggingItem){const c=this.initialPositions.get(this.draggingItem.id);if(c){const d=t-(c.x+this.dragOffsetX),u=e-(c.y+this.dragOffsetY),f=this.scene.getSelectedElements();Rt.getDragGroup(f).forEach(b=>{const x=this.initialPositions.get(b.id);if(x){const M=x.x+d,S=x.y+u;b.x=M,b.y=S,b.onDrag&&b.onDrag(M,S)}}),this.scene.changes.next()}return}if(this.resizingElement&&this.resizeDirection){const c=t-this.resizeStartX,d=e-this.resizeStartY;let u=this.initialX,f=this.initialY,p=this.initialWidth,b=this.initialHeight;switch(this.resizeDirection){case"se":p+=c,b+=d;break;case"ne":p+=c,b-=d,f+=d;break;case"sw":p-=c,b+=d,u+=c;break;case"nw":p-=c,b-=d,u+=c,f+=d;break}p=Math.max(p,1),b=Math.max(b,1),this.resizingElement.x=u,this.resizingElement.y=f,this.resizingElement.width=p,this.resizingElement.height=b,this.scene.changes.next();return}}handleMouseUp(){if(this.connectionService.isCreating()){this.connectionService.finish();return}if(this.isRegionSelecting){const t=Math.min(this.regionStartX,this.regionCurrentX),e=Math.min(this.regionStartY,this.regionCurrentY),s=Math.abs(this.regionCurrentX-this.regionStartX),n=Math.abs(this.regionCurrentY-this.regionStartY),o=this.scene.getShapes(),r=this.scene.getElements().filter(X),l=[...o,...r].filter(h=>{let c,d,u,f;return Bt(h)?(c=h.x-h.radius,d=h.y-h.radius,u=h.x+h.radius,f=h.y+h.radius):(c=h.x,d=h.y,u=h.x+h.width,f=h.y+h.height),u>=t&&c<=t+s&&f>=e&&d<=e+n});this.scene.setSelected(l),this.isRegionSelecting=!1,this.scene.changes.next();return}if(this.draggingGroup){const t=new Map(this.initialPositions),e=new Map;this.draggingGroup.forEach(s=>{const n=s;e.set(s.id,{x:n.x,y:n.y})}),I.execute(new pe(this.scene,t,e)),this.initialPositions.clear(),this.draggingGroup=null,this.scene.changes.next();return}if(this.draggingItem){if(this.draggingItem instanceof D){const s=this.scene.getSelectedElements().filter(o=>o instanceof D);this.scene.getElements().filter(X).filter(o=>o instanceof z).forEach(o=>{s.forEach(r=>{o.contains(r.x,r.y)?o.addTask(r):o.removeTask(r.id)})})}this.draggingItem.onDragEnd&&this.draggingItem.onDragEnd();const t=new Map(this.initialPositions);if(t.size>0){const e=new Map;t.forEach((s,n)=>{const o=this.scene.getElements().find(r=>r.id===n);o&&e.set(n,{x:o.x,y:o.y})}),I.execute(new pe(this.scene,t,e))}this.initialPositions.clear(),this.draggingItem=null,this.scene.changes.next()}if(this.resizingElement){const t=this.resizingElement,e=new Map;e.set(t.id,{x:this.initialX,y:this.initialY,width:this.initialWidth,height:this.initialHeight});const s=new Map;s.set(t.id,{x:t.x,y:t.y,width:t.width,height:t.height}),I.execute(new Vs(this.scene,e,s)),this.resizingElement=null,this.resizeDirection=null,this.canvas.style.cursor="default",this.scene.getElements().filter(X).filter(n=>n instanceof z).forEach(n=>n.hoveredResizeHandle=null),this.scene.changes.next();return}}handleDoubleClick(t,e){const s=this.scene.getShapes();for(let o=s.length-1;o>=0;o--){const r=s[o];if(r.contains(t,e)&&r.onDoubleClick){r.onDoubleClick();break}}const n=[...this.scene.getElements().filter(X)];n.sort((o,r)=>(r.zIndex??0)-(o.zIndex??0));for(const o of n)if(o.contains(t,e)&&o.onDoubleClick){o.onDoubleClick();break}}handleRightClick(t,e,s){t.preventDefault();const n=this.scene.getShapes();for(let o=n.length-1;o>=0;o--){const r=n[o];if(r.contains(e,s)&&r.onRightClick){r.onRightClick();break}}}get isCreatingConnection(){return this.connectionService.isCreating()}get isDraggingTask(){return this.draggingItem instanceof D}}class Ks{constructor(){this.openCount=0}register(){this.openCount+=1}unregister(){this.openCount=Math.max(0,this.openCount-1)}isOpen(){return this.openCount>0}}const St=new Ks;class qs{constructor(t,e){this.scene=t,this.canvasManager=e,this.clipboard=[],document.addEventListener("keydown",this.onKeyDown.bind(this))}getCanvasCenter(){const t=this.canvasManager.getCanvas(),e=t.width,s=t.height,n=this.canvasManager.getPanZoomManager(),o=(e/2+n.scrollX)/n.scale,r=(s/2+n.scrollY)/n.scale;return{x:o,y:r}}onKeyDown(t){if(St.isOpen()||document.querySelector('[role="dialog"]'))return;const e=t.target;if(!(e.tagName==="INPUT"||e.tagName==="TEXTAREA"||e.tagName==="SELECT"||e.isContentEditable)){if(console.log({key:t.key}),t.key==="Escape"){this.canvasManager.getInteractionManager().cancelConnectionCreation();return}if((t.ctrlKey||t.metaKey)&&t.key.toLowerCase()==="c"){const s=this.scene.getSelectedShapes();s.length>0&&(this.clipboard=s.map(n=>n.clone()),console.log(`Copied ${this.clipboard.length} shapes to clipboard`)),t.preventDefault()}if((t.ctrlKey||t.metaKey)&&t.key.toLowerCase()==="v"){if(this.clipboard.length>0){let s=this.canvasManager.getLastMouseCoords();s||(s=this.getCanvasCenter(),console.log(`Mouse coordinates not available, pasting at canvas center (${s.x}, ${s.y})`)),this.scene.getShapes().forEach(n=>n.selected=!1),this.clipboard.forEach(n=>{const o=n.clone();o.x=s.x+(o.x-n.x),o.y=s.y+(o.y-n.y),o.selected=!0,this.scene.addElement(o)}),console.log(`Pasted ${this.clipboard.length} shapes at (${s.x}, ${s.y})`)}t.preventDefault()}if((t.ctrlKey||t.metaKey)&&t.key.toLowerCase()==="a"){const s=this.scene.getElements();this.scene.setSelected(s),t.preventDefault()}if(t.key==="Backspace"){t.preventDefault(),t.stopPropagation();const s=[...this.scene.getSelectedElements()];this.scene.removeElements(s)}}}}const ge={done:{fillColor:zs,borderColor:As},"in-progress":{fillColor:Os,borderColor:_s},pending:{fillColor:Ns,borderColor:Ys},defined:{fillColor:Xs,borderColor:Zs}};class nt extends ot{constructor({id:t=q(),x:e=0,y:s=0,width:n=200,height:o=120,title:r="New Goal",status:a=J.Defined,priority:l="medium",selected:h=!1}){super({id:t,x:e,y:s,width:n,height:o,fillColor:ge[a].fillColor,lineWidth:2,title:r}),this.links=[],this.progress=0,this.status=J.Defined,this.priority="medium",this.zIndex=3,this.status=a,this.priority=l,this.selected=h}draw(t,e){const{x:s,y:n,width:o,height:r,title:a,progress:l,links:h}=this,c=ge[this.status];t.fillStyle=c.fillColor,t.beginPath(),t.roundRect(s,n,o,r,8*e.scale),t.fill(),t.strokeStyle=this.selected?F:c.borderColor,t.lineWidth=this.lineWidth/e.scale,t.stroke(),t.fillStyle="#000000",t.font=`${Re}px ${wt}`,t.fillText(a,s+8,n+20);const d=s+8,u=n+r-16,f=o-16,p=8;t.fillStyle=c.fillColor,t.fillRect(d,u,f,p),t.fillStyle=c.borderColor,t.fillRect(d,u,f*l,p),t.fillStyle="#000000",t.font=`${ze}px ${wt}`;const b=`${Math.round(l*100)}%`;t.fillText(b,d+f*l+4,u+p+12);const x=`🔗${h.length}`,M=t.measureText(x).width;t.fillText(x,s+o-8-M,n+20),super.drawAnchors(t,e)}contains(t,e){return t>=this.x&&t<=this.x+this.width&&e>=this.y&&e<=this.y+this.height}getBoundaryPoint(t){return{x:this.x+this.width/2+Math.cos(t)*(this.width/2),y:this.y+this.height/2+Math.sin(t)*(this.height/2)}}getConnectionPoints(){const t=this.width,e=this.height;return[{x:this.x+t/2,y:this.y,angle:-Math.PI/2,isHovered:!1,direction:"top"},{x:this.x+t,y:this.y+e/2,angle:0,isHovered:!1,direction:"right"},{x:this.x+t/2,y:this.y+e,angle:Math.PI/2,isHovered:!1,direction:"bottom"},{x:this.x,y:this.y+e/2,angle:Math.PI,isHovered:!1,direction:"left"}]}clone(){const t=new nt({x:this.x,y:this.y,width:this.width,height:this.height,title:this.title,status:this.status,priority:this.priority});return t.progress=this.progress,t.links=[...this.links],t}onDoubleClick(){Mt.next(this)}}class Js{constructor(t,e){this.draggingScrollbar=null,this.dragStartX=0,this.dragStartY=0,this.dragStartScrollX=0,this.dragStartScrollY=0,this.lastMouseCoords=null,this.activePointers=new Map,this.pinchInitialDist=null,this.pinchInitialRect=null,this.pinchCenter=null,this.pinchElement=null,this.pinchZoomInitialDist=null,this.pinchZoomInitialScale=1,this.pinchZoomCenterScene=null,this.gestureInitialScale=1,this.canvas=t,this.canvas.style.touchAction="none",this.canvas.style.userSelect="none",this.scene=e;const s=t.getContext("2d");if(!s)throw new Error("Canvas 2D context not available");this.ctx=s,this.panZoom=new as(t),this.renderer=new cs(this.ctx,this.panZoom),this.scrollbarManager=new ls(t,this.ctx,this.panZoom),this.interactionManager=new $s(t,e,this.panZoom),this.keyboardManager=new qs(e,this),this.scene.changes.subscribe(()=>this.draw()),this.canvas.addEventListener("wheel",this.onWheel.bind(this)),window.addEventListener("resize",this.onResize.bind(this)),this.canvas.addEventListener("mousedown",this.onMouseDown.bind(this)),this.canvas.addEventListener("mousemove",this.onMouseMove.bind(this)),this.canvas.addEventListener("mouseup",this.onMouseUp.bind(this)),this.canvas.addEventListener("dblclick",this.onDoubleClick.bind(this)),this.canvas.addEventListener("contextmenu",this.onRightClick.bind(this)),this.canvas.addEventListener("pointerdown",this.onPointerDown.bind(this)),this.canvas.addEventListener("pointermove",this.onPointerMove.bind(this)),this.canvas.addEventListener("pointerup",this.onPointerUp.bind(this)),this.canvas.addEventListener("pointercancel",this.onPointerUp.bind(this)),this.canvas.addEventListener("gesturestart",this.onGestureStart.bind(this)),this.canvas.addEventListener("gesturechange",this.onGestureChange.bind(this)),this.canvas.addEventListener("gestureend",this.onGestureEnd.bind(this)),this.resizeCanvas()}init(){this.draw()}resizeCanvas(){this.canvas.width=window.innerWidth-2,this.canvas.height=window.innerHeight-2,this.draw()}onResize(){this.resizeCanvas()}draw(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.save(),this.ctx.translate(-this.panZoom.scrollX,-this.panZoom.scrollY),this.ctx.scale(this.panZoom.scale,this.panZoom.scale),this.renderer.drawContent();const t=this.scene.getElements(),e=this.scene.getShapes(),s=t.filter(X),n=[...e,...s],o=this.scene.getConnections();if(s.filter(h=>h instanceof nt).forEach(h=>{const c=o.filter(f=>f.fromId===h.id||f.toId===h.id).map(f=>f.fromId===h.id?f.toId:f.fromId);h.links=Array.from(new Set(c));const u=s.filter(f=>f instanceof D).filter(f=>h.links.indexOf(f.id)!==-1);h.progress=u.length?u.filter(f=>f.status==="done").length/u.length:0}),e.forEach(h=>h.draw(this.ctx,this.panZoom)),s.sort((h,c)=>h.zIndex-c.zIndex).forEach(h=>h.draw(this.ctx,this.panZoom)),this.interactionManager.isCreatingConnection){const h=4/this.panZoom.scale;n.forEach(c=>{c.isHovered&&(this.ctx.save(),this.ctx.fillStyle=gs,this.ctx.strokeStyle=fs,this.ctx.lineWidth=2/this.panZoom.scale,"radius"in c?(this.ctx.beginPath(),this.ctx.arc(c.x,c.y,c.radius+h,0,2*Math.PI)):(this.ctx.beginPath(),this.ctx.roundRect(c.x-h,c.y-h,c.width+h*2,c.height+h*2,6/this.panZoom.scale)),this.ctx.fill(),this.ctx.stroke(),this.ctx.restore())})}this.scene.getConnections().forEach(h=>{h.draw(this.ctx,this.panZoom,n)});const r=this.interactionManager.getTempConnectionLine();r&&(this.ctx.save(),this.ctx.beginPath(),this.ctx.moveTo(r.startX,r.startY),this.ctx.lineTo(r.endX,r.endY),this.ctx.strokeStyle="#000000",this.ctx.lineWidth=2,this.ctx.setLineDash([5,5]),this.ctx.globalAlpha=.5,this.ctx.stroke(),this.ctx.restore(),this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(r.endX,r.endY,8,0,2*Math.PI),this.ctx.fillStyle=F,this.ctx.fill(),this.ctx.strokeStyle="#000000",this.ctx.lineWidth=1,this.ctx.stroke(),this.ctx.restore());const a=this.scene.getSelectedElements();if(a.length>1){const h=[];a.forEach(p=>{p.width!==void 0&&p.height!==void 0?h.push({x:p.x,y:p.y},{x:p.x+p.width,y:p.y},{x:p.x,y:p.y+p.height},{x:p.x+p.width,y:p.y+p.height}):p.radius!==void 0?h.push({x:p.x-p.radius,y:p.y-p.radius},{x:p.x+p.radius,y:p.y+p.radius}):h.push({x:p.x,y:p.y})});const{minX:c,minY:d,maxX:u,maxY:f}=jt(h);this.ctx.save(),this.ctx.setLineDash([]),this.ctx.strokeStyle=de,this.ctx.strokeRect(c,d,u-c,f-d),this.ctx.restore()}const l=this.interactionManager.getRegionRect();l&&(this.ctx.save(),this.ctx.fillStyle=bs,this.ctx.fillRect(l.x,l.y,l.width,l.height),this.ctx.strokeStyle=de,this.ctx.setLineDash([]),this.ctx.strokeRect(l.x,l.y,l.width,l.height),this.ctx.restore()),this.ctx.restore(),this.scrollbarManager.drawScrollbars()}getSceneCoords(t){const e=this.canvas.getBoundingClientRect(),s=t.clientX-e.left,n=t.clientY-e.top,o=(s+this.panZoom.scrollX)/this.panZoom.scale,r=(n+this.panZoom.scrollY)/this.panZoom.scale;return{sceneX:o,sceneY:r}}getLastMouseCoords(){return this.lastMouseCoords}onMouseDown(t){const{sceneX:e,sceneY:s}=this.getSceneCoords(t);this.lastMouseCoords={x:e,y:s};const n=this.canvas.getBoundingClientRect(),o=t.clientX-n.left,r=t.clientY-n.top,a=this.scrollbarManager.hitTestScrollbars(o,r);if(a==="horizontal"){this.draggingScrollbar="horizontal",this.dragStartX=o,this.dragStartScrollX=this.panZoom.scrollX;return}else if(a==="vertical"){this.draggingScrollbar="vertical",this.dragStartY=r,this.dragStartScrollY=this.panZoom.scrollY;return}this.interactionManager.handleMouseDown(t,e,s)&&this.draw()}onMouseMove(t){const{sceneX:e,sceneY:s}=this.getSceneCoords(t);this.lastMouseCoords={x:e,y:s};const n=this.canvas.getBoundingClientRect(),o=t.clientX-n.left,r=t.clientY-n.top;if(this.draggingScrollbar==="horizontal"){const a=this.canvas.width-this.panZoom.scrollbarWidth,h=this.panZoom.virtualWidth*this.panZoom.scale-a,c=o-this.dragStartX,d=h/a;this.panZoom.scrollX=Math.max(0,Math.min(this.dragStartScrollX+c*d,h)),this.draw()}else if(this.draggingScrollbar==="vertical"){const a=this.canvas.height-this.panZoom.scrollbarWidth,h=this.panZoom.virtualHeight*this.panZoom.scale-a,c=r-this.dragStartY,d=h/a;this.panZoom.scrollY=Math.max(0,Math.min(this.dragStartScrollY+c*d,h)),this.draw()}else this.interactionManager.handleMouseMove(e,s),this.draw()}onMouseUp(t){this.draggingScrollbar=null,this.interactionManager.handleMouseUp(),this.draw()}onDoubleClick(t){const{sceneX:e,sceneY:s}=this.getSceneCoords(t);this.interactionManager.handleDoubleClick(e,s),this.draw()}onRightClick(t){const{sceneX:e,sceneY:s}=this.getSceneCoords(t);this.interactionManager.handleRightClick(t,e,s),this.draw()}onClick(t){const{sceneX:e,sceneY:s}=this.getSceneCoords(t);this.interactionManager.handleDoubleClick(e,s),this.draw()}onWheel(t){t.preventDefault();const e=this.canvas.getBoundingClientRect(),s=t.clientX-e.left,n=t.clientY-e.top;this.panZoom.handleWheelEvent(t,this.canvas,s,n),this.draw()}zoomIn(){this.panZoom.zoomIn(this.canvas),this.draw()}zoomOut(){this.panZoom.zoomOut(this.canvas),this.draw()}centerCanvas(){this.panZoom.center(this.canvas),this.draw()}addElement(t){if("x"in t&&"y"in t){const e=this.lastMouseCoords??{x:(this.canvas.width/2+this.panZoom.scrollX)/this.panZoom.scale,y:(this.canvas.height/2+this.panZoom.scrollY)/this.panZoom.scale};t.x=e.x,t.y=e.y}this.scene.addElement(t),this.draw(),console.log("Added item to canvas:",t)}getCanvas(){return this.canvas}getPanZoomManager(){return this.panZoom}getInteractionManager(){return this.interactionManager}onPointerDown(t){if(this.activePointers.set(t.pointerId,{x:t.clientX,y:t.clientY}),this.activePointers.size===2){const[e,s]=Array.from(this.activePointers.values()),n=Math.hypot(e.x-s.x,e.y-s.y),o=this.scene.getSelectedElements().filter(r=>r instanceof z);if(o.length===1){this.pinchElement=o[0],this.pinchInitialDist=n,this.pinchInitialRect={x:this.pinchElement.x,y:this.pinchElement.y,width:this.pinchElement.width,height:this.pinchElement.height};const r=this.canvas.getBoundingClientRect(),a=(e.x+s.x)/2-r.left,l=(e.y+s.y)/2-r.top;this.pinchCenter={x:(a+this.panZoom.scrollX)/this.panZoom.scale,y:(l+this.panZoom.scrollY)/this.panZoom.scale}}else{this.pinchZoomInitialDist=n,this.pinchZoomInitialScale=this.panZoom.scale;const r=this.canvas.getBoundingClientRect(),a=(e.x+s.x)/2-r.left,l=(e.y+s.y)/2-r.top;this.pinchZoomCenterScene={x:(a+this.panZoom.scrollX)/this.panZoom.scale,y:(l+this.panZoom.scrollY)/this.panZoom.scale}}return}this.canvas.setPointerCapture(t.pointerId),this.onMouseDown(t)}onPointerMove(t){if(this.pinchZoomInitialDist!==null&&this.activePointers.size>=2&&this.pinchZoomCenterScene){this.activePointers.set(t.pointerId,{x:t.clientX,y:t.clientY});const[e,s]=Array.from(this.activePointers.values()),n=Math.hypot(e.x-s.x,e.y-s.y);let o=this.pinchZoomInitialScale*(n/this.pinchZoomInitialDist);const r=Math.max((this.canvas.width-this.panZoom.scrollbarWidth)/this.panZoom.virtualWidth,(this.canvas.height-this.panZoom.scrollbarWidth)/this.panZoom.virtualHeight);o=Math.min(Math.max(o,r),3);const a=this.canvas.getBoundingClientRect(),l=(e.x+s.x)/2-a.left,h=(e.y+s.y)/2-a.top;this.panZoom.scale=o,this.panZoom.scrollX=this.pinchZoomCenterScene.x*o-l,this.panZoom.scrollY=this.pinchZoomCenterScene.y*o-h,this.panZoom.clampScroll(),this.draw();return}if(this.pinchInitialDist!==null&&this.activePointers.size>=2&&this.pinchElement&&this.pinchInitialRect&&this.pinchCenter){this.activePointers.set(t.pointerId,{x:t.clientX,y:t.clientY});const[e,s]=Array.from(this.activePointers.values()),o=Math.hypot(e.x-s.x,e.y-s.y)/this.pinchInitialDist,r=this.pinchInitialRect.width*o,a=this.pinchInitialRect.height*o;this.pinchElement.width=Math.max(r,1),this.pinchElement.height=Math.max(a,1),this.pinchElement.x=this.pinchCenter.x-r/2,this.pinchElement.y=this.pinchCenter.y-a/2,this.scene.changes.next();return}this.onMouseMove(t)}onPointerUp(t){this.pinchInitialDist=null,this.pinchInitialRect=null,this.pinchCenter=null,this.pinchElement=null,this.pinchZoomInitialDist=null,this.pinchZoomInitialScale=1,this.pinchZoomCenterScene=null,this.onMouseUp(t),this.canvas.releasePointerCapture(t.pointerId),t.pointerType==="touch"&&this.onClick(t)}onGestureStart(t){t.preventDefault(),this.gestureInitialScale=this.panZoom.scale}onGestureChange(t){t.preventDefault();let e=this.gestureInitialScale*t.scale;const s=Math.max((this.canvas.width-this.panZoom.scrollbarWidth)/this.panZoom.virtualWidth,(this.canvas.height-this.panZoom.scrollbarWidth)/this.panZoom.virtualHeight);e=Math.min(Math.max(e,s),3);const n=this.canvas.width/2,o=this.canvas.height/2,r=(n+this.panZoom.scrollX)/this.panZoom.scale,a=(o+this.panZoom.scrollY)/this.panZoom.scale;this.panZoom.scale=e,this.panZoom.scrollX=r*e-n,this.panZoom.scrollY=a*e-o,this.draw()}onGestureEnd(t){t.preventDefault()}}class Qs{constructor(){this.elements=[],this.changes=new it}addElement(t){this.elements.push(t),this.changes.next()}removeElement(t){const e=this.elements.indexOf(t);e>-1&&(this.elements.splice(e,1),this.changes.next())}removeElements(t){t.forEach(e=>{const s=this.elements.indexOf(e);s>-1&&this.elements.splice(s,1)}),this.changes.next()}getElements(){return this.elements}getShapes(){return this.elements.filter(Bt)}getConnections(){return this.elements.filter(ys)}setSelected(t){this.getElements().forEach(e=>{e.selected=!1}),t.forEach(e=>{e.selected=!0}),this.changes.next()}getSelectedElements(){return this.getElements().filter(t=>t.selected)}getSelectedShapes(){return this.getShapes().filter(t=>t.selected)}clear(){this.elements=[],this.changes.next()}}class tn{constructor(t){this.dataProvider=t}async loadDiagram(t){const e=await this.dataProvider.loadTasks(),s=await this.dataProvider.loadDependencies();e.forEach(r=>{const a=new D({id:r.id,x:r.x,y:r.y,title:r.title,description:r.description,status:r.status,priority:r.priority,dueDate:r.dueDate instanceof Date?r.dueDate:new Date(r.dueDate)});t.addElement(a)}),(await this.dataProvider.loadStories()).forEach(r=>{const a=t.getElements().filter(h=>h instanceof D&&r.tasks.indexOf(h.id)!==-1),l=new z({id:r.id,x:r.x,y:r.y,width:r.width,height:r.height,title:r.title,description:r.description,status:r.status,priority:r.priority,borderColor:r.borderColor,tasks:a});t.addElement(l)}),(await this.dataProvider.loadGoals()).forEach(r=>{const a=new nt({id:r.id,x:r.x,y:r.y,width:r.width,height:r.height,title:r.title,status:r.status,priority:r.priority});a.progress=r.progress,a.links=r.links,t.addElement(a)}),s.forEach(r=>{const a=t.getElements().find(h=>h.id===r.fromTaskId),l=t.getElements().find(h=>h.id===r.toTaskId);if(a&&l){const h=new _e(a.id,l.id);t.addElement(h)}})}async saveDiagram(t){const e=t.getElements().filter(l=>l instanceof D).map(l=>({id:l.id,x:l.x,y:l.y,title:l.title,description:l.description,status:l.status,priority:l.priority,dueDate:l.dueDate}));await this.dataProvider.saveTasks(e);const s=t.getConnections().map(l=>({fromTaskId:l.fromId,toTaskId:l.toId,type:"dependsOn"}));await this.dataProvider.saveDependencies(s);const o=t.getElements().filter(l=>l instanceof z).map(l=>({id:l.id,x:l.x,y:l.y,width:l.width,height:l.height,title:l.title,description:l.description,status:l.status,priority:l.priority,borderColor:l.borderColor,tasks:l.tasks.map(h=>h.id)}));await this.dataProvider.saveStories(o);const a=t.getElements().filter(l=>l instanceof nt).map(l=>({id:l.id,x:l.x,y:l.y,width:l.width,height:l.height,title:l.title,status:l.status,priority:l.priority,progress:l.progress,links:l.links}));await this.dataProvider.saveGoals(a)}}class Q{constructor(t){this.props=t,this.element=this.createElement()}render(t){t.appendChild(this.element)}updateProps(t){this.props={...this.props,...t},this.update()}update(){const t=this.createElement();this.element.replaceWith(t),this.element=t}getElement(){return this.element}}const Ft="-",en=i=>{const t=nn(i),{conflictingClassGroups:e,conflictingClassGroupModifiers:s}=i;return{getClassGroupId:r=>{const a=r.split(Ft);return a[0]===""&&a.length!==1&&a.shift(),Ne(a,t)||sn(r)},getConflictingClassGroupIds:(r,a)=>{const l=e[r]||[];return a&&s[r]?[...l,...s[r]]:l}}},Ne=(i,t)=>{var r;if(i.length===0)return t.classGroupId;const e=i[0],s=t.nextPart.get(e),n=s?Ne(i.slice(1),s):void 0;if(n)return n;if(t.validators.length===0)return;const o=i.join(Ft);return(r=t.validators.find(({validator:a})=>a(o)))==null?void 0:r.classGroupId},fe=/^\[(.+)\]$/,sn=i=>{if(fe.test(i)){const t=fe.exec(i)[1],e=t==null?void 0:t.substring(0,t.indexOf(":"));if(e)return"arbitrary.."+e}},nn=i=>{const{theme:t,classGroups:e}=i,s={nextPart:new Map,validators:[]};for(const n in e)Wt(e[n],s,n,t);return s},Wt=(i,t,e,s)=>{i.forEach(n=>{if(typeof n=="string"){const o=n===""?t:be(t,n);o.classGroupId=e;return}if(typeof n=="function"){if(on(n)){Wt(n(s),t,e,s);return}t.validators.push({validator:n,classGroupId:e});return}Object.entries(n).forEach(([o,r])=>{Wt(r,be(t,o),e,s)})})},be=(i,t)=>{let e=i;return t.split(Ft).forEach(s=>{e.nextPart.has(s)||e.nextPart.set(s,{nextPart:new Map,validators:[]}),e=e.nextPart.get(s)}),e},on=i=>i.isThemeGetter,rn=i=>{if(i<1)return{get:()=>{},set:()=>{}};let t=0,e=new Map,s=new Map;const n=(o,r)=>{e.set(o,r),t++,t>i&&(t=0,s=e,e=new Map)};return{get(o){let r=e.get(o);if(r!==void 0)return r;if((r=s.get(o))!==void 0)return n(o,r),r},set(o,r){e.has(o)?e.set(o,r):n(o,r)}}},Gt="!",Ut=":",an=Ut.length,ln=i=>{const{prefix:t,experimentalParseClassName:e}=i;let s=n=>{const o=[];let r=0,a=0,l=0,h;for(let p=0;p<n.length;p++){let b=n[p];if(r===0&&a===0){if(b===Ut){o.push(n.slice(l,p)),l=p+an;continue}if(b==="/"){h=p;continue}}b==="["?r++:b==="]"?r--:b==="("?a++:b===")"&&a--}const c=o.length===0?n:n.substring(l),d=cn(c),u=d!==c,f=h&&h>l?h-l:void 0;return{modifiers:o,hasImportantModifier:u,baseClassName:d,maybePostfixModifierPosition:f}};if(t){const n=t+Ut,o=s;s=r=>r.startsWith(n)?o(r.substring(n.length)):{isExternal:!0,modifiers:[],hasImportantModifier:!1,baseClassName:r,maybePostfixModifierPosition:void 0}}if(e){const n=s;s=o=>e({className:o,parseClassName:n})}return s},cn=i=>i.endsWith(Gt)?i.substring(0,i.length-1):i.startsWith(Gt)?i.substring(1):i,hn=i=>{const t=Object.fromEntries(i.orderSensitiveModifiers.map(s=>[s,!0]));return s=>{if(s.length<=1)return s;const n=[];let o=[];return s.forEach(r=>{r[0]==="["||t[r]?(n.push(...o.sort(),r),o=[]):o.push(r)}),n.push(...o.sort()),n}},dn=i=>({cache:rn(i.cacheSize),parseClassName:ln(i),sortModifiers:hn(i),...en(i)}),un=/\s+/,pn=(i,t)=>{const{parseClassName:e,getClassGroupId:s,getConflictingClassGroupIds:n,sortModifiers:o}=t,r=[],a=i.trim().split(un);let l="";for(let h=a.length-1;h>=0;h-=1){const c=a[h],{isExternal:d,modifiers:u,hasImportantModifier:f,baseClassName:p,maybePostfixModifierPosition:b}=e(c);if(d){l=c+(l.length>0?" "+l:l);continue}let x=!!b,M=s(x?p.substring(0,b):p);if(!M){if(!x){l=c+(l.length>0?" "+l:l);continue}if(M=s(p),!M){l=c+(l.length>0?" "+l:l);continue}x=!1}const S=o(u).join(":"),C=f?S+Gt:S,E=C+M;if(r.includes(E))continue;r.push(E);const T=n(M,x);for(let k=0;k<T.length;++k){const lt=T[k];r.push(C+lt)}l=c+(l.length>0?" "+l:l)}return l};function mn(){let i=0,t,e,s="";for(;i<arguments.length;)(t=arguments[i++])&&(e=Ye(t))&&(s&&(s+=" "),s+=e);return s}const Ye=i=>{if(typeof i=="string")return i;let t,e="";for(let s=0;s<i.length;s++)i[s]&&(t=Ye(i[s]))&&(e&&(e+=" "),e+=t);return e};function gn(i,...t){let e,s,n,o=r;function r(l){const h=t.reduce((c,d)=>d(c),i());return e=dn(h),s=e.cache.get,n=e.cache.set,o=a,a(l)}function a(l){const h=s(l);if(h)return h;const c=pn(l,e);return n(l,c),c}return function(){return o(mn.apply(null,arguments))}}const P=i=>{const t=e=>e[i]||[];return t.isThemeGetter=!0,t},Xe=/^\[(?:(\w[\w-]*):)?(.+)\]$/i,Ze=/^\((?:(\w[\w-]*):)?(.+)\)$/i,fn=/^\d+\/\d+$/,bn=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,yn=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,vn=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,xn=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,wn=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,et=i=>fn.test(i),w=i=>!!i&&!Number.isNaN(Number(i)),V=i=>!!i&&Number.isInteger(Number(i)),zt=i=>i.endsWith("%")&&w(i.slice(0,-1)),U=i=>bn.test(i),Sn=()=>!0,En=i=>yn.test(i)&&!vn.test(i),Be=()=>!1,Cn=i=>xn.test(i),kn=i=>wn.test(i),Mn=i=>!m(i)&&!g(i),In=i=>rt(i,Ue,Be),m=i=>Xe.test(i),K=i=>rt(i,He,En),At=i=>rt(i,Rn,w),ye=i=>rt(i,We,Be),Tn=i=>rt(i,Ge,kn),ft=i=>rt(i,Ve,Cn),g=i=>Ze.test(i),ct=i=>at(i,He),Pn=i=>at(i,zn),ve=i=>at(i,We),Ln=i=>at(i,Ue),Dn=i=>at(i,Ge),bt=i=>at(i,Ve,!0),rt=(i,t,e)=>{const s=Xe.exec(i);return s?s[1]?t(s[1]):e(s[2]):!1},at=(i,t,e=!1)=>{const s=Ze.exec(i);return s?s[1]?t(s[1]):e:!1},We=i=>i==="position"||i==="percentage",Ge=i=>i==="image"||i==="url",Ue=i=>i==="length"||i==="size"||i==="bg-size",He=i=>i==="length",Rn=i=>i==="number",zn=i=>i==="family-name",Ve=i=>i==="shadow",An=()=>{const i=P("color"),t=P("font"),e=P("text"),s=P("font-weight"),n=P("tracking"),o=P("leading"),r=P("breakpoint"),a=P("container"),l=P("spacing"),h=P("radius"),c=P("shadow"),d=P("inset-shadow"),u=P("text-shadow"),f=P("drop-shadow"),p=P("blur"),b=P("perspective"),x=P("aspect"),M=P("ease"),S=P("animate"),C=()=>["auto","avoid","all","avoid-page","page","left","right","column"],E=()=>["center","top","bottom","left","right","top-left","left-top","top-right","right-top","bottom-right","right-bottom","bottom-left","left-bottom"],T=()=>[...E(),g,m],k=()=>["auto","hidden","clip","visible","scroll"],lt=()=>["auto","contain","none"],v=()=>[g,m,l],W=()=>[et,"full","auto",...v()],qt=()=>[V,"none","subgrid",g,m],Jt=()=>["auto",{span:["full",V,g,m]},V,g,m],ht=()=>[V,"auto",g,m],Qt=()=>["auto","min","max","fr",g,m],It=()=>["start","end","center","between","around","evenly","stretch","baseline","center-safe","end-safe"],tt=()=>["start","end","center","stretch","center-safe","end-safe"],G=()=>["auto",...v()],$=()=>[et,"auto","full","dvw","dvh","lvw","lvh","svw","svh","min","max","fit",...v()],y=()=>[i,g,m],te=()=>[...E(),ve,ye,{position:[g,m]}],ee=()=>["no-repeat",{repeat:["","x","y","space","round"]}],se=()=>["auto","cover","contain",Ln,In,{size:[g,m]}],Tt=()=>[zt,ct,K],O=()=>["","none","full",h,g,m],N=()=>["",w,ct,K],dt=()=>["solid","dashed","dotted","double"],ne=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],R=()=>[w,zt,ve,ye],ie=()=>["","none",p,g,m],ut=()=>["none",w,g,m],pt=()=>["none",w,g,m],Pt=()=>[w,g,m],mt=()=>[et,"full",...v()];return{cacheSize:500,theme:{animate:["spin","ping","pulse","bounce"],aspect:["video"],blur:[U],breakpoint:[U],color:[Sn],container:[U],"drop-shadow":[U],ease:["in","out","in-out"],font:[Mn],"font-weight":["thin","extralight","light","normal","medium","semibold","bold","extrabold","black"],"inset-shadow":[U],leading:["none","tight","snug","normal","relaxed","loose"],perspective:["dramatic","near","normal","midrange","distant","none"],radius:[U],shadow:[U],spacing:["px",w],text:[U],"text-shadow":[U],tracking:["tighter","tight","normal","wide","wider","widest"]},classGroups:{aspect:[{aspect:["auto","square",et,m,g,x]}],container:["container"],columns:[{columns:[w,m,g,a]}],"break-after":[{"break-after":C()}],"break-before":[{"break-before":C()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],sr:["sr-only","not-sr-only"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:T()}],overflow:[{overflow:k()}],"overflow-x":[{"overflow-x":k()}],"overflow-y":[{"overflow-y":k()}],overscroll:[{overscroll:lt()}],"overscroll-x":[{"overscroll-x":lt()}],"overscroll-y":[{"overscroll-y":lt()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:W()}],"inset-x":[{"inset-x":W()}],"inset-y":[{"inset-y":W()}],start:[{start:W()}],end:[{end:W()}],top:[{top:W()}],right:[{right:W()}],bottom:[{bottom:W()}],left:[{left:W()}],visibility:["visible","invisible","collapse"],z:[{z:[V,"auto",g,m]}],basis:[{basis:[et,"full","auto",a,...v()]}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["nowrap","wrap","wrap-reverse"]}],flex:[{flex:[w,et,"auto","initial","none",m]}],grow:[{grow:["",w,g,m]}],shrink:[{shrink:["",w,g,m]}],order:[{order:[V,"first","last","none",g,m]}],"grid-cols":[{"grid-cols":qt()}],"col-start-end":[{col:Jt()}],"col-start":[{"col-start":ht()}],"col-end":[{"col-end":ht()}],"grid-rows":[{"grid-rows":qt()}],"row-start-end":[{row:Jt()}],"row-start":[{"row-start":ht()}],"row-end":[{"row-end":ht()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":Qt()}],"auto-rows":[{"auto-rows":Qt()}],gap:[{gap:v()}],"gap-x":[{"gap-x":v()}],"gap-y":[{"gap-y":v()}],"justify-content":[{justify:[...It(),"normal"]}],"justify-items":[{"justify-items":[...tt(),"normal"]}],"justify-self":[{"justify-self":["auto",...tt()]}],"align-content":[{content:["normal",...It()]}],"align-items":[{items:[...tt(),{baseline:["","last"]}]}],"align-self":[{self:["auto",...tt(),{baseline:["","last"]}]}],"place-content":[{"place-content":It()}],"place-items":[{"place-items":[...tt(),"baseline"]}],"place-self":[{"place-self":["auto",...tt()]}],p:[{p:v()}],px:[{px:v()}],py:[{py:v()}],ps:[{ps:v()}],pe:[{pe:v()}],pt:[{pt:v()}],pr:[{pr:v()}],pb:[{pb:v()}],pl:[{pl:v()}],m:[{m:G()}],mx:[{mx:G()}],my:[{my:G()}],ms:[{ms:G()}],me:[{me:G()}],mt:[{mt:G()}],mr:[{mr:G()}],mb:[{mb:G()}],ml:[{ml:G()}],"space-x":[{"space-x":v()}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":v()}],"space-y-reverse":["space-y-reverse"],size:[{size:$()}],w:[{w:[a,"screen",...$()]}],"min-w":[{"min-w":[a,"screen","none",...$()]}],"max-w":[{"max-w":[a,"screen","none","prose",{screen:[r]},...$()]}],h:[{h:["screen",...$()]}],"min-h":[{"min-h":["screen","none",...$()]}],"max-h":[{"max-h":["screen",...$()]}],"font-size":[{text:["base",e,ct,K]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:[s,g,At]}],"font-stretch":[{"font-stretch":["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded",zt,m]}],"font-family":[{font:[Pn,m,t]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:[n,g,m]}],"line-clamp":[{"line-clamp":[w,"none",g,At]}],leading:[{leading:[o,...v()]}],"list-image":[{"list-image":["none",g,m]}],"list-style-position":[{list:["inside","outside"]}],"list-style-type":[{list:["disc","decimal","none",g,m]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"placeholder-color":[{placeholder:y()}],"text-color":[{text:y()}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...dt(),"wavy"]}],"text-decoration-thickness":[{decoration:[w,"from-font","auto",g,K]}],"text-decoration-color":[{decoration:y()}],"underline-offset":[{"underline-offset":[w,"auto",g,m]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:v()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",g,m]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],wrap:[{wrap:["break-word","anywhere","normal"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",g,m]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:te()}],"bg-repeat":[{bg:ee()}],"bg-size":[{bg:se()}],"bg-image":[{bg:["none",{linear:[{to:["t","tr","r","br","b","bl","l","tl"]},V,g,m],radial:["",g,m],conic:[V,g,m]},Dn,Tn]}],"bg-color":[{bg:y()}],"gradient-from-pos":[{from:Tt()}],"gradient-via-pos":[{via:Tt()}],"gradient-to-pos":[{to:Tt()}],"gradient-from":[{from:y()}],"gradient-via":[{via:y()}],"gradient-to":[{to:y()}],rounded:[{rounded:O()}],"rounded-s":[{"rounded-s":O()}],"rounded-e":[{"rounded-e":O()}],"rounded-t":[{"rounded-t":O()}],"rounded-r":[{"rounded-r":O()}],"rounded-b":[{"rounded-b":O()}],"rounded-l":[{"rounded-l":O()}],"rounded-ss":[{"rounded-ss":O()}],"rounded-se":[{"rounded-se":O()}],"rounded-ee":[{"rounded-ee":O()}],"rounded-es":[{"rounded-es":O()}],"rounded-tl":[{"rounded-tl":O()}],"rounded-tr":[{"rounded-tr":O()}],"rounded-br":[{"rounded-br":O()}],"rounded-bl":[{"rounded-bl":O()}],"border-w":[{border:N()}],"border-w-x":[{"border-x":N()}],"border-w-y":[{"border-y":N()}],"border-w-s":[{"border-s":N()}],"border-w-e":[{"border-e":N()}],"border-w-t":[{"border-t":N()}],"border-w-r":[{"border-r":N()}],"border-w-b":[{"border-b":N()}],"border-w-l":[{"border-l":N()}],"divide-x":[{"divide-x":N()}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":N()}],"divide-y-reverse":["divide-y-reverse"],"border-style":[{border:[...dt(),"hidden","none"]}],"divide-style":[{divide:[...dt(),"hidden","none"]}],"border-color":[{border:y()}],"border-color-x":[{"border-x":y()}],"border-color-y":[{"border-y":y()}],"border-color-s":[{"border-s":y()}],"border-color-e":[{"border-e":y()}],"border-color-t":[{"border-t":y()}],"border-color-r":[{"border-r":y()}],"border-color-b":[{"border-b":y()}],"border-color-l":[{"border-l":y()}],"divide-color":[{divide:y()}],"outline-style":[{outline:[...dt(),"none","hidden"]}],"outline-offset":[{"outline-offset":[w,g,m]}],"outline-w":[{outline:["",w,ct,K]}],"outline-color":[{outline:y()}],shadow:[{shadow:["","none",c,bt,ft]}],"shadow-color":[{shadow:y()}],"inset-shadow":[{"inset-shadow":["none",d,bt,ft]}],"inset-shadow-color":[{"inset-shadow":y()}],"ring-w":[{ring:N()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:y()}],"ring-offset-w":[{"ring-offset":[w,K]}],"ring-offset-color":[{"ring-offset":y()}],"inset-ring-w":[{"inset-ring":N()}],"inset-ring-color":[{"inset-ring":y()}],"text-shadow":[{"text-shadow":["none",u,bt,ft]}],"text-shadow-color":[{"text-shadow":y()}],opacity:[{opacity:[w,g,m]}],"mix-blend":[{"mix-blend":[...ne(),"plus-darker","plus-lighter"]}],"bg-blend":[{"bg-blend":ne()}],"mask-clip":[{"mask-clip":["border","padding","content","fill","stroke","view"]},"mask-no-clip"],"mask-composite":[{mask:["add","subtract","intersect","exclude"]}],"mask-image-linear-pos":[{"mask-linear":[w]}],"mask-image-linear-from-pos":[{"mask-linear-from":R()}],"mask-image-linear-to-pos":[{"mask-linear-to":R()}],"mask-image-linear-from-color":[{"mask-linear-from":y()}],"mask-image-linear-to-color":[{"mask-linear-to":y()}],"mask-image-t-from-pos":[{"mask-t-from":R()}],"mask-image-t-to-pos":[{"mask-t-to":R()}],"mask-image-t-from-color":[{"mask-t-from":y()}],"mask-image-t-to-color":[{"mask-t-to":y()}],"mask-image-r-from-pos":[{"mask-r-from":R()}],"mask-image-r-to-pos":[{"mask-r-to":R()}],"mask-image-r-from-color":[{"mask-r-from":y()}],"mask-image-r-to-color":[{"mask-r-to":y()}],"mask-image-b-from-pos":[{"mask-b-from":R()}],"mask-image-b-to-pos":[{"mask-b-to":R()}],"mask-image-b-from-color":[{"mask-b-from":y()}],"mask-image-b-to-color":[{"mask-b-to":y()}],"mask-image-l-from-pos":[{"mask-l-from":R()}],"mask-image-l-to-pos":[{"mask-l-to":R()}],"mask-image-l-from-color":[{"mask-l-from":y()}],"mask-image-l-to-color":[{"mask-l-to":y()}],"mask-image-x-from-pos":[{"mask-x-from":R()}],"mask-image-x-to-pos":[{"mask-x-to":R()}],"mask-image-x-from-color":[{"mask-x-from":y()}],"mask-image-x-to-color":[{"mask-x-to":y()}],"mask-image-y-from-pos":[{"mask-y-from":R()}],"mask-image-y-to-pos":[{"mask-y-to":R()}],"mask-image-y-from-color":[{"mask-y-from":y()}],"mask-image-y-to-color":[{"mask-y-to":y()}],"mask-image-radial":[{"mask-radial":[g,m]}],"mask-image-radial-from-pos":[{"mask-radial-from":R()}],"mask-image-radial-to-pos":[{"mask-radial-to":R()}],"mask-image-radial-from-color":[{"mask-radial-from":y()}],"mask-image-radial-to-color":[{"mask-radial-to":y()}],"mask-image-radial-shape":[{"mask-radial":["circle","ellipse"]}],"mask-image-radial-size":[{"mask-radial":[{closest:["side","corner"],farthest:["side","corner"]}]}],"mask-image-radial-pos":[{"mask-radial-at":E()}],"mask-image-conic-pos":[{"mask-conic":[w]}],"mask-image-conic-from-pos":[{"mask-conic-from":R()}],"mask-image-conic-to-pos":[{"mask-conic-to":R()}],"mask-image-conic-from-color":[{"mask-conic-from":y()}],"mask-image-conic-to-color":[{"mask-conic-to":y()}],"mask-mode":[{mask:["alpha","luminance","match"]}],"mask-origin":[{"mask-origin":["border","padding","content","fill","stroke","view"]}],"mask-position":[{mask:te()}],"mask-repeat":[{mask:ee()}],"mask-size":[{mask:se()}],"mask-type":[{"mask-type":["alpha","luminance"]}],"mask-image":[{mask:["none",g,m]}],filter:[{filter:["","none",g,m]}],blur:[{blur:ie()}],brightness:[{brightness:[w,g,m]}],contrast:[{contrast:[w,g,m]}],"drop-shadow":[{"drop-shadow":["","none",f,bt,ft]}],"drop-shadow-color":[{"drop-shadow":y()}],grayscale:[{grayscale:["",w,g,m]}],"hue-rotate":[{"hue-rotate":[w,g,m]}],invert:[{invert:["",w,g,m]}],saturate:[{saturate:[w,g,m]}],sepia:[{sepia:["",w,g,m]}],"backdrop-filter":[{"backdrop-filter":["","none",g,m]}],"backdrop-blur":[{"backdrop-blur":ie()}],"backdrop-brightness":[{"backdrop-brightness":[w,g,m]}],"backdrop-contrast":[{"backdrop-contrast":[w,g,m]}],"backdrop-grayscale":[{"backdrop-grayscale":["",w,g,m]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[w,g,m]}],"backdrop-invert":[{"backdrop-invert":["",w,g,m]}],"backdrop-opacity":[{"backdrop-opacity":[w,g,m]}],"backdrop-saturate":[{"backdrop-saturate":[w,g,m]}],"backdrop-sepia":[{"backdrop-sepia":["",w,g,m]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":v()}],"border-spacing-x":[{"border-spacing-x":v()}],"border-spacing-y":[{"border-spacing-y":v()}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["","all","colors","opacity","shadow","transform","none",g,m]}],"transition-behavior":[{transition:["normal","discrete"]}],duration:[{duration:[w,"initial",g,m]}],ease:[{ease:["linear","initial",M,g,m]}],delay:[{delay:[w,g,m]}],animate:[{animate:["none",S,g,m]}],backface:[{backface:["hidden","visible"]}],perspective:[{perspective:[b,g,m]}],"perspective-origin":[{"perspective-origin":T()}],rotate:[{rotate:ut()}],"rotate-x":[{"rotate-x":ut()}],"rotate-y":[{"rotate-y":ut()}],"rotate-z":[{"rotate-z":ut()}],scale:[{scale:pt()}],"scale-x":[{"scale-x":pt()}],"scale-y":[{"scale-y":pt()}],"scale-z":[{"scale-z":pt()}],"scale-3d":["scale-3d"],skew:[{skew:Pt()}],"skew-x":[{"skew-x":Pt()}],"skew-y":[{"skew-y":Pt()}],transform:[{transform:[g,m,"","none","gpu","cpu"]}],"transform-origin":[{origin:T()}],"transform-style":[{transform:["3d","flat"]}],translate:[{translate:mt()}],"translate-x":[{"translate-x":mt()}],"translate-y":[{"translate-y":mt()}],"translate-z":[{"translate-z":mt()}],"translate-none":["translate-none"],accent:[{accent:y()}],appearance:[{appearance:["none","auto"]}],"caret-color":[{caret:y()}],"color-scheme":[{scheme:["normal","dark","light","light-dark","only-dark","only-light"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",g,m]}],"field-sizing":[{"field-sizing":["fixed","content"]}],"pointer-events":[{"pointer-events":["auto","none"]}],resize:[{resize:["none","","y","x"]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":v()}],"scroll-mx":[{"scroll-mx":v()}],"scroll-my":[{"scroll-my":v()}],"scroll-ms":[{"scroll-ms":v()}],"scroll-me":[{"scroll-me":v()}],"scroll-mt":[{"scroll-mt":v()}],"scroll-mr":[{"scroll-mr":v()}],"scroll-mb":[{"scroll-mb":v()}],"scroll-ml":[{"scroll-ml":v()}],"scroll-p":[{"scroll-p":v()}],"scroll-px":[{"scroll-px":v()}],"scroll-py":[{"scroll-py":v()}],"scroll-ps":[{"scroll-ps":v()}],"scroll-pe":[{"scroll-pe":v()}],"scroll-pt":[{"scroll-pt":v()}],"scroll-pr":[{"scroll-pr":v()}],"scroll-pb":[{"scroll-pb":v()}],"scroll-pl":[{"scroll-pl":v()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",g,m]}],fill:[{fill:["none",...y()]}],"stroke-w":[{stroke:[w,ct,K,At]}],stroke:[{stroke:["none",...y()]}],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-x","border-w-y","border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-x","border-color-y","border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],translate:["translate-x","translate-y","translate-none"],"translate-none":["translate","translate-x","translate-y","translate-z"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]},orderSensitiveModifiers:["*","**","after","backdrop","before","details-content","file","first-letter","first-line","marker","placeholder","selection"]}},Z=gn(An);class xt extends Q{createElement(){const t=document.createElement("button");t.type=this.props.type||"button",this.props.text&&(t.innerText=this.props.text),this.props.children&&(typeof this.props.children=="string"?t.innerText=this.props.children:t.appendChild(this.props.children)),this.props.onClick&&t.addEventListener("click",this.props.onClick),this.props.disabled&&(t.disabled=!0),this.props.tooltip&&(t.title=this.props.tooltip);const e=["inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors","focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2","disabled:pointer-events-none disabled:opacity-30 disabled:grayscale disabled:cursor-not-allowed","[&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0","cursor-pointer"].join(" "),s={default:"bg-primary text-white hover:bg-primary/90 active:bg-primary/80 transition-colors",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90 active:bg-destructive/80 transition-colors",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground active:bg-accent/80 transition-colors",secondary:"bg-gray-100 text-gray-900 hover:bg-gray-200 active:bg-gray-300 transition-colors",ghost:"hover:bg-accent hover:text-accent-foreground active:bg-accent/80 transition-colors",link:"text-primary underline-offset-4 hover:underline active:text-primary/80 transition-colors",lightgray:"bg-gray-200 text-gray-900 hover:bg-gray-300 active:bg-gray-400 border border-gray-300 transition-colors"},n={default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"},o=this.props.variant||"default",r=this.props.size||"default";return t.className=Z(e,s[o],n[r],this.props.className||""),t}}class $t{constructor(){this.listeners=[]}on(t){this.listeners.push(t)}emit(t){this.listeners.forEach(e=>e(t))}}class Ht extends Q{constructor(t){super(t),this.changeEmitter=new $t,t.onChange&&this.onChange(t.onChange)}createElement(){const t=document.createElement("input");t.type=this.props.type||"text",this.props.value!==void 0&&(t.value=this.props.value),this.props.placeholder&&(t.placeholder=this.props.placeholder),this.props.disabled&&(t.disabled=!0),this.props.name&&(t.name=this.props.name),this.props.id&&(t.id=this.props.id),this.props.autoFocus&&(t.autofocus=!0),this.props.autoComplete&&(t.autocomplete=this.props.autoComplete),this.props.required&&(t.required=!0),this.props.minLength!==void 0&&(t.minLength=this.props.minLength),this.props.maxLength!==void 0&&(t.maxLength=this.props.maxLength),this.props.pattern&&(t.pattern=this.props.pattern),t.addEventListener("input",()=>{this.changeEmitter.emit(t.value)});const e=["flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background","placeholder:text-muted-foreground","focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2","disabled:cursor-not-allowed disabled:opacity-50"].join(" ");return t.className=Z(e,this.props.className||""),t}onChange(t){this.changeEmitter.on(t)}setValue(t){this.updateProps({value:t})}getValue(){return this.element.value}}function je(i,t){const e=document.createElement("div");St.register(),e.className="fixed inset-0 bg-black/15 backdrop-blur-xs flex items-center justify-center";const s=(t==null?void 0:t.zIndex)??200;e.style.zIndex=s.toString();const n=document.createElement("div");n.className="bg-white rounded-lg p-6 w-96 space-y-4 shadow-lg",n.tabIndex=0;const o=document.createElement("h2");o.className="text-lg font-semibold",o.textContent=i,n.appendChild(o),e.appendChild(n),document.body.appendChild(e);const r=e.remove;e.remove=function(){const u=document.activeElement;u&&typeof u.blur=="function"&&u.blur(),St.unregister(),r.call(this)},t!=null&&t.onClose&&e.addEventListener("click",u=>{u.target===e&&t.onClose()}),n.setAttribute("role","dialog"),n.setAttribute("aria-modal","true");const a=`modal-title-${Math.random().toString(36).substr(2,9)}`;o.id=a,n.setAttribute("aria-labelledby",a),n.focus();const h=Array.from(n.querySelectorAll('a[href], area[href], input, select, textarea, button, iframe, object, embed, [tabindex]:not([tabindex="-1"])')).filter(u=>!u.hasAttribute("disabled")),c=h[0],d=h[h.length-1];return n.addEventListener("keydown",u=>{u.key==="Tab"&&(u.shiftKey?document.activeElement===c&&(u.preventDefault(),d.focus()):document.activeElement===d&&(u.preventDefault(),c.focus()))}),{overlay:e,container:n}}const Fe=new it;function Y(i,t="info"){Fe.next({message:i,type:t})}class On extends Q{constructor(t,e){super(t),this.modal=null,this.errorMessage=null,this.isLoading=!1,this.authService=e,this.avatarContainer=document.createElement("div"),this.avatarContainer.className="absolute top-4 right-4",this.loginButton=new xt({text:"Login",onClick:()=>this.showLoginModal(),variant:"default",className:"w-full"}).createElement(),this.logoutButton=new xt({text:"Logout",onClick:()=>this.handleLogout(),variant:"destructive",className:"w-full"}).createElement(),this.dropdownMenu=document.createElement("div"),this.dropdownMenu.className="absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg z-10 hidden",this.dropdownMenu.appendChild(this.logoutButton),this.avatarContainer.appendChild(this.dropdownMenu),t instanceof Node?this.avatarContainer instanceof Node?t.appendChild(this.avatarContainer):console.error("avatarContainer is not a valid DOM node",this.avatarContainer):console.error("Container is not a valid DOM node",t),this.updateUI()}createElement(){return this.avatarContainer}updateUI(){var t;this.authService.isLoggedIn()?(this.authService.getAuthToken(),this.avatarContainer.innerHTML='<img src="avatar-url-placeholder" alt="User Avatar" class="w-10 h-10 rounded-full cursor-pointer">',(t=this.avatarContainer.firstChild)==null||t.addEventListener("click",()=>this.toggleDropdown()),this.avatarContainer.appendChild(this.dropdownMenu)):(this.avatarContainer.innerHTML="",this.avatarContainer.appendChild(this.loginButton))}toggleDropdown(){this.dropdownMenu.classList.contains("hidden")?this.dropdownMenu.classList.remove("hidden"):this.dropdownMenu.classList.add("hidden")}showLoginModal(){if(this.modal)return;const{overlay:t,container:e}=je("Login to Majom Canvas",{onClose:()=>this.closeModal()});this.modal=t;const s=document.createElement("form");s.id="loginForm";const n=document.createElement("div");n.className="mb-4";const o=document.createElement("label");o.htmlFor="username",o.className="block text-sm font-medium text-gray-700",o.textContent="Username";const r=new Ht({id:"username",name:"username",type:"text",placeholder:"Enter your username",className:"mt-1"}).createElement();n.append(o,r);const a=document.createElement("div");a.className="mb-4";const l=document.createElement("label");l.htmlFor="password",l.className="block text-sm font-medium text-gray-700",l.textContent="Password";const h=new Ht({id:"password",name:"password",type:"password",placeholder:"Enter your password",className:"mt-1"}).createElement();a.append(l,h),this.errorMessage=document.createElement("div"),this.errorMessage.className="mt-2 text-red-500 hidden";const c=new xt({text:"Login",type:"submit",variant:"default",className:"w-full"}).createElement();c.id="loginSubmit",s.append(n,a,c),e.append(s,this.errorMessage),s.addEventListener("submit",d=>this.handleLoginSubmit(d))}closeModal(){this.modal&&(this.modal.remove(),this.modal=null,this.errorMessage=null)}async handleLoginSubmit(t){if(t.preventDefault(),this.isLoading||!this.modal)return;const e=this.modal.querySelector("#username"),s=this.modal.querySelector("#password"),n=this.modal.querySelector("#loginSubmit"),o={username:e.value,password:s.value};this.isLoading=!0,n.disabled=!0,n.textContent="Logging in...";try{await this.authService.login(o),this.isLoading=!1,Y("Logged in successfully","success"),this.closeModal(),this.updateUI(),window.dispatchEvent(new CustomEvent("refreshCanvasData"))}catch(r){this.isLoading=!1,n.disabled=!1,n.textContent="Login";const a=r instanceof Error?r.message:"Login failed. Please try again.";Y(a,"error"),this.errorMessage&&(this.errorMessage.classList.remove("hidden"),this.errorMessage.textContent=a)}}handleLogout(){this.authService.logout(),Y("Logged out","info"),this.updateUI(),this.dropdownMenu.classList.add("hidden"),window.dispatchEvent(new CustomEvent("refreshCanvasData"))}}const _n={apiUrl:"https://mxll.pythonanywhere.com"};class Nn{constructor(t){this.baseUrl=_n.apiUrl,t&&(this.baseUrl=t)}async login(t){try{const e=await fetch(`${this.baseUrl}/token/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!e.ok)throw new Error("Login failed. Please check your credentials.");const s=await e.json();return this.setTokens({access:s.access,refresh:s.refresh}),s}catch(e){throw new Error(e instanceof Error?e.message:"An error occurred during login.")}}async refreshToken(){try{const t=this.getRefreshToken();if(!t)throw new Error("No refresh token available.");const e=await fetch(`${this.baseUrl}/token/refresh/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refresh:t})});if(!e.ok)throw new Error("Token refresh failed.");const s=await e.json();return this.setToken(s.access),{access:s.access}}catch(t){throw new Error(t instanceof Error?t.message:"An error occurred during token refresh.")}}logout(){this.removeTokens()}setTokens(t){localStorage.setItem("jwt",t.access),localStorage.setItem("refresh",t.refresh)}setToken(t){localStorage.setItem("jwt",t)}setRefreshToken(t){localStorage.setItem("refresh",t)}removeTokens(){localStorage.removeItem("jwt"),localStorage.removeItem("refresh")}getAuthToken(){return localStorage.getItem("jwt")}async getUser(){try{const t=this.getAuthToken();if(!t)throw new Error("No auth token found. User is not authenticated.");const e=await fetch(`${this.baseUrl}/user/`,{headers:{Authorization:`Bearer ${t}`}});if(!e.ok)throw new Error("Failed to fetch user data.");return await e.json()}catch(t){throw new Error(t instanceof Error?t.message:"An error occurred while fetching user data.")}}getRefreshToken(){return localStorage.getItem("refresh")}isLoggedIn(){const t=this.getRefreshToken();return t?!this.isTokenExpired(t):!1}isTokenExpired(t){try{const e=this.decodeToken(t);if(!(e!=null&&e.exp))return!0;const s=e.exp*1e3;return Date.now()>s}catch{return!0}}decodeToken(t){try{const e=t.split(".")[1];return JSON.parse(atob(e))}catch{return null}}}const xe={button:{primary:"bg-blue-500 text-white hover:bg-blue-600",secondary:"bg-gray-500 text-white hover:bg-gray-600",danger:"bg-red-500 text-white hover:bg-red-600"},input:"border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",checkbox:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"},Kt=class Kt{static setTheme(t){this.theme={...xe,...t}}static getTheme(){return this.theme}};Kt.theme=xe;let Vt=Kt;class Yn extends Q{constructor(t){super(t),this.changeEmitter=new $t,t.onChange&&this.onChange(t.onChange)}createElement(){this.container=document.createElement("div"),this.container.className="flex items-center",this.input=document.createElement("input"),this.input.type="checkbox",this.input.checked=this.props.checked,this.input.addEventListener("change",()=>{this.changeEmitter.emit(this.input.checked)});const e=Vt.getTheme().checkbox;return this.input.className=Z(e,this.props.className||""),this.container.appendChild(this.input),this.props.label&&(this.labelElement=document.createElement("label"),this.labelElement.innerText=this.props.label,this.labelElement.className="ml-2",this.container.appendChild(this.labelElement)),this.container}onChange(t){this.changeEmitter.on(t)}setChecked(t){this.updateProps({checked:t})}isChecked(){return this.input.checked}}class Xn extends Q{constructor(t){super(t),this.props=t,this.isListVisible=!1}createElement(){var n;this.filteredItems=[...this.props.items];const t=this.props.selectedValue&&((n=this.props.items.find(o=>o.value===this.props.selectedValue))==null?void 0:n.label)||"";this.filterInput=_.createInput({value:t,placeholder:this.props.placeholder??"Search items...",onChange:o=>this.filterItems(o)}),this.props.selectedValue&&(this.filteredItems=this.props.items.filter(o=>o.value===this.props.selectedValue)),this.props.onSelect&&(this.selectEmitter||(this.selectEmitter=new $t),this.onSelect(this.props.onSelect));const e=document.createElement("div");e.className=Z("relative flex flex-col gap-2",this.props.className||"");const s=document.createElement("div");return this.filterInput.render(s),e.appendChild(s),this.listContainer=document.createElement("ul"),this.listContainer.className=Z("absolute z-60 top-full left-0 w-full flex flex-col gap-2 mt-1 bg-gray-100 rounded-lg shadow-lg max-h-60 overflow-y-auto",this.isListVisible?"block":"hidden"),this.renderItems(),e.appendChild(this.listContainer),this.filterInput.getElement().addEventListener("focus",()=>{this.isListVisible=!0,this.updateListVisibility()}),this.filterInput.getElement().addEventListener("blur",()=>{setTimeout(()=>{this.isListVisible=!1,this.updateListVisibility()},150)}),e}filterItems(t){const e=t.toLowerCase();this.filteredItems=this.props.items.filter(s=>s.label.toLowerCase().includes(e)),this.isListVisible=!0,this.renderItems()}renderItems(){if(this.listContainer.innerHTML="",this.filteredItems.length===0){const t=document.createElement("li");t.textContent="No items found",t.className=Z("px-3 py-2 text-gray-500 italic text-center bg-white rounded-lg border-2 border-gray-200"),this.listContainer.appendChild(t)}else this.filteredItems.forEach(t=>{const e=document.createElement("li");e.textContent=t.label,e.className=Z("px-3 py-2 text-gray-800 hover:bg-gray-200 cursor-pointer"),e.addEventListener("click",()=>{this.selectItem(t)}),this.listContainer.appendChild(e)});this.updateListVisibility()}selectItem(t){this.filterInput.setValue(t.label),this.isListVisible=!1,this.selectEmitter.emit(t.value),this.updateListVisibility()}updateListVisibility(){this.listContainer.className=Z("absolute z-60 top-full left-0 w-full flex flex-col gap-2 mt-1 bg-gray-100 rounded-lg shadow-lg max-h-60 overflow-y-auto",this.isListVisible?"block":"hidden")}updateItems(t){this.props.items=t,this.filteredItems=[...t],this.filterItems(this.filterInput.getValue())}onSelect(t){this.selectEmitter.on(t)}getSelectedValue(){return this.filterInput.getValue()}}class Zn extends Q{constructor(t){super(t),this.props=t}createElement(){const t=document.createElement("select"),e=["appearance-none inline-flex items-center justify-between w-full gap-2 whitespace-nowrap rounded-md border border-input bg-background px-4 py-2 text-sm font-medium text-foreground ring-offset-background transition-colors cursor-pointer","focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2","disabled:pointer-events-none disabled:opacity-50"].join(" ");return t.className=Z(e,this.props.className??""),this.props.items.forEach(s=>{const n=document.createElement("option");n.value=s.value,n.textContent=s.label,this.props.selectedValue===s.value&&(n.selected=!0),t.appendChild(n)}),t.addEventListener("change",s=>{const n=s.target.value;this.props.onChange&&this.props.onChange(n)}),t}}class _{static createButton(t){return new xt(t)}static createInput(t){return new Ht(t)}static createCheckbox(t){return new Yn(t)}static createSearchSelect(t){return new Xn(t)}static createSelect(t){return new Zn(t)}}const we="ui-lib-toast-progress-style";if(typeof document<"u"&&!document.getElementById(we)){const i=document.createElement("style");i.id=we,i.textContent=`
@keyframes toast-progress {
  from { width: 100%; }
  to { width: 0%; }
}`,document.head.appendChild(i)}const Bn={success:'<svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-green-500 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>',error:'<svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-red-500 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>',info:'<svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-blue-500 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01"/><circle cx="12" cy="12" r="9"/></svg>'},Wn='<svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 text-gray-500" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>';class Gn extends Q{constructor(t){super(t),this.timeoutId=null,this.remaining=t.duration??3e3,this.startTime=0}render(t){super.render(t);const e=this.getElement();if(!e)return;requestAnimationFrame(()=>e.classList.remove("opacity-0","translate-x-2"));const s=e.querySelector(".progress-bar");this.startTime=Date.now(),s&&(s.style.animationPlayState="running");const n=()=>{this.props.onDismiss&&this.props.onDismiss(),e.remove(),s&&(s.style.animationPlayState="paused"),this.timeoutId&&clearTimeout(this.timeoutId)};this.timeoutId=window.setTimeout(n,this.remaining),e.addEventListener("mouseenter",()=>{this.timeoutId&&clearTimeout(this.timeoutId),s&&(s.style.animationPlayState="paused"),this.remaining-=Date.now()-this.startTime}),e.addEventListener("mouseleave",()=>{this.startTime=Date.now(),s&&(s.style.animationPlayState="running"),this.timeoutId=window.setTimeout(n,this.remaining)})}createElement(){const{message:t,type:e="info",className:s="",onDismiss:n,duration:o=3e3}=this.props,r=document.createElement("div"),a="opacity-0 translate-x-2 transition ease-out duration-300",l="flex items-start justify-between p-4 rounded-md shadow-md transition relative overflow-hidden",h={success:"bg-green-50 text-green-800",error:"bg-red-50 text-red-800",info:"bg-blue-50 text-blue-800"}[e];r.className=Z(l,h,s,a);const c=document.createElement("div");c.className="absolute bottom-0 left-0 w-full h-1 bg-gray-200";const d=document.createElement("div");d.className="h-full bg-current progress-bar",d.style.width="100%",d.style.animationName="toast-progress",d.style.animationDuration=`${o}ms`,d.style.animationTimingFunction="linear",d.style.animationFillMode="forwards",d.style.animationPlayState="paused",c.appendChild(d),r.appendChild(c);const u=document.createElement("span");u.innerHTML=Bn[e];const f=document.createElement("div");f.className="ml-3 flex-1 text-sm font-medium",f.textContent=t;const p=document.createElement("button");return p.type="button",p.className="ml-4 p-1 rounded-full hover:bg-black/10 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary",p.innerHTML=Wn,n&&p.addEventListener("click",n),r.append(u,f,p),r}}class Un{constructor(t){this.canvasManager=t,this.container=document.createElement("div"),this.container.style.position="absolute",this.container.style.right="12px",this.container.style.bottom="12px",this.container.style.display="flex",this.container.style.flexDirection="column",this.container.style.gap="8px",this.container.style.background="rgba(255,255,255,0.95)",this.container.style.borderRadius="8px",this.container.style.boxShadow="0 2px 10px rgba(0,0,0,0.08)",this.container.style.padding="8px";const e="secondary",s=_.createButton({text:"+",variant:e,size:"icon",onClick:()=>this.canvasManager.zoomIn(),tooltip:"Zoom In"}).createElement(),n=_.createButton({text:"-",variant:e,size:"icon",onClick:()=>this.canvasManager.zoomOut(),tooltip:"Zoom Out"}).createElement(),o=_.createButton({text:"⦿",variant:e,size:"icon",onClick:()=>this.canvasManager.centerCanvas(),tooltip:"Center Canvas"}).createElement();this.container.appendChild(s),this.container.appendChild(n),this.container.appendChild(o)}mount(t=document.body){t.appendChild(this.container)}unmount(){this.container.remove()}}class Hn{constructor(t){this.canvasManager=t,this.container=document.createElement("div"),this.container.style.position="absolute",this.container.style.left="12px",this.container.style.bottom="12px",this.container.style.background="rgba(255,255,255,0.95)",this.container.style.borderRadius="8px",this.container.style.boxShadow="0 1px 4px rgba(0,0,0,0.08)",this.container.style.padding="6px 16px",this.container.style.fontSize="1.1rem",this.container.style.fontWeight="500",this.container.style.color="#222",this.valueEl=document.createElement("span"),this.container.appendChild(this.valueEl),this.update(),this.canvasManager.panZoom.onZoomChange(()=>this.update())}mount(t=document.body){t.appendChild(this.container)}update(){const t=Math.round(this.canvasManager.panZoom.scale*100);this.valueEl.textContent=`${t}%`}unmount(){this.container.remove()}}class Vn{constructor(t,e){this.scene=t,this.canvasManager=e,this.container=this.createToolbarContainer(),this.addButtons()}createToolbarContainer(){const t=document.createElement("div");return t.className="canvas-toolbar",t.style.position="absolute",t.style.top="12px",t.style.left="50%",t.style.transform="translateX(-50%)",t.style.display="flex",t.style.gap="8px",t.style.padding="8px",t.style.background="white",t.style.borderRadius="8px",t.style.boxShadow="0 2px 10px rgba(0,0,0,0.1)",t.style.zIndex="100",t}addButtons(){_.createButton({text:"Select",variant:"secondary",onClick:()=>this.handleSelectMode(),tooltip:"Select elements on canvas"}).createElement();const t=_.createButton({text:"Task",variant:"secondary",onClick:()=>this.createTask(),tooltip:"Create a new task on canvas"}).createElement(),e=_.createButton({text:"Story",variant:"secondary",onClick:()=>this.createStory(),tooltip:"Create a new story on canvas"}).createElement(),s=_.createButton({text:"Goal",variant:"secondary",onClick:()=>this.createGoal(),tooltip:"Create a new goal on canvas"}).createElement();this.container.appendChild(t),this.container.appendChild(e),this.container.appendChild(s)}handleSelectMode(){console.log("Select mode activated")}createTask(){const t=this.canvasManager.canvas.width/2,e=this.canvasManager.canvas.height/2,s=this.canvasManager.getPanZoomManager(),n=(t+s.scrollX)/s.scale-D.width/2,o=(e+s.scrollY)/s.scale-D.height/2,r=new D({x:n,y:o});this.scene.addElement(r),this.scene.setSelected([r]),this.canvasManager.draw(),Y("Task created","success")}createStory(){const t=this.canvasManager.canvas.width/2,e=this.canvasManager.canvas.height/2,s=this.canvasManager.getPanZoomManager(),n=(t+s.scrollX)/s.scale-z.width/2,o=(e+s.scrollY)/s.scale-z.height/2,r=new z({x:n,y:o});this.scene.addElement(r),this.scene.setSelected([r]),this.canvasManager.draw(),Y("Story created","success")}createGoal(){const t=this.canvasManager.canvas.width/2,e=this.canvasManager.canvas.height/2,s=this.canvasManager.getPanZoomManager(),n=(t+s.scrollX)/s.scale-100,o=(e+s.scrollY)/s.scale-60,r=new nt({x:n,y:o});this.scene.addElement(r),this.scene.setSelected([r]),this.canvasManager.draw(),Y("Goal created","success")}mount(t=document.body){t.appendChild(this.container)}unmount(){this.container.parentElement&&this.container.parentElement.removeChild(this.container)}}class jn{constructor(t,e){this.element=t,this.scene=e,this.modal=null}show(){const t=this.element instanceof D?"Task":this.element instanceof z?"Story":"Goal",{overlay:e,container:s}=je(`Edit ${t}`,{onClose:()=>this.close()});let n=this.element.title,o=this.element.description,r=this.element.status,a=this.element.priority;const l=document.createElement("div");l.className="mb-4";const h=document.createElement("label");h.className="block text-sm font-medium text-gray-700",h.textContent="Title",l.appendChild(h),_.createInput({value:n,onChange:k=>{n=k},autoFocus:!0,className:"w-full"}).render(l),s.appendChild(l);const d=document.createElement("div");d.className="mb-4";const u=document.createElement("label");u.className="block text-sm font-medium text-gray-700",u.textContent="Description",d.appendChild(u);const f=document.createElement("textarea");f.value=o,f.className="w-full border rounded p-2",f.rows=3,f.addEventListener("input",k=>{o=k.target.value}),d.appendChild(f),s.appendChild(d);const p=document.createElement("div");p.className="mb-4";const b=document.createElement("label");b.className="block text-sm font-medium text-gray-700",b.textContent="Status",p.appendChild(b),_.createSelect({items:Us,selectedValue:r,onChange:k=>{r=k},className:"w-full"}).render(p),s.appendChild(p);const M=document.createElement("div");M.className="mb-4";const S=document.createElement("label");S.className="block text-sm font-medium text-gray-700",S.textContent="Priority",M.appendChild(S),_.createSelect({items:[{value:"low",label:"Low"},{value:"medium",label:"Medium"},{value:"high",label:"High"}],selectedValue:a,onChange:k=>{a=k},className:"w-full"}).render(M),s.appendChild(M);const E=()=>{this.element.title=n,this.element.description=o,this.element.status=r,this.element.priority=a,this.scene.changes.next(),Y("Saved!","success"),this.close()},T=document.createElement("div");T.className="flex justify-end space-x-2",_.createButton({text:"Cancel",onClick:()=>this.close(),variant:"outline"}).render(T),_.createButton({text:"Save",onClick:E,variant:"default"}).render(T),s.appendChild(T),s.addEventListener("keydown",k=>{k.stopPropagation(),k.key==="Enter"&&(k.preventDefault(),E()),k.key==="Escape"&&(k.preventDefault(),this.close())}),this.modal=e}close(){this.modal&&(this.modal.remove(),this.modal=null)}}class Fn{constructor(){this.subscription=null,this.container=document.createElement("div"),this.container.className="fixed top-4 right-4 flex flex-col space-y-2 z-50"}mount(t=document.body){t.appendChild(this.container),this.subscription=Fe.subscribe(({message:e,type:s})=>{const n=new Gn({message:e,type:s,onDismiss:()=>n.getElement().remove()});n.render(this.container),setTimeout(()=>n.getElement().remove(),3e3)})}unmount(){var t;(t=this.subscription)==null||t.unsubscribe(),this.container.parentElement&&this.container.remove()}}class $n{constructor(t){this.toolbarContainer=t,this.container=document.createElement("div"),this.container.style.position="absolute",this.container.style.display="flex",this.container.style.gap="8px",this.container.style.background="rgba(255,255,255,0.95)",this.container.style.borderRadius="8px",this.container.style.boxShadow="0 2px 10px rgba(0,0,0,0.08)",this.container.style.padding="8px",this.container.style.zIndex="100";const e="secondary";this.undoBtn=_.createButton({text:"↺",variant:e,size:"icon",onClick:()=>I.undo(),tooltip:"Undo"}).createElement(),this.undoBtn.style.transform="rotate(-90deg)",this.redoBtn=_.createButton({text:"↻",variant:e,size:"icon",onClick:()=>I.redo(),tooltip:"Redo"}).createElement(),this.redoBtn.style.transform="rotate(90deg)",this.container.appendChild(this.undoBtn),this.container.appendChild(this.redoBtn),this.subscription=I.changes.subscribe(()=>this.updateButtons()),this.updateButtons()}mount(t=document.body){const e=this.toolbarContainer.getBoundingClientRect();this.container.style.left=`${e.right+12}px`,this.container.style.top=`${e.top}px`,t.appendChild(this.container)}updateButtons(){this.undoBtn.disabled=!I.canUndo(),this.redoBtn.disabled=!I.canRedo()}unmount(){this.subscription.unsubscribe(),this.container.remove()}}class Kn{constructor(t,e){this.canvasManager=t,this.scene=e,this.components=[],this.canvasToolbar=new Vn(this.scene,this.canvasManager),this.canvasControls=new Un(this.canvasManager),this.zoomIndicator=new Hn(this.canvasManager),this.undoRedoControls=new $n(this.canvasToolbar.container),this.components.push(this.canvasControls,this.zoomIndicator,this.canvasToolbar,this.undoRedoControls);const s=new Fn;this.components.push(s),Mt.subscribe(n=>new jn(n,this.scene).show())}mountAll(t=document.body){this.components.forEach(e=>e.mount(t))}unmountAll(){this.components.forEach(t=>t.unmount())}}class qn{constructor(){this.handlers=new Map,document.addEventListener("keydown",this.handleKeyDown.bind(this))}register(t,e){const s=t.toLowerCase();this.handlers.has(s)||this.handlers.set(s,[]),this.handlers.get(s).push(e)}unregister(t,e){const s=t.toLowerCase();if(this.handlers.has(s))if(!e)this.handlers.delete(s);else{const n=this.handlers.get(s).filter(o=>o!==e);n.length?this.handlers.set(s,n):this.handlers.delete(s)}}handleKeyDown(t){if(St.isOpen()||document.querySelector('[role="dialog"]'))return;const e=t.target;if(e.tagName==="INPUT"||e.tagName==="TEXTAREA"||e.tagName==="SELECT"||e.isContentEditable)return;const s=this.normalize(t),n=this.handlers.get(s)||[];n.length&&(t.preventDefault(),t.stopPropagation(),n.forEach(o=>o(t)))}normalize(t){const e=[];return t.ctrlKey&&e.push("ctrl"),t.shiftKey&&e.push("shift"),t.altKey&&e.push("alt"),t.metaKey&&e.push("meta"),e.push(t.key.toLowerCase()),e.join("+")}}const Jn=new qn;class Qn{constructor(){this.commands=new Map}register(t,e){this.commands.set(t,e)}bindShortcut(t,e){if(!this.commands.has(t)){console.warn(`Command "${t}" is not registered.`);return}Jn.register(e,()=>{this.execute(t)})}execute(t){const e=this.commands.get(t);e?e():console.warn(`No handler found for command "${t}".`)}list(){return Array.from(this.commands.keys())}}const Se=new Qn;class ti{constructor(){this.items=[]}copy(t){this.items=t.map(e=>{const s=e.clone();return s.id=q(),s})}paste(t,e){let s=0,n=0;if(e&&this.items.length){const r=jt(this.items.map(a=>({x:a.x,y:a.y})));s=r.minX,n=r.minY}return this.items.map(r=>{const a=r.clone();if(a.id=q(),e){const l=r.x-s,h=r.y-n;a.x=e.x+l,a.y=e.y+h}return t.addElement(a),a})}clear(){this.items=[]}getItems(){return this.items}}const Et=new ti;class ei extends B{constructor(t){super(),this.scene=t,this.elements=[]}execute(){const t=this.scene.getSelectedElements().filter(e=>e instanceof ot);this.elements=t,Et.copy(this.elements),Y(`Copied ${this.elements.length} items`,"info")}undo(){Et.clear(),Y("Clipboard cleared","info")}}class si extends B{constructor(t,e){super(),this.scene=t,this.canvasManager=e,this.clones=[]}execute(){let t=this.canvasManager.getLastMouseCoords();if(!t){const e=this.canvasManager.getCanvas(),s=this.canvasManager.getPanZoomManager();t={x:(e.width/2+s.scrollX)/s.scale,y:(e.height/2+s.scrollY)/s.scale}}this.clones=Et.paste(this.scene,t),Y(`Pasted ${this.clones.length} items`,"success")}undo(){this.clones.forEach(t=>this.scene.removeElement(t)),Y(`Undid paste of ${this.clones.length} items`,"info")}}class ni extends B{constructor(t){super(),this.elements=[],this.scene=t}execute(){const t=this.scene.getSelectedElements().filter(e=>e instanceof ot);this.elements=t,Et.copy(this.elements),this.scene.removeElements(this.elements),Y(`Cut ${this.elements.length} items`,"info")}undo(){this.elements.forEach(t=>this.scene.addElement(t)),Y(`Restored ${this.elements.length} items`,"success")}}class ii extends B{constructor(t,e){super(),this.scene=t,this.elements=[...e]}execute(){this.scene.removeElements(this.elements)}undo(){this.elements.forEach(t=>this.scene.addElement(t))}}class oi extends B{constructor(t){super(),this.canvasManager=t}execute(){const t=this.canvasManager.getPanZoomManager();this.prevState={scrollX:t.scrollX,scrollY:t.scrollY,scale:t.scale},this.canvasManager.zoomIn()}undo(){this.canvasManager.getPanZoomManager().setViewState(this.prevState),this.canvasManager.draw()}}class ri extends B{constructor(t){super(),this.canvasManager=t}execute(){const t=this.canvasManager.getPanZoomManager();this.prevState={scrollX:t.scrollX,scrollY:t.scrollY,scale:t.scale},this.canvasManager.zoomOut()}undo(){this.canvasManager.getPanZoomManager().setViewState(this.prevState),this.canvasManager.draw()}}class yt extends B{constructor(t,e,s){super(),this.canvasManager=t,this.dx=e,this.dy=s}execute(){const t=this.canvasManager.getPanZoomManager();this.prevState={scrollX:t.scrollX,scrollY:t.scrollY,scale:t.scale},t.scrollX+=this.dx,t.scrollY+=this.dy,t.clampScroll(),this.canvasManager.draw()}undo(){this.canvasManager.getPanZoomManager().setViewState(this.prevState),this.canvasManager.draw()}}function ai(i,t){return[{name:"undo",handler:()=>I.undo(),keys:["ctrl+z","meta+z"]},{name:"redo",handler:()=>I.redo(),keys:["ctrl+y","meta+y","meta+shift+z"]},{name:"copy",handler:()=>I.execute(new ei(i)),keys:["ctrl+c","meta+c"]},{name:"paste",handler:()=>I.execute(new si(i,t)),keys:["ctrl+v","meta+v"]},{name:"cut",handler:()=>I.execute(new ni(i)),keys:["ctrl+x","meta+x"]},{name:"delete",handler:()=>{const e=i.getSelectedElements();I.execute(new ii(i,e))},keys:["delete","backspace"]},{name:"zoomIn",handler:()=>I.execute(new oi(t)),keys:["]","ї"]},{name:"zoomOut",handler:()=>I.execute(new ri(t)),keys:["[","х"]},{name:"panLeft",handler:()=>I.execute(new yt(t,-50,0)),keys:["arrowleft"]},{name:"panRight",handler:()=>I.execute(new yt(t,50,0)),keys:["arrowright"]},{name:"panUp",handler:()=>I.execute(new yt(t,0,-50)),keys:["arrowup"]},{name:"panDown",handler:()=>I.execute(new yt(t,0,50)),keys:["arrowdown"]}]}class li{constructor(t){this.dataProvider=t;const e=document.getElementById("myCanvas");if(!e||!(e instanceof HTMLCanvasElement))throw new Error("Canvas element not found");this.canvas=e,this.scene=new Qs,this.canvasManager=new Js(this.canvas,this.scene),this.diagramRepository=new tn(t),this.authService=new Nn;const s=document.getElementById("app")||document.body;this.authComponent=new On(s,this.authService),this.uiManager=new Kn(this.canvasManager,this.scene),this.uiManager.mountAll(document.body),ai(this.scene,this.canvasManager).forEach(n=>{Se.register(n.name,n.handler),n.keys.forEach(o=>Se.bindShortcut(n.name,o))})}async init(){this.canvasManager.init(),await this.diagramRepository.loadDiagram(this.scene);const t=await this.dataProvider.loadViewState(),e=this.canvasManager.getPanZoomManager();e.setViewState(t),this.canvasManager.draw(),e.viewChanges.subscribe(s=>this.dataProvider.saveViewState(s)),this.scene.changes.subscribe(()=>this.diagramRepository.saveDiagram(this.scene))}}const Ee="canvas-tasks",Ce="canvas-dependencies",ke="canvas-stories",Me="canvas-view",Ie="canvas-goals";class ci{async loadTasks(){const t=localStorage.getItem(Ee);return t?JSON.parse(t):[]}async loadDependencies(){const t=localStorage.getItem(Ce);return t?JSON.parse(t):[]}async loadStories(){const t=localStorage.getItem(ke);return t?JSON.parse(t):[]}async loadGoals(){const t=localStorage.getItem(Ie);return t?JSON.parse(t):[]}async saveTasks(t){localStorage.setItem(Ee,JSON.stringify(t))}async saveDependencies(t){localStorage.setItem(Ce,JSON.stringify(t))}async saveStories(t){localStorage.setItem(ke,JSON.stringify(t))}async saveGoals(t){localStorage.setItem(Ie,JSON.stringify(t))}async loadViewState(){const t=localStorage.getItem(Me);return t?JSON.parse(t):{scrollX:0,scrollY:0,scale:1.4}}async saveViewState(t){localStorage.setItem(Me,JSON.stringify(t))}}document.addEventListener("DOMContentLoaded",()=>{const i=new ci;new li(i).init()});
