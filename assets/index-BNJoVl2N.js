(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function e(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(i){if(i.ep)return;i.ep=!0;const o=e(i);fetch(i.href,o)}})();var xt=function(n,t){return xt=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,s){e.__proto__=s}||function(e,s){for(var i in s)Object.prototype.hasOwnProperty.call(s,i)&&(e[i]=s[i])},xt(n,t)};function ut(n,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");xt(n,t);function e(){this.constructor=n}n.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}function St(n){var t=typeof Symbol=="function"&&Symbol.iterator,e=t&&n[t],s=0;if(e)return e.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&s>=n.length&&(n=void 0),{value:n&&n[s++],done:!n}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function kt(n,t){var e=typeof Symbol=="function"&&n[Symbol.iterator];if(!e)return n;var s=e.call(n),i,o=[],r;try{for(;(t===void 0||t-- >0)&&!(i=s.next()).done;)o.push(i.value)}catch(a){r={error:a}}finally{try{i&&!i.done&&(e=s.return)&&e.call(s)}finally{if(r)throw r.error}}return o}function Ct(n,t,e){if(e||arguments.length===2)for(var s=0,i=t.length,o;s<i;s++)(o||!(s in t))&&(o||(o=Array.prototype.slice.call(t,0,s)),o[s]=t[s]);return n.concat(o||Array.prototype.slice.call(t))}function N(n){return typeof n=="function"}function re(n){var t=function(s){Error.call(s),s.stack=new Error().stack},e=n(t);return e.prototype=Object.create(Error.prototype),e.prototype.constructor=e,e}var bt=re(function(n){return function(e){n(this),this.message=e?e.length+` errors occurred during unsubscription:
`+e.map(function(s,i){return i+1+") "+s.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=e}});function Et(n,t){if(n){var e=n.indexOf(t);0<=e&&n.splice(e,1)}}var pt=function(){function n(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._finalizers=null}return n.prototype.unsubscribe=function(){var t,e,s,i,o;if(!this.closed){this.closed=!0;var r=this._parentage;if(r)if(this._parentage=null,Array.isArray(r))try{for(var a=St(r),l=a.next();!l.done;l=a.next()){var h=l.value;h.remove(this)}}catch(w){t={error:w}}finally{try{l&&!l.done&&(e=a.return)&&e.call(a)}finally{if(t)throw t.error}}else r.remove(this);var c=this.initialTeardown;if(N(c))try{c()}catch(w){o=w instanceof bt?w.errors:[w]}var d=this._finalizers;if(d){this._finalizers=null;try{for(var p=St(d),u=p.next();!u.done;u=p.next()){var y=u.value;try{Ut(y)}catch(w){o=o??[],w instanceof bt?o=Ct(Ct([],kt(o)),kt(w.errors)):o.push(w)}}}catch(w){s={error:w}}finally{try{u&&!u.done&&(i=p.return)&&i.call(p)}finally{if(s)throw s.error}}}if(o)throw new bt(o)}},n.prototype.add=function(t){var e;if(t&&t!==this)if(this.closed)Ut(t);else{if(t instanceof n){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=(e=this._finalizers)!==null&&e!==void 0?e:[]).push(t)}},n.prototype._hasParent=function(t){var e=this._parentage;return e===t||Array.isArray(e)&&e.includes(t)},n.prototype._addParent=function(t){var e=this._parentage;this._parentage=Array.isArray(e)?(e.push(t),e):e?[e,t]:t},n.prototype._removeParent=function(t){var e=this._parentage;e===t?this._parentage=null:Array.isArray(e)&&Et(e,t)},n.prototype.remove=function(t){var e=this._finalizers;e&&Et(e,t),t instanceof n&&t._removeParent(this)},n.EMPTY=function(){var t=new n;return t.closed=!0,t}(),n}(),ae=pt.EMPTY;function le(n){return n instanceof pt||n&&"closed"in n&&N(n.remove)&&N(n.add)&&N(n.unsubscribe)}function Ut(n){N(n)?n():n.unsubscribe()}var Se={Promise:void 0},ke={setTimeout:function(n,t){for(var e=[],s=2;s<arguments.length;s++)e[s-2]=arguments[s];return setTimeout.apply(void 0,Ct([n,t],kt(e)))},clearTimeout:function(n){return clearTimeout(n)},delegate:void 0};function Ce(n){ke.setTimeout(function(){throw n})}function jt(){}function ht(n){n()}var ce=function(n){ut(t,n);function t(e){var s=n.call(this)||this;return s.isStopped=!1,e?(s.destination=e,le(e)&&e.add(s)):s.destination=Pe,s}return t.create=function(e,s,i){return new Mt(e,s,i)},t.prototype.next=function(e){this.isStopped||this._next(e)},t.prototype.error=function(e){this.isStopped||(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,n.prototype.unsubscribe.call(this),this.destination=null)},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){try{this.destination.error(e)}finally{this.unsubscribe()}},t.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},t}(pt),Ee=function(){function n(t){this.partialObserver=t}return n.prototype.next=function(t){var e=this.partialObserver;if(e.next)try{e.next(t)}catch(s){at(s)}},n.prototype.error=function(t){var e=this.partialObserver;if(e.error)try{e.error(t)}catch(s){at(s)}else at(t)},n.prototype.complete=function(){var t=this.partialObserver;if(t.complete)try{t.complete()}catch(e){at(e)}},n}(),Mt=function(n){ut(t,n);function t(e,s,i){var o=n.call(this)||this,r;return N(e)||!e?r={next:e??void 0,error:s??void 0,complete:i??void 0}:r=e,o.destination=new Ee(r),o}return t}(ce);function at(n){Ce(n)}function Me(n){throw n}var Pe={closed:!0,next:jt,error:Me,complete:jt},Ie=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function ze(n){return n}function Te(n){return n.length===0?ze:n.length===1?n[0]:function(e){return n.reduce(function(s,i){return i(s)},e)}}var Gt=function(){function n(t){t&&(this._subscribe=t)}return n.prototype.lift=function(t){var e=new n;return e.source=this,e.operator=t,e},n.prototype.subscribe=function(t,e,s){var i=this,o=De(t)?t:new Mt(t,e,s);return ht(function(){var r=i,a=r.operator,l=r.source;o.add(a?a.call(o,l):l?i._subscribe(o):i._trySubscribe(o))}),o},n.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(e){t.error(e)}},n.prototype.forEach=function(t,e){var s=this;return e=Ft(e),new e(function(i,o){var r=new Mt({next:function(a){try{t(a)}catch(l){o(l),r.unsubscribe()}},error:o,complete:i});s.subscribe(r)})},n.prototype._subscribe=function(t){var e;return(e=this.source)===null||e===void 0?void 0:e.subscribe(t)},n.prototype[Ie]=function(){return this},n.prototype.pipe=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return Te(t)(this)},n.prototype.toPromise=function(t){var e=this;return t=Ft(t),new t(function(s,i){var o;e.subscribe(function(r){return o=r},function(r){return i(r)},function(){return s(o)})})},n.create=function(t){return new n(t)},n}();function Ft(n){var t;return(t=n??Se.Promise)!==null&&t!==void 0?t:Promise}function Le(n){return n&&N(n.next)&&N(n.error)&&N(n.complete)}function De(n){return n&&n instanceof ce||Le(n)&&le(n)}var Re=re(function(n){return function(){n(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),Dt=function(n){ut(t,n);function t(){var e=n.call(this)||this;return e.closed=!1,e.currentObservers=null,e.observers=[],e.isStopped=!1,e.hasError=!1,e.thrownError=null,e}return t.prototype.lift=function(e){var s=new qt(this,this);return s.operator=e,s},t.prototype._throwIfClosed=function(){if(this.closed)throw new Re},t.prototype.next=function(e){var s=this;ht(function(){var i,o;if(s._throwIfClosed(),!s.isStopped){s.currentObservers||(s.currentObservers=Array.from(s.observers));try{for(var r=St(s.currentObservers),a=r.next();!a.done;a=r.next()){var l=a.value;l.next(e)}}catch(h){i={error:h}}finally{try{a&&!a.done&&(o=r.return)&&o.call(r)}finally{if(i)throw i.error}}}})},t.prototype.error=function(e){var s=this;ht(function(){if(s._throwIfClosed(),!s.isStopped){s.hasError=s.isStopped=!0,s.thrownError=e;for(var i=s.observers;i.length;)i.shift().error(e)}})},t.prototype.complete=function(){var e=this;ht(function(){if(e._throwIfClosed(),!e.isStopped){e.isStopped=!0;for(var s=e.observers;s.length;)s.shift().complete()}})},t.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(t.prototype,"observed",{get:function(){var e;return((e=this.observers)===null||e===void 0?void 0:e.length)>0},enumerable:!1,configurable:!0}),t.prototype._trySubscribe=function(e){return this._throwIfClosed(),n.prototype._trySubscribe.call(this,e)},t.prototype._subscribe=function(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)},t.prototype._innerSubscribe=function(e){var s=this,i=this,o=i.hasError,r=i.isStopped,a=i.observers;return o||r?ae:(this.currentObservers=null,a.push(e),new pt(function(){s.currentObservers=null,Et(a,e)}))},t.prototype._checkFinalizedStatuses=function(e){var s=this,i=s.hasError,o=s.thrownError,r=s.isStopped;i?e.error(o):r&&e.complete()},t.prototype.asObservable=function(){var e=new Gt;return e.source=this,e},t.create=function(e,s){return new qt(e,s)},t}(Gt),qt=function(n){ut(t,n);function t(e,s){var i=n.call(this)||this;return i.destination=e,i.source=s,i}return t.prototype.next=function(e){var s,i;(i=(s=this.destination)===null||s===void 0?void 0:s.next)===null||i===void 0||i.call(s,e)},t.prototype.error=function(e){var s,i;(i=(s=this.destination)===null||s===void 0?void 0:s.error)===null||i===void 0||i.call(s,e)},t.prototype.complete=function(){var e,s;(s=(e=this.destination)===null||e===void 0?void 0:e.complete)===null||s===void 0||s.call(e)},t.prototype._subscribe=function(e){var s,i;return(i=(s=this.source)===null||s===void 0?void 0:s.subscribe(e))!==null&&i!==void 0?i:ae},t}(Dt);class Oe{constructor(t){this.canvas=t,this.scrollX=0,this.scrollY=0,this.scale=1.4,this.virtualWidth=3e3,this.virtualHeight=2e3,this.scrollbarWidth=6,this.viewChanges=new Dt,this.zoomListeners=[]}clampScroll(){const t=this.canvas.width-this.scrollbarWidth,e=this.canvas.height-this.scrollbarWidth,s=Math.max(0,this.virtualWidth*this.scale-t),i=Math.max(0,this.virtualHeight*this.scale-e);this.scrollX=Math.min(Math.max(0,this.scrollX),s),this.scrollY=Math.min(Math.max(0,this.scrollY),i)}zoomIn(t){this.scale=Math.min(this.scale*1.15,3),this.clampScroll(),this.emitZoomChange()}zoomOut(t){const e=Math.max((t.width-this.scrollbarWidth)/this.virtualWidth,(t.height-this.scrollbarWidth)/this.virtualHeight);this.scale=Math.max(this.scale/1.15,e),this.clampScroll(),this.emitZoomChange()}center(t){this.scale=1,this.scrollX=(this.virtualWidth*this.scale-t.width)/2,this.scrollY=(this.virtualHeight*this.scale-t.height)/2,this.clampScroll(),this.emitZoomChange()}handleWheelEvent(t,e,s,i){if(t.ctrlKey){const o=Math.pow(1.001,-t.deltaY),r=this.scale;let a=r*o;const l=e.width-this.scrollbarWidth,h=e.height-this.scrollbarWidth,c=Math.max(l/this.virtualWidth,h/this.virtualHeight);a=Math.min(Math.max(a,c),3);const p=(s+this.scrollX)/r,u=(i+this.scrollY)/r;this.scale=a,this.scrollX=p*a-s,this.scrollY=u*a-i}else this.scrollX+=t.deltaX,this.scrollY+=t.deltaY;this.clampScroll(),this.emitZoomChange()}onZoomChange(t){this.zoomListeners.push(t)}emitZoomChange(){this.zoomListeners.forEach(t=>t()),this.viewChanges.next({scrollX:this.scrollX,scrollY:this.scrollY,scale:this.scale})}setViewState(t){this.scrollX=t.scrollX,this.scrollY=t.scrollY,this.scale=t.scale,this.clampScroll(),this.emitZoomChange()}}class Ae{constructor(t,e,s){this.canvas=t,this.ctx=e,this.panZoom=s}drawRoundedRect(t,e,s,i,o){const r=this.ctx;r.beginPath(),r.moveTo(t+o,e),r.lineTo(t+s-o,e),r.quadraticCurveTo(t+s,e,t+s,e+o),r.lineTo(t+s,e+i-o),r.quadraticCurveTo(t+s,e+i,t+s-o,e+i),r.lineTo(t+o,e+i),r.quadraticCurveTo(t,e+i,t,e+i-o),r.lineTo(t,e+o),r.quadraticCurveTo(t,e,t+o,e),r.closePath(),r.fill(),r.stroke()}drawScrollbars(){const{canvas:t,panZoom:e,ctx:s}=this,i=t.width-e.scrollbarWidth,o=t.height-e.scrollbarWidth,r=e.virtualWidth*e.scale,a=e.virtualHeight*e.scale;if(r>i){const l=i/r,h=i*l,c=e.scrollX/r*i,d=t.height-e.scrollbarWidth;s.fillStyle="#5D5D5D80",s.strokeStyle="#5D5D5D80",s.lineWidth=1,this.drawRoundedRect(c,d,h,e.scrollbarWidth,e.scrollbarWidth/2)}if(a>o){const l=o/a,h=o*l,c=e.scrollY/a*o,d=t.width-e.scrollbarWidth;s.fillStyle="#5D5D5D80",s.strokeStyle="#5D5D5D80",s.lineWidth=1,this.drawRoundedRect(d,c,e.scrollbarWidth,h,e.scrollbarWidth/2)}}hitTestScrollbars(t,e){const{canvas:s,panZoom:i}=this,o=s.width-i.scrollbarWidth,r=s.height-i.scrollbarWidth,a=i.virtualWidth*i.scale,l=i.virtualHeight*i.scale;if(a>o&&e>r){const h=o/a,c=o*h,d=i.scrollX/a*o;if(t>=d&&t<=d+c)return"horizontal"}if(l>r&&t>o){const h=r/l,c=r*h,d=i.scrollY/l*r;if(e>=d&&e<=d+c)return"vertical"}return null}}class We{constructor(t,e){this.ctx=t,this.panZoom=e}drawContent(){const t=this.ctx;t.strokeStyle="#ddd",t.lineWidth=1;const e=this.panZoom.virtualWidth,s=this.panZoom.virtualHeight;for(let i=0;i<e;i+=50)t.beginPath(),t.moveTo(i,0),t.lineTo(i,s),t.stroke();for(let i=0;i<s;i+=50)t.beginPath(),t.moveTo(0,i),t.lineTo(e,i),t.stroke()}}const P=[];for(let n=0;n<256;++n)P.push((n+256).toString(16).slice(1));function Ye(n,t=0){return(P[n[t+0]]+P[n[t+1]]+P[n[t+2]]+P[n[t+3]]+"-"+P[n[t+4]]+P[n[t+5]]+"-"+P[n[t+6]]+P[n[t+7]]+"-"+P[n[t+8]]+P[n[t+9]]+"-"+P[n[t+10]]+P[n[t+11]]+P[n[t+12]]+P[n[t+13]]+P[n[t+14]]+P[n[t+15]]).toLowerCase()}let yt;const He=new Uint8Array(16);function Ne(){if(!yt){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");yt=crypto.getRandomValues.bind(crypto)}return yt(He)}const Xe=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),$t={randomUUID:Xe};function he(n,t,e){var i;if($t.randomUUID&&!n)return $t.randomUUID();n=n||{};const s=n.random??((i=n.rng)==null?void 0:i.call(n))??Ne();if(s.length<16)throw new Error("Random bytes length must be >= 16");return s[6]=s[6]&15|64,s[8]=s[8]&63|128,Ye(s)}class Ze{constructor(t=0,e=0){this.selected=!1,this.isHovered=!1,this.zIndex=0,this.id=he(),this.x=t,this.y=e}onDoubleClick(){}onRightClick(){}onDragStart(){}onDrag(t,e){}onDragEnd(){}}const $="#1890ff",_e="rgba(24,144,255,0.1)",Be="rgba(24,144,255,0.5)",Ve="rgba(24,144,255,0.03)",Ue="#1890ff";class Rt extends Ze{constructor({id:t,x:e=0,y:s=0,width:i,height:o,fillColor:r="#e6f7ff",lineWidth:a=2,title:l="",description:h="",dueDate:c,tags:d}){super(e,s),t&&(this.id=t),this.width=i,this.height=o,this.fillColor=r,this.lineWidth=a,this.title=l,this.description=h,this.dueDate=c,this.tags=d}getNearestPoint(t,e){const s=this.getConnectionPoints();let i=s[0],o=1/0;for(const r of s){const a=(r.x-t)**2+(r.y-e)**2;a<o&&(o=a,i=r)}return{x:i.x,y:i.y}}drawAnchors(t,e){if(this.selected||this.isHovered){const s=this.getConnectionPoints();for(const i of s)t.save(),t.setLineDash([]),t.beginPath(),t.arc(i.x,i.y,4/e.scale,0,2*Math.PI),t.fillStyle=i.isHovered?$:"#ffffff",t.strokeStyle="#000000",t.lineWidth=1/e.scale,t.fill(),t.stroke(),t.restore()}}drawConnectionLine(t,e,s){const i=this.getNearestPoint(s.x,s.y),o=s.getNearestPoint(this.x,this.y);t.save(),t.beginPath(),t.moveTo(i.x,i.y),t.lineTo(o.x,o.y),t.strokeStyle="#888",t.lineWidth=1/e.scale,t.stroke(),t.restore()}}function Z(n){return n instanceof Rt}var F=(n=>(n.Straight="straight",n.SShaped="s-shaped",n))(F||{});class de{constructor(t,e,s=he(),i){this.selected=!1,this.lineType=F.SShaped,this.zIndex=1,this.tangentAngle=0,this.fromId=t,this.toId=e,this.id=s,i&&(this.lineType=i)}getClosestConnectionPoints(t,e){const s=t.getConnectionPoints(),i=e.getConnectionPoints();let o=1/0,r=s[0],a=i[0];for(const l of s)for(const h of i){const c=Math.sqrt((l.x-h.x)**2+(l.y-h.y)**2);c<o&&(o=c,r=l,a=h)}return{start:r,end:a}}setStrokeProperties(t,e){t.setLineDash([]),t.strokeStyle=this.selected?"#008dff":"#000",t.lineWidth=2/e.scale}drawLine(t,e,s,i){const{start:o,end:r}=this.getClosestConnectionPoints(e,s);if(t.beginPath(),t.moveTo(o.x,o.y),this.lineType===F.Straight)t.lineTo(r.x,r.y),this.tangentAngle=Math.atan2(r.y-o.y,r.x-o.x);else if(this.lineType===F.SShaped){const a=r.x-o.x,l=r.y-o.y,c=Math.sqrt(a*a+l*l)/1.4,d=this.getControlPoint(o,c),p=this.getControlPoint(r,c);t.bezierCurveTo(d.x,d.y,p.x,p.y,r.x,r.y),this.tangentAngle=Math.atan2(r.y-p.y,r.x-p.x)}this.setStrokeProperties(t,i),t.stroke()}getControlPoint(t,e){switch(t.direction){case"left":return{x:t.x-e,y:t.y};case"right":return{x:t.x+e,y:t.y};case"top":return{x:t.x,y:t.y-e};case"bottom":return{x:t.x,y:t.y+e};default:return{x:t.x,y:t.y}}}drawArrowHead(t,e,s,i){const{end:o}=this.getClosestConnectionPoints(e,s),r=this.tangentAngle,a=15/i.scale;t.beginPath(),t.moveTo(o.x,o.y),t.lineTo(o.x-a*Math.cos(r-Math.PI/6),o.y-a*Math.sin(r-Math.PI/6)),t.lineTo(o.x-a*Math.cos(r+Math.PI/6),o.y-a*Math.sin(r+Math.PI/6)),t.closePath(),t.fillStyle=this.selected?"#008dff":"#000",t.fill()}draw(t,e,s=[]){const i=s.find(r=>r.id===this.fromId),o=s.find(r=>r.id===this.toId);i&&o&&(this.drawLine(t,i,o,e),this.drawArrowHead(t,i,o,e))}distanceToLineSegment(t,e,s,i,o,r){const a=o-s,l=r-i,h=a*a+l*l;if(h===0)return Math.sqrt((t-s)**2+(e-i)**2);const c=Math.max(0,Math.min(1,((t-s)*a+(e-i)*l)/h)),d=s+c*a,p=i+c*l;return Math.sqrt((t-d)**2+(e-p)**2)}isNearPoint(t,e,s,i=5){const o=s.find(h=>h.id===this.fromId),r=s.find(h=>h.id===this.toId);if(!o||!r)return!1;const{start:a,end:l}=this.getClosestConnectionPoints(o,r);if(this.lineType===F.Straight)return this.distanceToLineSegment(t,e,a.x,a.y,l.x,l.y)<=i;if(this.lineType===F.SShaped){const h=l.x-a.x,c=l.y-a.y,p=Math.sqrt(h*h+c*c)/1.4,u=this.getControlPoint(a,p),y=this.getControlPoint(l,p),w=20,D=[];for(let T=0;T<=w;T++){const x=T/w,S=1-x,O=S*S*S*a.x+3*S*S*x*u.x+3*S*x*x*y.x+x*x*x*l.x,A=S*S*S*a.y+3*S*S*x*u.y+3*S*x*x*y.y+x*x*x*l.y;D.push({x:O,y:A})}let R=1/0;for(let T=0;T<D.length-1;T++){const x=D[T],S=D[T+1],O=this.distanceToLineSegment(t,e,x.x,x.y,S.x,S.y);O<R&&(R=O)}return R<=i}return!1}setLineType(t){this.lineType=t}}const C=class C extends Rt{constructor({id:t=`task-${Date.now()}`,x:e=0,y:s=0,title:i="New Task",description:o="",status:r="pending",selected:a=!1,priority:l="medium",dueDate:h=new Date}){super({id:t,x:e,y:s,width:C.width,height:C.height,fillColor:"#ffffff",lineWidth:1,title:i,description:o}),this.status="pending",this.zIndex=2,this.title=i,this.status=r,this.selected=a,this.priority=l,this.dueDate=h}draw(t,e){t.setLineDash([]);const s=this.x,i=this.y,o=C.width,r=C.height;t.fillStyle="#ffffff",t.strokeStyle=this.selected?$:"#d9d9d9",t.lineWidth=this.selected?2:1,t.beginPath(),t.roundRect(s,i,o,r,8),t.fill(),t.stroke(),t.fillStyle="#000000",t.font="bold 14px Arial",t.fillText(this.title,s+10,i+20),t.fillStyle=this.getStatusColor(),t.beginPath(),t.arc(s+o-12,i+12,6,0,2*Math.PI),t.fill(),this.drawButton(t,e,s+o-32,i+10,"✏️"),this.drawButton(t,e,s+o-16,i+10,"🗑️");const a=this.getConnectionPoints(),l=this.hoveredPort;if(this.selected||this.isHovered||l)for(const h of a){const c=l?h.x===l.x&&h.y===l.y:!1;if(!(this.selected||this.isHovered)&&!c)continue;const d=(c?8:4)/e.scale;t.save(),t.beginPath(),t.arc(h.x,h.y,d,0,2*Math.PI),t.fillStyle=c?$:"#ffffff",t.fill(),t.strokeStyle="#000000",t.lineWidth=1/e.scale,t.stroke(),t.restore()}}contains(t,e){return t>=this.x&&t<=this.x+C.width&&e>=this.y&&e<=this.y+C.height}isEditButtonClicked(t,e){const s=this.x+C.width-32,i=this.y+10,o=16;return t>=s&&t<=s+o&&e>=i&&e<=i+o}isDeleteButtonClicked(t,e){const s=this.x+C.width-16,i=this.y+10,o=16;return t>=s&&t<=s+o&&e>=i&&e<=i+o}drawButton(t,e,s,i,o){t.fillStyle="transparent",t.font="14px Arial",t.fillText(o,s,i+12)}getStatusColor(){switch(this.status){case"pending":return"#faad14";case"in-progress":return"#1890ff";case"done":return"#52c41a";default:return"#d9d9d9"}}onRightClick(){}onDragStart(){}onDrag(t,e){this.x=t,this.y=e}onDragEnd(){}getBoundaryPoint(t){const e=this.x+C.width/2,s=this.y+C.height/2;return{x:e+Math.cos(t)*(C.width/2),y:s+Math.sin(t)*(C.height/2)}}getConnectionPoints(){const t=C.width,e=C.height;return[{x:this.x+t/2,y:this.y,angle:-Math.PI/2,isHovered:!1,direction:"top"},{x:this.x+t,y:this.y+e/2,angle:0,isHovered:!1,direction:"right"},{x:this.x+t/2,y:this.y+e,angle:Math.PI/2,isHovered:!1,direction:"bottom"},{x:this.x,y:this.y+e/2,angle:Math.PI,isHovered:!1,direction:"left"}]}clone(){return new C({id:this.id,x:this.x,y:this.y,title:this.title,status:this.status,priority:this.priority,dueDate:this.dueDate})}onDoubleClick(){const t=window.prompt("Edit Task Title:",this.title);t!==null&&(this.title=t)}};C.width=180,C.height=90;let z=C;const q=class q extends Rt{constructor({id:t=`story-${Date.now()}`,x:e=0,y:s=0,width:i=320,height:o=240,title:r="New Story",description:a="",status:l="pending",borderColor:h=Ue,tasks:c=[]}){super({id:t,x:e,y:s,width:i,height:o,fillColor:Ve,lineWidth:2,title:r,description:a}),this.status="pending",this.tasks=[],this.hoveredResizeHandle=null,this.zIndex=1,this.status=l,this.borderColor=h,this.tasks=c}draw(t,e){t.fillStyle=this.fillColor,t.beginPath(),t.roundRect(this.x,this.y,this.width,this.height,8/e.scale),t.fill();const s=6/e.scale,i=2/e.scale;if(this.selected?(t.setLineDash([]),t.strokeStyle=$):(t.setLineDash([s,i]),t.strokeStyle=this.borderColor),t.lineWidth=this.lineWidth/e.scale,t.stroke(),t.fillStyle="#000000",t.font=`${14/e.scale}px Arial`,t.fillText(this.title,this.x+8/e.scale,this.y+16/e.scale),super.drawAnchors(t,e),this.selected){const o=q.HANDLE_SIZE/e.scale;t.fillStyle=$,this.getResizeHandles(e).forEach(r=>{t.beginPath(),t.rect(r.x-o/2,r.y-o/2,o,o),t.fill()})}}drawButton(t,e,s,i,o,r){const a=22/e.scale;r!=="transparent"&&(t.fillStyle=r,t.beginPath(),t.roundRect(s,i,a,a,4/e.scale),t.fill()),t.fillStyle="#666666",t.font=`${14/e.scale}px Arial`,t.fillText(o,s+3/e.scale,i+16/e.scale)}contains(t,e){return t>=this.x&&t<=this.x+this.width&&e>=this.y&&e<=this.y+this.height}isEditButtonClicked(t,e){const i=this.x+this.width-80,o=this.y+6;return t>=i&&t<=i+22&&e>=o&&e<=o+22}isDeleteButtonClicked(t,e){const i=this.x+this.width-50,o=this.y+6;return t>=i&&t<=i+22&&e>=o&&e<=o+22}isAddButtonClicked(t,e){const i=this.x+this.width-20,o=this.y+6;return t>=i&&t<=i+22&&e>=o&&e<=o+22}addTask(t){this.tasks.find(e=>e.id===t.id)||this.tasks.push(t)}removeTask(t){this.tasks=this.tasks.filter(e=>e.id!==t)}getBoundaryPoint(t){return{x:this.x+this.width/2,y:this.y+this.height/2}}getConnectionPoints(){const t=[],e=this.width,s=this.height;return t.push({x:this.x+e/2,y:this.y,angle:-Math.PI/2,isHovered:!1,direction:"top"}),t.push({x:this.x+e,y:this.y+s/2,angle:0,isHovered:!1,direction:"right"}),t.push({x:this.x+e/2,y:this.y+s,angle:Math.PI/2,isHovered:!1,direction:"bottom"}),t.push({x:this.x,y:this.y+s/2,angle:Math.PI,isHovered:!1,direction:"left"}),t}onDrag(t,e){const s=t-this.x,i=e-this.y;this.x=t,this.y=e,this.tasks.forEach(o=>{o.x+=s,o.y+=i})}getResizeHandles(t){return[{x:this.x+1,y:this.y+1,direction:"nw"},{x:this.x+this.width-1,y:this.y+1,direction:"ne"},{x:this.x+this.width-1,y:this.y+this.height-1,direction:"se"},{x:this.x+1,y:this.y+this.height-1,direction:"sw"}]}getResizeHandleDirectionAt(t,e,s){const i=64/s.scale;for(const o of this.getResizeHandles(s))if(t>=o.x-i/2&&t<=o.x+i/2&&e>=o.y-i/2&&e<=o.y+i/2)return o.direction;return null}onDoubleClick(){const t=window.prompt("Edit Story Title:",this.title);t!==null&&(this.title=t)}clone(){return this}};q.width=320,q.height=240,q.HANDLE_SIZE=8;let M=q;class je{constructor(t,e,s){this.canvas=t,this.scene=e,this.panZoom=s,this.draggingElement=null,this.draggingShape=null,this.dragOffsetX=0,this.dragOffsetY=0,this.initialPositions=new Map,this.creatingConnection=!1,this.connectionStartShape=null,this.connectionStartPoint=null,this.tempConnectionLine=null,this.hoveredConnectionPoint=null,this.resizingElement=null,this.resizeDirection=null,this.resizeStartX=0,this.resizeStartY=0,this.initialX=0,this.initialY=0,this.initialWidth=0,this.initialHeight=0}getTempConnectionLine(){return this.tempConnectionLine}cancelConnectionCreation(){this.creatingConnection=!1,this.connectionStartShape=null,this.connectionStartPoint=null,this.tempConnectionLine=null,this.hoveredConnectionPoint=null,this.scene.changes.next()}findConnectionPointAt(t,e,s){for(let i=s.length-1;i>=0;i--){const o=s[i],r=o.getConnectionPoints();for(const a of r)if(Math.sqrt((t-a.x)**2+(e-a.y)**2)<8/this.panZoom.scale)return{shape:o,point:a}}return null}handleMouseDown(t,e,s){if(t.button!==0)return!1;const i=this.scene.getShapes(),o=this.scene.getElements().filter(Z),r=[...i,...o],a=this.scene.getConnections();let l=null;const h=this.findConnectionPointAt(e,s,r);if(h)return this.creatingConnection=!0,this.connectionStartShape=h.shape,this.connectionStartPoint=h.point,this.tempConnectionLine={startX:h.point.x,startY:h.point.y,endX:e,endY:s},!0;for(let p=i.length-1;p>=0;p--){const u=i[p];if(u.contains(e,s)){l=u;break}}if(l){if(t.shiftKey){const y=this.scene.getSelectedElements();y.indexOf(l)===-1&&this.scene.setSelected([...y,l])}else this.scene.setSelected([l]);const p=this.scene.getSelectedShapes();this.initialPositions.clear(),p.forEach(y=>{this.initialPositions.set(y.id,{x:y.x,y:y.y})}),this.draggingShape=l;const u={x:e-l.x,y:s-l.y};return this.dragOffsetX=u.x,this.dragOffsetY=u.y,l.onDragStart&&l.onDragStart(),!0}let c=null;const d=o.filter(p=>p instanceof z);for(let p=d.length-1;p>=0;p--)if(d[p].contains(e,s)){c=d[p];break}if(!c){const p=o.filter(u=>u instanceof M);for(let u=p.length-1;u>=0;u--)if(p[u].contains(e,s)){c=p[u];break}}if(!c)for(let p=o.length-1;p>=0;p--){const u=o[p];if(!(u instanceof z)&&!(u instanceof M)&&u.contains(e,s)){c=u;break}}if(c){if(c instanceof M){const u=c.getResizeHandleDirectionAt(e,s,this.panZoom);if(u)return this.resizingElement=c,this.resizeDirection=u,this.resizeStartX=e,this.resizeStartY=s,this.initialX=c.x,this.initialY=c.y,this.initialWidth=c.width,this.initialHeight=c.height,this.scene.setSelected([c]),!0}if(t.shiftKey){const u=this.scene.getSelectedElements();u.indexOf(c)===-1&&this.scene.setSelected([...u,c])}else this.scene.setSelected([c]);const p=this.scene.getSelectedElements();return this.initialPositions.clear(),p.forEach(u=>{this.initialPositions.set(u.id,{x:u.x,y:u.y})}),c instanceof M&&c.tasks.forEach(u=>{this.initialPositions.set(u.id,{x:u.x,y:u.y})}),this.draggingElement=c,this.dragOffsetX=e-c.x,this.dragOffsetY=s-c.y,c.onDragStart&&c.onDragStart(),!0}for(const p of a)if(p.isNearPoint(e,s,r)){if(t.shiftKey){const u=this.scene.getSelectedElements();this.scene.setSelected([...u,p])}else this.scene.setSelected([p]);return!0}return this.scene.setSelected([]),!1}handleMouseMove(t,e){const s=this.scene.getShapes(),i=this.scene.getElements().filter(Z),o=[...s,...i];let r=null;o.forEach(c=>c.isHovered=!1);for(let c=o.length-1;c>=0;c--){const d=o[c];if(d.contains(t,e)){r=d;break}}r&&(r.isHovered=!0),o.forEach(c=>delete c.hoveredPort);const a=this.findConnectionPointAt(t,e,o);a?(this.hoveredConnectionPoint=a.point,a.shape.hoveredPort=a.point):this.hoveredConnectionPoint=null,this.creatingConnection&&this.tempConnectionLine&&(this.hoveredConnectionPoint?(this.tempConnectionLine.endX=this.hoveredConnectionPoint.x,this.tempConnectionLine.endY=this.hoveredConnectionPoint.y):(this.tempConnectionLine.endX=t,this.tempConnectionLine.endY=e),this.scene.changes.next());const l=i.filter(c=>c instanceof M);let h=!1;for(const c of l)if(c.selected){const d=c.getResizeHandleDirectionAt(t,e,this.panZoom);if(c.hoveredResizeHandle=d,d){h=!0;break}}if(!this.resizingElement)if(h){const c=l.find(d=>d.hoveredResizeHandle);c&&(this.canvas.style.cursor=`${c.hoveredResizeHandle}-resize`)}else this.canvas.style.cursor="default";if(this.draggingElement){this.draggingElement instanceof z&&this.scene.getElements().filter(Z).filter(p=>p instanceof M).forEach(p=>p.isHovered=p.contains(t,e));const c=this.initialPositions.get(this.draggingElement.id);if(c){const d=t-(c.x+this.dragOffsetX),p=e-(c.y+this.dragOffsetY);this.draggingElement instanceof M?this.draggingElement.onDrag(c.x+d,c.y+p):this.scene.getSelectedElements().forEach(u=>{this.initialPositions.has(u.id)&&(u.x=this.initialPositions.get(u.id).x+d,u.y=this.initialPositions.get(u.id).y+p,u.onDrag&&u.onDrag(u.x,u.y))}),this.scene.changes.next()}return}if(this.draggingShape){const c=this.initialPositions.get(this.draggingShape.id);if(!c)return;const d=t-(c.x+this.dragOffsetX),p=e-(c.y+this.dragOffsetY);this.scene.getSelectedShapes().forEach(y=>{const w=this.initialPositions.get(y.id);w&&(y.x=w.x+d,y.y=w.y+p,y.onDrag&&y.onDrag(y.x,y.y))}),this.scene.changes.next()}if(this.resizingElement&&this.resizeDirection){const c=t-this.resizeStartX,d=e-this.resizeStartY;let p=this.initialX,u=this.initialY,y=this.initialWidth,w=this.initialHeight;switch(this.resizeDirection){case"se":y+=c,w+=d;break;case"ne":y+=c,w-=d,u+=d;break;case"sw":y-=c,w+=d,p+=c;break;case"nw":y-=c,w-=d,p+=c,u+=d;break}y=Math.max(y,1),w=Math.max(w,1),this.resizingElement.x=p,this.resizingElement.y=u,this.resizingElement.width=y,this.resizingElement.height=w,this.scene.changes.next();return}}handleMouseUp(){var t,e;if(this.creatingConnection){const s=this.scene.getShapes(),i=this.scene.getElements().filter(Z),o=[...s,...i],r=((t=this.tempConnectionLine)==null?void 0:t.endX)||0,a=((e=this.tempConnectionLine)==null?void 0:e.endY)||0;let l=this.findConnectionPointAt(r,a,o),h=(l==null?void 0:l.shape)||null;if(!h)for(let c=o.length-1;c>=0;c--){const d=o[c];if(d!==this.connectionStartShape&&d.contains(r,a)){h=d;break}}if(h&&this.connectionStartShape){const c=this.connectionStartShape,d=h;if(!(c instanceof M&&d instanceof z&&c.tasks.some(u=>u.id===d.id)||c instanceof z&&d instanceof M&&d.tasks.some(u=>u.id===c.id))){const u=new de(c.id,d.id);this.scene.addElement(u)}}this.creatingConnection=!1,this.connectionStartShape=null,this.connectionStartPoint=null,this.tempConnectionLine=null,this.hoveredConnectionPoint=null,this.scene.changes.next()}if(this.draggingElement){if(this.draggingElement instanceof z){const s=this.draggingElement;this.scene.getElements().filter(Z).filter(o=>o instanceof M).forEach(o=>{o.contains(s.x,s.y)?o.addTask(s):o.removeTask(s.id)})}this.draggingElement.onDragEnd&&this.draggingElement.onDragEnd()}if(this.draggingElement=null,this.draggingShape&&this.draggingShape.onDragEnd&&this.draggingShape.onDragEnd(),this.draggingShape=null,this.initialPositions.clear(),this.scene.changes.next(),this.resizingElement){this.resizingElement=null,this.resizeDirection=null,this.canvas.style.cursor="default",this.scene.getElements().filter(Z).filter(s=>s instanceof M).forEach(s=>s.hoveredResizeHandle=null),this.scene.changes.next();return}}handleDoubleClick(t,e){const s=this.scene.getShapes();for(let o=s.length-1;o>=0;o--){const r=s[o];if(r.contains(t,e)&&r.onDoubleClick){r.onDoubleClick();break}}const i=this.scene.getElements().filter(Z);for(let o=i.length-1;o>=0;o--){const r=i[o];if(r.contains(t,e)&&r.onDoubleClick){r.onDoubleClick();break}}}handleRightClick(t,e,s){t.preventDefault();const i=this.scene.getShapes();for(let o=i.length-1;o>=0;o--){const r=i[o];if(r.contains(e,s)&&r.onRightClick){r.onRightClick();break}}}get isCreatingConnection(){return this.creatingConnection}get isDraggingTask(){return this.draggingElement instanceof z}}class Ge{constructor(t,e){this.scene=t,this.canvasManager=e,this.clipboard=[],document.addEventListener("keydown",this.onKeyDown.bind(this))}getCanvasCenter(){const t=this.canvasManager.getCanvas(),e=t.width,s=t.height,i=this.canvasManager.getPanZoomManager(),o=(e/2+i.scrollX)/i.scale,r=(s/2+i.scrollY)/i.scale;return{x:o,y:r}}onKeyDown(t){if(console.log({key:t.key}),t.key==="Escape"){this.canvasManager.getInteractionManager().cancelConnectionCreation();return}if(t.ctrlKey&&t.key==="c"){const e=this.scene.getSelectedShapes();e.length>0&&(this.clipboard=e.map(s=>s.clone()),console.log(`Copied ${this.clipboard.length} shapes to clipboard`)),t.preventDefault()}if(t.ctrlKey&&t.key==="v"){if(this.clipboard.length>0){let e=this.canvasManager.getLastMouseCoords();e||(e=this.getCanvasCenter(),console.log(`Mouse coordinates not available, pasting at canvas center (${e.x}, ${e.y})`)),this.scene.getShapes().forEach(s=>s.selected=!1),this.clipboard.forEach(s=>{const i=s.clone();i.x=e.x+(i.x-s.x),i.y=e.y+(i.y-s.y),i.selected=!0,this.scene.addElement(i)}),console.log(`Pasted ${this.clipboard.length} shapes at (${e.x}, ${e.y})`)}t.preventDefault()}if(t.key==="Backspace"){const e=[...this.scene.getSelectedElements()];this.scene.removeElements(e)}}}class Fe{constructor(t,e){this.draggingScrollbar=null,this.dragStartX=0,this.dragStartY=0,this.dragStartScrollX=0,this.dragStartScrollY=0,this.lastMouseCoords=null,this.canvas=t,this.scene=e;const s=t.getContext("2d");if(!s)throw new Error("Canvas 2D context not available");this.ctx=s,this.panZoom=new Oe(t),this.renderer=new We(this.ctx,this.panZoom),this.scrollbarManager=new Ae(t,this.ctx,this.panZoom),this.interactionManager=new je(t,e,this.panZoom),this.keyboardManager=new Ge(e,this),this.scene.changes.subscribe(()=>this.draw()),this.canvas.addEventListener("wheel",this.onWheel.bind(this)),window.addEventListener("resize",this.onResize.bind(this)),this.canvas.addEventListener("mousedown",this.onMouseDown.bind(this)),this.canvas.addEventListener("mousemove",this.onMouseMove.bind(this)),this.canvas.addEventListener("mouseup",this.onMouseUp.bind(this)),this.canvas.addEventListener("dblclick",this.onDoubleClick.bind(this)),this.canvas.addEventListener("contextmenu",this.onRightClick.bind(this)),this.resizeCanvas()}init(){this.draw()}resizeCanvas(){this.canvas.width=window.innerWidth-2,this.canvas.height=window.innerHeight-2,this.draw()}onResize(){this.resizeCanvas()}draw(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.save(),this.ctx.translate(-this.panZoom.scrollX,-this.panZoom.scrollY),this.ctx.scale(this.panZoom.scale,this.panZoom.scale),this.renderer.drawContent();const t=this.scene.getElements(),e=this.scene.getShapes(),s=t.filter(Z),i=[...e,...s];if(e.forEach(r=>r.draw(this.ctx,this.panZoom)),s.sort((r,a)=>r.zIndex-a.zIndex).forEach(r=>r.draw(this.ctx,this.panZoom)),this.interactionManager.isCreatingConnection){const r=4/this.panZoom.scale;i.forEach(a=>{a.isHovered&&(this.ctx.save(),this.ctx.fillStyle=_e,this.ctx.strokeStyle=Be,this.ctx.lineWidth=2/this.panZoom.scale,"radius"in a?(this.ctx.beginPath(),this.ctx.arc(a.x,a.y,a.radius+r,0,2*Math.PI)):(this.ctx.beginPath(),this.ctx.roundRect(a.x-r,a.y-r,a.width+r*2,a.height+r*2,6/this.panZoom.scale)),this.ctx.fill(),this.ctx.stroke(),this.ctx.restore())})}this.scene.getConnections().forEach(r=>{r.draw(this.ctx,this.panZoom,i)});const o=this.interactionManager.getTempConnectionLine();o&&(this.ctx.save(),this.ctx.beginPath(),this.ctx.moveTo(o.startX,o.startY),this.ctx.lineTo(o.endX,o.endY),this.ctx.strokeStyle="#000000",this.ctx.lineWidth=2/this.panZoom.scale,this.ctx.setLineDash([5/this.panZoom.scale,5/this.panZoom.scale]),this.ctx.globalAlpha=.5,this.ctx.stroke(),this.ctx.restore(),this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(o.endX,o.endY,8/this.panZoom.scale,0,2*Math.PI),this.ctx.fillStyle=$,this.ctx.fill(),this.ctx.strokeStyle="#000000",this.ctx.lineWidth=1/this.panZoom.scale,this.ctx.stroke(),this.ctx.restore()),this.ctx.restore(),this.scrollbarManager.drawScrollbars()}getSceneCoords(t){const e=this.canvas.getBoundingClientRect(),s=t.clientX-e.left,i=t.clientY-e.top,o=(s+this.panZoom.scrollX)/this.panZoom.scale,r=(i+this.panZoom.scrollY)/this.panZoom.scale;return this.lastMouseCoords={x:o,y:r},{sceneX:o,sceneY:r}}getLastMouseCoords(){return this.lastMouseCoords}onMouseDown(t){const{sceneX:e,sceneY:s}=this.getSceneCoords(t),i=this.canvas.getBoundingClientRect(),o=t.clientX-i.left,r=t.clientY-i.top,a=this.scrollbarManager.hitTestScrollbars(o,r);if(a==="horizontal"){this.draggingScrollbar="horizontal",this.dragStartX=o,this.dragStartScrollX=this.panZoom.scrollX;return}else if(a==="vertical"){this.draggingScrollbar="vertical",this.dragStartY=r,this.dragStartScrollY=this.panZoom.scrollY;return}this.interactionManager.handleMouseDown(t,e,s)&&this.draw()}onMouseMove(t){const{sceneX:e,sceneY:s}=this.getSceneCoords(t);this.lastMouseCoords={x:e,y:s};const i=this.canvas.getBoundingClientRect(),o=t.clientX-i.left,r=t.clientY-i.top;if(this.draggingScrollbar==="horizontal"){const a=this.canvas.width-this.panZoom.scrollbarWidth,h=this.panZoom.virtualWidth*this.panZoom.scale-a,c=o-this.dragStartX,d=h/a;this.panZoom.scrollX=Math.max(0,Math.min(this.dragStartScrollX+c*d,h)),this.draw()}else if(this.draggingScrollbar==="vertical"){const a=this.canvas.height-this.panZoom.scrollbarWidth,h=this.panZoom.virtualHeight*this.panZoom.scale-a,c=r-this.dragStartY,d=h/a;this.panZoom.scrollY=Math.max(0,Math.min(this.dragStartScrollY+c*d,h)),this.draw()}else this.interactionManager.handleMouseMove(e,s),this.draw()}onMouseUp(t){this.draggingScrollbar=null,this.interactionManager.handleMouseUp(),this.draw()}onDoubleClick(t){const{sceneX:e,sceneY:s}=this.getSceneCoords(t);this.interactionManager.handleDoubleClick(e,s),this.draw()}onRightClick(t){const{sceneX:e,sceneY:s}=this.getSceneCoords(t);this.interactionManager.handleRightClick(t,e,s),this.draw()}onWheel(t){t.preventDefault();const e=this.canvas.getBoundingClientRect(),s=t.clientX-e.left,i=t.clientY-e.top;this.panZoom.handleWheelEvent(t,this.canvas,s,i),this.draw()}zoomIn(){this.panZoom.zoomIn(this.canvas),this.draw()}zoomOut(){this.panZoom.zoomOut(this.canvas),this.draw()}centerCanvas(){this.panZoom.center(this.canvas),this.draw()}addElement(t){this.scene.addElement(t),this.draw(),console.log("Added item to canvas:",t)}getCanvas(){return this.canvas}getPanZoomManager(){return this.panZoom}getInteractionManager(){return this.interactionManager}}function qe(n){return"id"in n&&"x"in n&&"y"in n&&"radius"in n&&"contains"in n}function $e(n){return"id"in n&&"selected"in n&&"fromId"in n&&"toId"in n}class Ke{constructor(){this.elements=[],this.changes=new Dt}addElement(t){this.elements.push(t),this.changes.next()}removeElement(t){const e=this.elements.indexOf(t);e>-1&&(this.elements.splice(e,1),this.changes.next())}removeElements(t){t.forEach(e=>{const s=this.elements.indexOf(e);s>-1&&this.elements.splice(s,1)}),this.changes.next()}getElements(){return this.elements}getShapes(){return this.elements.filter(qe)}getConnections(){return this.elements.filter($e)}setSelected(t){this.getElements().forEach(e=>{e.selected=!1}),t.forEach(e=>{e.selected=!0}),this.changes.next()}getSelectedElements(){return this.getElements().filter(t=>t.selected)}getSelectedShapes(){return this.getShapes().filter(t=>t.selected)}clear(){this.elements=[],this.changes.next()}}class Je{constructor(t){this.dataProvider=t}async loadDiagram(t){const e=await this.dataProvider.loadTasks(),s=await this.dataProvider.loadDependencies();e.forEach(o=>{const r=new z({id:o.id,x:o.x,y:o.y,title:o.title,description:o.description,status:o.status,priority:o.priority,dueDate:o.dueDate instanceof Date?o.dueDate:new Date(o.dueDate)});t.addElement(r)}),(await this.dataProvider.loadStories()).forEach(o=>{const r=t.getElements().filter(l=>l instanceof z&&o.tasks.indexOf(l.id)!==-1),a=new M({id:o.id,x:o.x,y:o.y,width:o.width,height:o.height,title:o.title,description:o.description,status:o.status,borderColor:o.borderColor,tasks:r});t.addElement(a)}),s.forEach(o=>{const r=t.getElements().find(l=>l.id===o.fromTaskId),a=t.getElements().find(l=>l.id===o.toTaskId);if(r&&a){const l=new de(r.id,a.id);t.addElement(l)}})}async saveDiagram(t){const e=t.getElements().filter(r=>r instanceof z).map(r=>({id:r.id,x:r.x,y:r.y,title:r.title,description:r.description,status:r.status,priority:r.priority,dueDate:r.dueDate}));await this.dataProvider.saveTasks(e);const s=t.getConnections().map(r=>({fromTaskId:r.fromId,toTaskId:r.toId,type:"dependsOn"}));await this.dataProvider.saveDependencies(s);const o=t.getElements().filter(r=>r instanceof M).map(r=>({id:r.id,x:r.x,y:r.y,width:r.width,height:r.height,title:r.title,description:r.description,status:r.status,borderColor:r.borderColor,tasks:r.tasks.map(a=>a.id)}));await this.dataProvider.saveStories(o)}}class et{constructor(t){this.props=t,this.element=this.createElement()}render(t){t.appendChild(this.element)}updateProps(t){this.props={...this.props,...t},this.update()}update(){const t=this.createElement();this.element.replaceWith(t),this.element=t}getElement(){return this.element}}const Ot="-",Qe=n=>{const t=es(n),{conflictingClassGroups:e,conflictingClassGroupModifiers:s}=n;return{getClassGroupId:r=>{const a=r.split(Ot);return a[0]===""&&a.length!==1&&a.shift(),ue(a,t)||ts(r)},getConflictingClassGroupIds:(r,a)=>{const l=e[r]||[];return a&&s[r]?[...l,...s[r]]:l}}},ue=(n,t)=>{var r;if(n.length===0)return t.classGroupId;const e=n[0],s=t.nextPart.get(e),i=s?ue(n.slice(1),s):void 0;if(i)return i;if(t.validators.length===0)return;const o=n.join(Ot);return(r=t.validators.find(({validator:a})=>a(o)))==null?void 0:r.classGroupId},Kt=/^\[(.+)\]$/,ts=n=>{if(Kt.test(n)){const t=Kt.exec(n)[1],e=t==null?void 0:t.substring(0,t.indexOf(":"));if(e)return"arbitrary.."+e}},es=n=>{const{theme:t,classGroups:e}=n,s={nextPart:new Map,validators:[]};for(const i in e)Pt(e[i],s,i,t);return s},Pt=(n,t,e,s)=>{n.forEach(i=>{if(typeof i=="string"){const o=i===""?t:Jt(t,i);o.classGroupId=e;return}if(typeof i=="function"){if(ss(i)){Pt(i(s),t,e,s);return}t.validators.push({validator:i,classGroupId:e});return}Object.entries(i).forEach(([o,r])=>{Pt(r,Jt(t,o),e,s)})})},Jt=(n,t)=>{let e=n;return t.split(Ot).forEach(s=>{e.nextPart.has(s)||e.nextPart.set(s,{nextPart:new Map,validators:[]}),e=e.nextPart.get(s)}),e},ss=n=>n.isThemeGetter,ns=n=>{if(n<1)return{get:()=>{},set:()=>{}};let t=0,e=new Map,s=new Map;const i=(o,r)=>{e.set(o,r),t++,t>n&&(t=0,s=e,e=new Map)};return{get(o){let r=e.get(o);if(r!==void 0)return r;if((r=s.get(o))!==void 0)return i(o,r),r},set(o,r){e.has(o)?e.set(o,r):i(o,r)}}},It="!",zt=":",is=zt.length,os=n=>{const{prefix:t,experimentalParseClassName:e}=n;let s=i=>{const o=[];let r=0,a=0,l=0,h;for(let y=0;y<i.length;y++){let w=i[y];if(r===0&&a===0){if(w===zt){o.push(i.slice(l,y)),l=y+is;continue}if(w==="/"){h=y;continue}}w==="["?r++:w==="]"?r--:w==="("?a++:w===")"&&a--}const c=o.length===0?i:i.substring(l),d=rs(c),p=d!==c,u=h&&h>l?h-l:void 0;return{modifiers:o,hasImportantModifier:p,baseClassName:d,maybePostfixModifierPosition:u}};if(t){const i=t+zt,o=s;s=r=>r.startsWith(i)?o(r.substring(i.length)):{isExternal:!0,modifiers:[],hasImportantModifier:!1,baseClassName:r,maybePostfixModifierPosition:void 0}}if(e){const i=s;s=o=>e({className:o,parseClassName:i})}return s},rs=n=>n.endsWith(It)?n.substring(0,n.length-1):n.startsWith(It)?n.substring(1):n,as=n=>{const t=Object.fromEntries(n.orderSensitiveModifiers.map(s=>[s,!0]));return s=>{if(s.length<=1)return s;const i=[];let o=[];return s.forEach(r=>{r[0]==="["||t[r]?(i.push(...o.sort(),r),o=[]):o.push(r)}),i.push(...o.sort()),i}},ls=n=>({cache:ns(n.cacheSize),parseClassName:os(n),sortModifiers:as(n),...Qe(n)}),cs=/\s+/,hs=(n,t)=>{const{parseClassName:e,getClassGroupId:s,getConflictingClassGroupIds:i,sortModifiers:o}=t,r=[],a=n.trim().split(cs);let l="";for(let h=a.length-1;h>=0;h-=1){const c=a[h],{isExternal:d,modifiers:p,hasImportantModifier:u,baseClassName:y,maybePostfixModifierPosition:w}=e(c);if(d){l=c+(l.length>0?" "+l:l);continue}let D=!!w,R=s(D?y.substring(0,w):y);if(!R){if(!D){l=c+(l.length>0?" "+l:l);continue}if(R=s(y),!R){l=c+(l.length>0?" "+l:l);continue}D=!1}const T=o(p).join(":"),x=u?T+It:T,S=x+R;if(r.includes(S))continue;r.push(S);const O=i(R,D);for(let A=0;A<O.length;++A){const Q=O[A];r.push(x+Q)}l=c+(l.length>0?" "+l:l)}return l};function ds(){let n=0,t,e,s="";for(;n<arguments.length;)(t=arguments[n++])&&(e=pe(t))&&(s&&(s+=" "),s+=e);return s}const pe=n=>{if(typeof n=="string")return n;let t,e="";for(let s=0;s<n.length;s++)n[s]&&(t=pe(n[s]))&&(e&&(e+=" "),e+=t);return e};function us(n,...t){let e,s,i,o=r;function r(l){const h=t.reduce((c,d)=>d(c),n());return e=ls(h),s=e.cache.get,i=e.cache.set,o=a,a(l)}function a(l){const h=s(l);if(h)return h;const c=hs(l,e);return i(l,c),c}return function(){return o(ds.apply(null,arguments))}}const k=n=>{const t=e=>e[n]||[];return t.isThemeGetter=!0,t},fe=/^\[(?:(\w[\w-]*):)?(.+)\]$/i,ge=/^\((?:(\w[\w-]*):)?(.+)\)$/i,ps=/^\d+\/\d+$/,fs=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,gs=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,ms=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,bs=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,ys=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,G=n=>ps.test(n),v=n=>!!n&&!Number.isNaN(Number(n)),X=n=>!!n&&Number.isInteger(Number(n)),vt=n=>n.endsWith("%")&&v(n.slice(0,-1)),H=n=>fs.test(n),vs=()=>!0,ws=n=>gs.test(n)&&!ms.test(n),me=()=>!1,xs=n=>bs.test(n),Ss=n=>ys.test(n),ks=n=>!f(n)&&!g(n),Cs=n=>K(n,ve,me),f=n=>fe.test(n),U=n=>K(n,we,ws),wt=n=>K(n,zs,v),Qt=n=>K(n,be,me),Es=n=>K(n,ye,Ss),lt=n=>K(n,xe,xs),g=n=>ge.test(n),tt=n=>J(n,we),Ms=n=>J(n,Ts),te=n=>J(n,be),Ps=n=>J(n,ve),Is=n=>J(n,ye),ct=n=>J(n,xe,!0),K=(n,t,e)=>{const s=fe.exec(n);return s?s[1]?t(s[1]):e(s[2]):!1},J=(n,t,e=!1)=>{const s=ge.exec(n);return s?s[1]?t(s[1]):e:!1},be=n=>n==="position"||n==="percentage",ye=n=>n==="image"||n==="url",ve=n=>n==="length"||n==="size"||n==="bg-size",we=n=>n==="length",zs=n=>n==="number",Ts=n=>n==="family-name",xe=n=>n==="shadow",Ls=()=>{const n=k("color"),t=k("font"),e=k("text"),s=k("font-weight"),i=k("tracking"),o=k("leading"),r=k("breakpoint"),a=k("container"),l=k("spacing"),h=k("radius"),c=k("shadow"),d=k("inset-shadow"),p=k("text-shadow"),u=k("drop-shadow"),y=k("blur"),w=k("perspective"),D=k("aspect"),R=k("ease"),T=k("animate"),x=()=>["auto","avoid","all","avoid-page","page","left","right","column"],S=()=>["center","top","bottom","left","right","top-left","left-top","top-right","right-top","bottom-right","right-bottom","bottom-left","left-bottom"],O=()=>[...S(),g,f],A=()=>["auto","hidden","clip","visible","scroll"],Q=()=>["auto","contain","none"],b=()=>[g,f,l],W=()=>[G,"full","auto",...b()],Yt=()=>[X,"none","subgrid",g,f],Ht=()=>["auto",{span:["full",X,g,f]},X,g,f],st=()=>[X,"auto",g,f],Nt=()=>["auto","min","max","fr",g,f],ft=()=>["start","end","center","between","around","evenly","stretch","baseline","center-safe","end-safe"],j=()=>["start","end","center","stretch","center-safe","end-safe"],Y=()=>["auto",...b()],V=()=>[G,"auto","full","dvw","dvh","lvw","lvh","svw","svh","min","max","fit",...b()],m=()=>[n,g,f],Xt=()=>[...S(),te,Qt,{position:[g,f]}],Zt=()=>["no-repeat",{repeat:["","x","y","space","round"]}],_t=()=>["auto","cover","contain",Ps,Cs,{size:[g,f]}],gt=()=>[vt,tt,U],I=()=>["","none","full",h,g,f],L=()=>["",v,tt,U],nt=()=>["solid","dashed","dotted","double"],Bt=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],E=()=>[v,vt,te,Qt],Vt=()=>["","none",y,g,f],it=()=>["none",v,g,f],ot=()=>["none",v,g,f],mt=()=>[v,g,f],rt=()=>[G,"full",...b()];return{cacheSize:500,theme:{animate:["spin","ping","pulse","bounce"],aspect:["video"],blur:[H],breakpoint:[H],color:[vs],container:[H],"drop-shadow":[H],ease:["in","out","in-out"],font:[ks],"font-weight":["thin","extralight","light","normal","medium","semibold","bold","extrabold","black"],"inset-shadow":[H],leading:["none","tight","snug","normal","relaxed","loose"],perspective:["dramatic","near","normal","midrange","distant","none"],radius:[H],shadow:[H],spacing:["px",v],text:[H],"text-shadow":[H],tracking:["tighter","tight","normal","wide","wider","widest"]},classGroups:{aspect:[{aspect:["auto","square",G,f,g,D]}],container:["container"],columns:[{columns:[v,f,g,a]}],"break-after":[{"break-after":x()}],"break-before":[{"break-before":x()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],sr:["sr-only","not-sr-only"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:O()}],overflow:[{overflow:A()}],"overflow-x":[{"overflow-x":A()}],"overflow-y":[{"overflow-y":A()}],overscroll:[{overscroll:Q()}],"overscroll-x":[{"overscroll-x":Q()}],"overscroll-y":[{"overscroll-y":Q()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:W()}],"inset-x":[{"inset-x":W()}],"inset-y":[{"inset-y":W()}],start:[{start:W()}],end:[{end:W()}],top:[{top:W()}],right:[{right:W()}],bottom:[{bottom:W()}],left:[{left:W()}],visibility:["visible","invisible","collapse"],z:[{z:[X,"auto",g,f]}],basis:[{basis:[G,"full","auto",a,...b()]}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["nowrap","wrap","wrap-reverse"]}],flex:[{flex:[v,G,"auto","initial","none",f]}],grow:[{grow:["",v,g,f]}],shrink:[{shrink:["",v,g,f]}],order:[{order:[X,"first","last","none",g,f]}],"grid-cols":[{"grid-cols":Yt()}],"col-start-end":[{col:Ht()}],"col-start":[{"col-start":st()}],"col-end":[{"col-end":st()}],"grid-rows":[{"grid-rows":Yt()}],"row-start-end":[{row:Ht()}],"row-start":[{"row-start":st()}],"row-end":[{"row-end":st()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":Nt()}],"auto-rows":[{"auto-rows":Nt()}],gap:[{gap:b()}],"gap-x":[{"gap-x":b()}],"gap-y":[{"gap-y":b()}],"justify-content":[{justify:[...ft(),"normal"]}],"justify-items":[{"justify-items":[...j(),"normal"]}],"justify-self":[{"justify-self":["auto",...j()]}],"align-content":[{content:["normal",...ft()]}],"align-items":[{items:[...j(),{baseline:["","last"]}]}],"align-self":[{self:["auto",...j(),{baseline:["","last"]}]}],"place-content":[{"place-content":ft()}],"place-items":[{"place-items":[...j(),"baseline"]}],"place-self":[{"place-self":["auto",...j()]}],p:[{p:b()}],px:[{px:b()}],py:[{py:b()}],ps:[{ps:b()}],pe:[{pe:b()}],pt:[{pt:b()}],pr:[{pr:b()}],pb:[{pb:b()}],pl:[{pl:b()}],m:[{m:Y()}],mx:[{mx:Y()}],my:[{my:Y()}],ms:[{ms:Y()}],me:[{me:Y()}],mt:[{mt:Y()}],mr:[{mr:Y()}],mb:[{mb:Y()}],ml:[{ml:Y()}],"space-x":[{"space-x":b()}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":b()}],"space-y-reverse":["space-y-reverse"],size:[{size:V()}],w:[{w:[a,"screen",...V()]}],"min-w":[{"min-w":[a,"screen","none",...V()]}],"max-w":[{"max-w":[a,"screen","none","prose",{screen:[r]},...V()]}],h:[{h:["screen",...V()]}],"min-h":[{"min-h":["screen","none",...V()]}],"max-h":[{"max-h":["screen",...V()]}],"font-size":[{text:["base",e,tt,U]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:[s,g,wt]}],"font-stretch":[{"font-stretch":["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded",vt,f]}],"font-family":[{font:[Ms,f,t]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:[i,g,f]}],"line-clamp":[{"line-clamp":[v,"none",g,wt]}],leading:[{leading:[o,...b()]}],"list-image":[{"list-image":["none",g,f]}],"list-style-position":[{list:["inside","outside"]}],"list-style-type":[{list:["disc","decimal","none",g,f]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"placeholder-color":[{placeholder:m()}],"text-color":[{text:m()}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...nt(),"wavy"]}],"text-decoration-thickness":[{decoration:[v,"from-font","auto",g,U]}],"text-decoration-color":[{decoration:m()}],"underline-offset":[{"underline-offset":[v,"auto",g,f]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:b()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",g,f]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],wrap:[{wrap:["break-word","anywhere","normal"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",g,f]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:Xt()}],"bg-repeat":[{bg:Zt()}],"bg-size":[{bg:_t()}],"bg-image":[{bg:["none",{linear:[{to:["t","tr","r","br","b","bl","l","tl"]},X,g,f],radial:["",g,f],conic:[X,g,f]},Is,Es]}],"bg-color":[{bg:m()}],"gradient-from-pos":[{from:gt()}],"gradient-via-pos":[{via:gt()}],"gradient-to-pos":[{to:gt()}],"gradient-from":[{from:m()}],"gradient-via":[{via:m()}],"gradient-to":[{to:m()}],rounded:[{rounded:I()}],"rounded-s":[{"rounded-s":I()}],"rounded-e":[{"rounded-e":I()}],"rounded-t":[{"rounded-t":I()}],"rounded-r":[{"rounded-r":I()}],"rounded-b":[{"rounded-b":I()}],"rounded-l":[{"rounded-l":I()}],"rounded-ss":[{"rounded-ss":I()}],"rounded-se":[{"rounded-se":I()}],"rounded-ee":[{"rounded-ee":I()}],"rounded-es":[{"rounded-es":I()}],"rounded-tl":[{"rounded-tl":I()}],"rounded-tr":[{"rounded-tr":I()}],"rounded-br":[{"rounded-br":I()}],"rounded-bl":[{"rounded-bl":I()}],"border-w":[{border:L()}],"border-w-x":[{"border-x":L()}],"border-w-y":[{"border-y":L()}],"border-w-s":[{"border-s":L()}],"border-w-e":[{"border-e":L()}],"border-w-t":[{"border-t":L()}],"border-w-r":[{"border-r":L()}],"border-w-b":[{"border-b":L()}],"border-w-l":[{"border-l":L()}],"divide-x":[{"divide-x":L()}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":L()}],"divide-y-reverse":["divide-y-reverse"],"border-style":[{border:[...nt(),"hidden","none"]}],"divide-style":[{divide:[...nt(),"hidden","none"]}],"border-color":[{border:m()}],"border-color-x":[{"border-x":m()}],"border-color-y":[{"border-y":m()}],"border-color-s":[{"border-s":m()}],"border-color-e":[{"border-e":m()}],"border-color-t":[{"border-t":m()}],"border-color-r":[{"border-r":m()}],"border-color-b":[{"border-b":m()}],"border-color-l":[{"border-l":m()}],"divide-color":[{divide:m()}],"outline-style":[{outline:[...nt(),"none","hidden"]}],"outline-offset":[{"outline-offset":[v,g,f]}],"outline-w":[{outline:["",v,tt,U]}],"outline-color":[{outline:m()}],shadow:[{shadow:["","none",c,ct,lt]}],"shadow-color":[{shadow:m()}],"inset-shadow":[{"inset-shadow":["none",d,ct,lt]}],"inset-shadow-color":[{"inset-shadow":m()}],"ring-w":[{ring:L()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:m()}],"ring-offset-w":[{"ring-offset":[v,U]}],"ring-offset-color":[{"ring-offset":m()}],"inset-ring-w":[{"inset-ring":L()}],"inset-ring-color":[{"inset-ring":m()}],"text-shadow":[{"text-shadow":["none",p,ct,lt]}],"text-shadow-color":[{"text-shadow":m()}],opacity:[{opacity:[v,g,f]}],"mix-blend":[{"mix-blend":[...Bt(),"plus-darker","plus-lighter"]}],"bg-blend":[{"bg-blend":Bt()}],"mask-clip":[{"mask-clip":["border","padding","content","fill","stroke","view"]},"mask-no-clip"],"mask-composite":[{mask:["add","subtract","intersect","exclude"]}],"mask-image-linear-pos":[{"mask-linear":[v]}],"mask-image-linear-from-pos":[{"mask-linear-from":E()}],"mask-image-linear-to-pos":[{"mask-linear-to":E()}],"mask-image-linear-from-color":[{"mask-linear-from":m()}],"mask-image-linear-to-color":[{"mask-linear-to":m()}],"mask-image-t-from-pos":[{"mask-t-from":E()}],"mask-image-t-to-pos":[{"mask-t-to":E()}],"mask-image-t-from-color":[{"mask-t-from":m()}],"mask-image-t-to-color":[{"mask-t-to":m()}],"mask-image-r-from-pos":[{"mask-r-from":E()}],"mask-image-r-to-pos":[{"mask-r-to":E()}],"mask-image-r-from-color":[{"mask-r-from":m()}],"mask-image-r-to-color":[{"mask-r-to":m()}],"mask-image-b-from-pos":[{"mask-b-from":E()}],"mask-image-b-to-pos":[{"mask-b-to":E()}],"mask-image-b-from-color":[{"mask-b-from":m()}],"mask-image-b-to-color":[{"mask-b-to":m()}],"mask-image-l-from-pos":[{"mask-l-from":E()}],"mask-image-l-to-pos":[{"mask-l-to":E()}],"mask-image-l-from-color":[{"mask-l-from":m()}],"mask-image-l-to-color":[{"mask-l-to":m()}],"mask-image-x-from-pos":[{"mask-x-from":E()}],"mask-image-x-to-pos":[{"mask-x-to":E()}],"mask-image-x-from-color":[{"mask-x-from":m()}],"mask-image-x-to-color":[{"mask-x-to":m()}],"mask-image-y-from-pos":[{"mask-y-from":E()}],"mask-image-y-to-pos":[{"mask-y-to":E()}],"mask-image-y-from-color":[{"mask-y-from":m()}],"mask-image-y-to-color":[{"mask-y-to":m()}],"mask-image-radial":[{"mask-radial":[g,f]}],"mask-image-radial-from-pos":[{"mask-radial-from":E()}],"mask-image-radial-to-pos":[{"mask-radial-to":E()}],"mask-image-radial-from-color":[{"mask-radial-from":m()}],"mask-image-radial-to-color":[{"mask-radial-to":m()}],"mask-image-radial-shape":[{"mask-radial":["circle","ellipse"]}],"mask-image-radial-size":[{"mask-radial":[{closest:["side","corner"],farthest:["side","corner"]}]}],"mask-image-radial-pos":[{"mask-radial-at":S()}],"mask-image-conic-pos":[{"mask-conic":[v]}],"mask-image-conic-from-pos":[{"mask-conic-from":E()}],"mask-image-conic-to-pos":[{"mask-conic-to":E()}],"mask-image-conic-from-color":[{"mask-conic-from":m()}],"mask-image-conic-to-color":[{"mask-conic-to":m()}],"mask-mode":[{mask:["alpha","luminance","match"]}],"mask-origin":[{"mask-origin":["border","padding","content","fill","stroke","view"]}],"mask-position":[{mask:Xt()}],"mask-repeat":[{mask:Zt()}],"mask-size":[{mask:_t()}],"mask-type":[{"mask-type":["alpha","luminance"]}],"mask-image":[{mask:["none",g,f]}],filter:[{filter:["","none",g,f]}],blur:[{blur:Vt()}],brightness:[{brightness:[v,g,f]}],contrast:[{contrast:[v,g,f]}],"drop-shadow":[{"drop-shadow":["","none",u,ct,lt]}],"drop-shadow-color":[{"drop-shadow":m()}],grayscale:[{grayscale:["",v,g,f]}],"hue-rotate":[{"hue-rotate":[v,g,f]}],invert:[{invert:["",v,g,f]}],saturate:[{saturate:[v,g,f]}],sepia:[{sepia:["",v,g,f]}],"backdrop-filter":[{"backdrop-filter":["","none",g,f]}],"backdrop-blur":[{"backdrop-blur":Vt()}],"backdrop-brightness":[{"backdrop-brightness":[v,g,f]}],"backdrop-contrast":[{"backdrop-contrast":[v,g,f]}],"backdrop-grayscale":[{"backdrop-grayscale":["",v,g,f]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[v,g,f]}],"backdrop-invert":[{"backdrop-invert":["",v,g,f]}],"backdrop-opacity":[{"backdrop-opacity":[v,g,f]}],"backdrop-saturate":[{"backdrop-saturate":[v,g,f]}],"backdrop-sepia":[{"backdrop-sepia":["",v,g,f]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":b()}],"border-spacing-x":[{"border-spacing-x":b()}],"border-spacing-y":[{"border-spacing-y":b()}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["","all","colors","opacity","shadow","transform","none",g,f]}],"transition-behavior":[{transition:["normal","discrete"]}],duration:[{duration:[v,"initial",g,f]}],ease:[{ease:["linear","initial",R,g,f]}],delay:[{delay:[v,g,f]}],animate:[{animate:["none",T,g,f]}],backface:[{backface:["hidden","visible"]}],perspective:[{perspective:[w,g,f]}],"perspective-origin":[{"perspective-origin":O()}],rotate:[{rotate:it()}],"rotate-x":[{"rotate-x":it()}],"rotate-y":[{"rotate-y":it()}],"rotate-z":[{"rotate-z":it()}],scale:[{scale:ot()}],"scale-x":[{"scale-x":ot()}],"scale-y":[{"scale-y":ot()}],"scale-z":[{"scale-z":ot()}],"scale-3d":["scale-3d"],skew:[{skew:mt()}],"skew-x":[{"skew-x":mt()}],"skew-y":[{"skew-y":mt()}],transform:[{transform:[g,f,"","none","gpu","cpu"]}],"transform-origin":[{origin:O()}],"transform-style":[{transform:["3d","flat"]}],translate:[{translate:rt()}],"translate-x":[{"translate-x":rt()}],"translate-y":[{"translate-y":rt()}],"translate-z":[{"translate-z":rt()}],"translate-none":["translate-none"],accent:[{accent:m()}],appearance:[{appearance:["none","auto"]}],"caret-color":[{caret:m()}],"color-scheme":[{scheme:["normal","dark","light","light-dark","only-dark","only-light"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",g,f]}],"field-sizing":[{"field-sizing":["fixed","content"]}],"pointer-events":[{"pointer-events":["auto","none"]}],resize:[{resize:["none","","y","x"]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":b()}],"scroll-mx":[{"scroll-mx":b()}],"scroll-my":[{"scroll-my":b()}],"scroll-ms":[{"scroll-ms":b()}],"scroll-me":[{"scroll-me":b()}],"scroll-mt":[{"scroll-mt":b()}],"scroll-mr":[{"scroll-mr":b()}],"scroll-mb":[{"scroll-mb":b()}],"scroll-ml":[{"scroll-ml":b()}],"scroll-p":[{"scroll-p":b()}],"scroll-px":[{"scroll-px":b()}],"scroll-py":[{"scroll-py":b()}],"scroll-ps":[{"scroll-ps":b()}],"scroll-pe":[{"scroll-pe":b()}],"scroll-pt":[{"scroll-pt":b()}],"scroll-pr":[{"scroll-pr":b()}],"scroll-pb":[{"scroll-pb":b()}],"scroll-pl":[{"scroll-pl":b()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",g,f]}],fill:[{fill:["none",...m()]}],"stroke-w":[{stroke:[v,tt,U,wt]}],stroke:[{stroke:["none",...m()]}],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-x","border-w-y","border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-x","border-color-y","border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],translate:["translate-x","translate-y","translate-none"],"translate-none":["translate","translate-x","translate-y","translate-z"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]},orderSensitiveModifiers:["*","**","after","backdrop","before","details-content","file","first-letter","first-line","marker","placeholder","selection"]}},_=us(Ls);class dt extends et{createElement(){const t=document.createElement("button");t.type=this.props.type||"button",this.props.text&&(t.innerText=this.props.text),this.props.children&&(typeof this.props.children=="string"?t.innerText=this.props.children:t.appendChild(this.props.children)),this.props.onClick&&t.addEventListener("click",this.props.onClick),this.props.disabled&&(t.disabled=!0),this.props.tooltip&&(t.title=this.props.tooltip);const e=["inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors","focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2","disabled:pointer-events-none disabled:opacity-50","[&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0","cursor-pointer"].join(" "),s={default:"bg-primary text-white hover:bg-primary/90 active:bg-primary/80 transition-colors",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90 active:bg-destructive/80 transition-colors",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground active:bg-accent/80 transition-colors",secondary:"bg-gray-100 text-gray-900 hover:bg-gray-200 active:bg-gray-300 transition-colors",ghost:"hover:bg-accent hover:text-accent-foreground active:bg-accent/80 transition-colors",link:"text-primary underline-offset-4 hover:underline active:text-primary/80 transition-colors",lightgray:"bg-gray-200 text-gray-900 hover:bg-gray-300 active:bg-gray-400 border border-gray-300 transition-colors"},i={default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"},o=this.props.variant||"default",r=this.props.size||"default";return t.className=_(e,s[o],i[r],this.props.className||""),t}}class At{constructor(){this.listeners=[]}on(t){this.listeners.push(t)}emit(t){this.listeners.forEach(e=>e(t))}}class Tt extends et{constructor(t){super(t),this.changeEmitter=new At,t.onChange&&this.onChange(t.onChange)}createElement(){const t=document.createElement("input");t.type=this.props.type||"text",this.props.value!==void 0&&(t.value=this.props.value),this.props.placeholder&&(t.placeholder=this.props.placeholder),this.props.disabled&&(t.disabled=!0),this.props.name&&(t.name=this.props.name),this.props.id&&(t.id=this.props.id),this.props.autoFocus&&(t.autofocus=!0),this.props.autoComplete&&(t.autocomplete=this.props.autoComplete),this.props.required&&(t.required=!0),this.props.minLength!==void 0&&(t.minLength=this.props.minLength),this.props.maxLength!==void 0&&(t.maxLength=this.props.maxLength),this.props.pattern&&(t.pattern=this.props.pattern),t.addEventListener("input",()=>{this.changeEmitter.emit(t.value)});const e=["flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background","placeholder:text-muted-foreground","focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2","disabled:cursor-not-allowed disabled:opacity-50"].join(" ");return t.className=_(e,this.props.className||""),t}onChange(t){this.changeEmitter.on(t)}setValue(t){this.updateProps({value:t})}getValue(){return this.element.value}}class Ds extends et{constructor(t,e){super(t),this.modal=null,this.errorMessage=null,this.isLoading=!1,this.authService=e,this.avatarContainer=document.createElement("div"),this.avatarContainer.className="absolute top-4 right-4",this.loginButton=new dt({text:"Login",onClick:()=>this.showLoginModal(),variant:"default",className:"w-full"}).createElement(),this.logoutButton=new dt({text:"Logout",onClick:()=>this.handleLogout(),variant:"destructive",className:"w-full"}).createElement(),this.dropdownMenu=document.createElement("div"),this.dropdownMenu.className="absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg z-10 hidden",this.dropdownMenu.appendChild(this.logoutButton),this.avatarContainer.appendChild(this.dropdownMenu),t instanceof Node?this.avatarContainer instanceof Node?t.appendChild(this.avatarContainer):console.error("avatarContainer is not a valid DOM node",this.avatarContainer):console.error("Container is not a valid DOM node",t),this.updateUI()}createElement(){return this.avatarContainer}updateUI(){var t;this.authService.isLoggedIn()?(this.authService.getAuthToken(),this.avatarContainer.innerHTML='<img src="avatar-url-placeholder" alt="User Avatar" class="w-10 h-10 rounded-full cursor-pointer">',(t=this.avatarContainer.firstChild)==null||t.addEventListener("click",()=>this.toggleDropdown()),this.avatarContainer.appendChild(this.dropdownMenu)):(this.avatarContainer.innerHTML="",this.avatarContainer.appendChild(this.loginButton))}toggleDropdown(){this.dropdownMenu.classList.contains("hidden")?this.dropdownMenu.classList.remove("hidden"):this.dropdownMenu.classList.add("hidden")}showLoginModal(){if(this.modal)return;this.modal=document.createElement("div"),this.modal.className="fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50";const t=document.createElement("div");t.className="bg-white rounded-lg p-6 w-96",t.innerHTML=`
      <h2 class="text-2xl font-bold mb-4">Login to Majom Canvas</h2>
      <form id="loginForm">
        <div class="mb-4">
          <label for="username" class="block text-sm font-medium text-gray-700">Username</label>
          <span id="usernameInputPlaceholder"></span>
        </div>
        <div class="mb-4">
          <label for="password" class="block text-sm font-medium text-gray-700">Password</label>
          <span id="passwordInputPlaceholder"></span>
        </div>
        <span id="loginSubmitPlaceholder"></span>
      </form>
      <div id="errorMessage" class="mt-2 text-red-500 hidden"></div>
    `,this.modal.appendChild(t);const e=new Tt({id:"username",name:"username",type:"text",placeholder:"Enter your username",className:"mt-1"}).createElement(),s=new Tt({id:"password",name:"password",type:"password",placeholder:"Enter your password",className:"mt-1"}).createElement(),i=t.querySelector("#usernameInputPlaceholder"),o=t.querySelector("#passwordInputPlaceholder");i&&i.replaceWith(e),o&&o.replaceWith(s),document.body.appendChild(this.modal);const r=t.querySelector("#loginForm");this.errorMessage=t.querySelector("#errorMessage");const a=t.querySelector("#loginSubmitPlaceholder");if(a){const l=new dt({text:"Login",type:"submit",variant:"default",className:"w-full"}).createElement();l.id="loginSubmit",a.replaceWith(l)}r==null||r.addEventListener("submit",l=>this.handleLoginSubmit(l)),this.modal.addEventListener("click",l=>{l.target===this.modal&&this.closeModal()})}closeModal(){this.modal&&(document.body.removeChild(this.modal),this.modal=null,this.errorMessage=null)}async handleLoginSubmit(t){if(t.preventDefault(),this.isLoading||!this.modal)return;const e=this.modal.querySelector("#username"),s=this.modal.querySelector("#password"),i=this.modal.querySelector("#loginSubmit"),o={username:e.value,password:s.value};this.isLoading=!0,i.disabled=!0,i.textContent="Logging in...";try{await this.authService.login(o),this.isLoading=!1,this.closeModal(),this.updateUI(),window.dispatchEvent(new CustomEvent("refreshCanvasData"))}catch(r){this.isLoading=!1,i.disabled=!1,i.textContent="Login",this.errorMessage&&(this.errorMessage.classList.remove("hidden"),this.errorMessage.textContent=r instanceof Error?r.message:"An error occurred. Please try again.")}}handleLogout(){this.authService.logout(),this.updateUI(),this.dropdownMenu.classList.add("hidden"),window.dispatchEvent(new CustomEvent("refreshCanvasData"))}}const Rs={apiUrl:"https://mxll.pythonanywhere.com"};class Os{constructor(t){this.baseUrl=Rs.apiUrl,t&&(this.baseUrl=t)}async login(t){try{const e=await fetch(`${this.baseUrl}/token/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!e.ok)throw new Error("Login failed. Please check your credentials.");const s=await e.json();return this.setTokens({access:s.access,refresh:s.refresh}),s}catch(e){throw new Error(e instanceof Error?e.message:"An error occurred during login.")}}async refreshToken(){try{const t=this.getRefreshToken();if(!t)throw new Error("No refresh token available.");const e=await fetch(`${this.baseUrl}/token/refresh/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refresh:t})});if(!e.ok)throw new Error("Token refresh failed.");const s=await e.json();return this.setToken(s.access),{access:s.access}}catch(t){throw new Error(t instanceof Error?t.message:"An error occurred during token refresh.")}}logout(){this.removeTokens()}setTokens(t){localStorage.setItem("jwt",t.access),localStorage.setItem("refresh",t.refresh)}setToken(t){localStorage.setItem("jwt",t)}setRefreshToken(t){localStorage.setItem("refresh",t)}removeTokens(){localStorage.removeItem("jwt"),localStorage.removeItem("refresh")}getAuthToken(){return localStorage.getItem("jwt")}async getUser(){try{const t=this.getAuthToken();if(!t)throw new Error("No auth token found. User is not authenticated.");const e=await fetch(`${this.baseUrl}/user/`,{headers:{Authorization:`Bearer ${t}`}});if(!e.ok)throw new Error("Failed to fetch user data.");return await e.json()}catch(t){throw new Error(t instanceof Error?t.message:"An error occurred while fetching user data.")}}getRefreshToken(){return localStorage.getItem("refresh")}isLoggedIn(){const t=this.getRefreshToken();return t?!this.isTokenExpired(t):!1}isTokenExpired(t){try{const e=this.decodeToken(t);if(!(e!=null&&e.exp))return!0;const s=e.exp*1e3;return Date.now()>s}catch{return!0}}decodeToken(t){try{const e=t.split(".")[1];return JSON.parse(atob(e))}catch{return null}}}const ee={button:{primary:"bg-blue-500 text-white hover:bg-blue-600",secondary:"bg-gray-500 text-white hover:bg-gray-600",danger:"bg-red-500 text-white hover:bg-red-600"},input:"border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",checkbox:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"},Wt=class Wt{static setTheme(t){this.theme={...ee,...t}}static getTheme(){return this.theme}};Wt.theme=ee;let Lt=Wt;class As extends et{constructor(t){super(t),this.changeEmitter=new At,t.onChange&&this.onChange(t.onChange)}createElement(){this.container=document.createElement("div"),this.container.className="flex items-center",this.input=document.createElement("input"),this.input.type="checkbox",this.input.checked=this.props.checked,this.input.addEventListener("change",()=>{this.changeEmitter.emit(this.input.checked)});const e=Lt.getTheme().checkbox;return this.input.className=_(e,this.props.className||""),this.container.appendChild(this.input),this.props.label&&(this.labelElement=document.createElement("label"),this.labelElement.innerText=this.props.label,this.labelElement.className="ml-2",this.container.appendChild(this.labelElement)),this.container}onChange(t){this.changeEmitter.on(t)}setChecked(t){this.updateProps({checked:t})}isChecked(){return this.input.checked}}class Ws extends et{constructor(t){super(t),this.props=t,this.isListVisible=!1}createElement(){this.filteredItems=[...this.props.items],this.filterInput=B.createInput({value:"",placeholder:this.props.placeholder??"Search items...",onChange:s=>this.filterItems(s)}),this.props.onSelect&&(this.selectEmitter||(this.selectEmitter=new At),this.onSelect(this.props.onSelect));const t=document.createElement("div");t.className=_("relative flex flex-col gap-2",this.props.className||"");const e=document.createElement("div");return this.filterInput.render(e),t.appendChild(e),this.listContainer=document.createElement("ul"),this.listContainer.className=_("absolute top-full left-0 w-full flex flex-col gap-2 mt-1 bg-gray-100 rounded-lg shadow-lg max-h-60 overflow-y-auto",this.isListVisible?"block":"hidden"),this.renderItems(),t.appendChild(this.listContainer),this.filterInput.getElement().addEventListener("focus",()=>{this.isListVisible=!0,this.updateListVisibility()}),this.filterInput.getElement().addEventListener("blur",()=>{setTimeout(()=>{this.isListVisible=!1,this.updateListVisibility()},150)}),t}filterItems(t){const e=t.toLowerCase();this.filteredItems=this.props.items.filter(s=>s.label.toLowerCase().includes(e)),this.isListVisible=!0,this.renderItems()}renderItems(){if(this.listContainer.innerHTML="",this.filteredItems.length===0){const t=document.createElement("li");t.textContent="No items found",t.className=_("px-3 py-2 text-gray-500 italic text-center bg-white rounded-lg border-2 border-gray-200"),this.listContainer.appendChild(t)}else this.filteredItems.forEach(t=>{const e=document.createElement("li");e.textContent=t.label,e.className=_("px-3 py-2 text-gray-800 hover:bg-gray-200 cursor-pointer"),e.addEventListener("click",()=>{this.selectItem(t)}),this.listContainer.appendChild(e)});this.updateListVisibility()}selectItem(t){this.filterInput.setValue(t.label),this.isListVisible=!1,this.selectEmitter.emit(t.value),this.updateListVisibility()}updateListVisibility(){this.listContainer.className=_("absolute top-full left-0 w-full flex flex-col gap-2 mt-1 bg-gray-100 rounded-lg shadow-lg max-h-60 overflow-y-auto",this.isListVisible?"block":"hidden")}updateItems(t){this.props.items=t,this.filteredItems=[...t],this.filterItems(this.filterInput.getValue())}onSelect(t){this.selectEmitter.on(t)}getSelectedValue(){return this.filterInput.getValue()}}class B{static createButton(t){return new dt(t)}static createInput(t){return new Tt(t)}static createCheckbox(t){return new As(t)}static createSearchSelect(t){return new Ws(t)}}class Ys{constructor(t){this.canvasManager=t,this.container=document.createElement("div"),this.container.style.position="absolute",this.container.style.right="24px",this.container.style.bottom="24px",this.container.style.display="flex",this.container.style.flexDirection="column",this.container.style.gap="12px",this.container.style.background="rgba(255,255,255,0.95)",this.container.style.borderRadius="12px",this.container.style.boxShadow="0 2px 10px rgba(0,0,0,0.08)",this.container.style.padding="12px";const e="secondary",s=B.createButton({text:"+",variant:e,size:"icon",onClick:()=>this.canvasManager.zoomIn(),tooltip:"Zoom In"}).createElement(),i=B.createButton({text:"-",variant:e,size:"icon",onClick:()=>this.canvasManager.zoomOut(),tooltip:"Zoom Out"}).createElement(),o=B.createButton({text:"⦿",variant:e,size:"icon",onClick:()=>this.canvasManager.centerCanvas(),tooltip:"Center Canvas"}).createElement();this.container.appendChild(s),this.container.appendChild(i),this.container.appendChild(o)}mount(t=document.body){t.appendChild(this.container)}unmount(){this.container.remove()}}class Hs{constructor(t){this.canvasManager=t,this.container=document.createElement("div"),this.container.style.position="absolute",this.container.style.left="20px",this.container.style.bottom="20px",this.container.style.background="rgba(255,255,255,0.95)",this.container.style.borderRadius="8px",this.container.style.boxShadow="0 1px 4px rgba(0,0,0,0.08)",this.container.style.padding="6px 16px",this.container.style.fontSize="1.1rem",this.container.style.fontWeight="500",this.container.style.color="#222",this.valueEl=document.createElement("span"),this.container.appendChild(this.valueEl),this.update(),this.canvasManager.panZoom.onZoomChange(()=>this.update())}mount(t=document.body){t.appendChild(this.container)}update(){const t=Math.round(this.canvasManager.panZoom.scale*100);this.valueEl.textContent=`${t}%`}unmount(){this.container.remove()}}class Ns{constructor(t,e){this.scene=t,this.canvasManager=e,this.container=this.createToolbarContainer(),this.addButtons()}createToolbarContainer(){const t=document.createElement("div");return t.className="canvas-toolbar",t.style.position="absolute",t.style.top="20px",t.style.left="50%",t.style.transform="translateX(-50%)",t.style.display="flex",t.style.gap="12px",t.style.padding="12px",t.style.background="white",t.style.borderRadius="12px",t.style.boxShadow="0 2px 10px rgba(0,0,0,0.1)",t.style.zIndex="1000",t}addButtons(){B.createButton({text:"Select",variant:"secondary",onClick:()=>this.handleSelectMode(),tooltip:"Select elements on canvas"}).createElement();const t=B.createButton({text:"Task",variant:"secondary",onClick:()=>this.createTask(),tooltip:"Create a new task on canvas"}).createElement(),e=B.createButton({text:"Story",variant:"secondary",onClick:()=>this.createStory(),tooltip:"Create a new story on canvas"}).createElement(),s=B.createButton({text:"Goal",variant:"secondary",onClick:()=>alert("Додавання Goal тимчасово вимкнено"),tooltip:"Create a new goal on canvas"}).createElement();this.container.appendChild(t),this.container.appendChild(e),this.container.appendChild(s)}handleSelectMode(){console.log("Select mode activated")}createTask(){const t=this.canvasManager.canvas.width/2,e=this.canvasManager.canvas.height/2,s=this.canvasManager.getPanZoomManager(),i=t*s.scale+s.scrollX-z.width/2,o=e*s.scale+s.scrollY-z.height/2,r=new z({title:"New Task",description:"Enter description",status:"pending",x:i,y:o,selected:!0});this.scene.addElement(r),this.canvasManager.draw()}createStory(){const t=this.canvasManager.canvas.width/2,e=this.canvasManager.canvas.height/2,s=this.canvasManager.getPanZoomManager(),i=t*s.scale+s.scrollX-M.width/2,o=e*s.scale+s.scrollY-M.height/2,r=new M({x:i,y:o});this.scene.addElement(r),this.canvasManager.draw()}createGoal(){}mount(t=document.body){t.appendChild(this.container)}unmount(){this.container.parentElement&&this.container.parentElement.removeChild(this.container)}}class Xs{constructor(t,e){this.canvasManager=t,this.scene=e,this.components=[],this.canvasToolbar=new Ns(this.scene,this.canvasManager),this.canvasControls=new Ys(this.canvasManager),this.zoomIndicator=new Hs(this.canvasManager),this.components.push(this.canvasControls,this.zoomIndicator,this.canvasToolbar)}mountAll(t=document.body){this.components.forEach(e=>e.mount(t))}unmountAll(){this.components.forEach(t=>t.unmount())}}class Zs{constructor(t){this.dataProvider=t;const e=document.getElementById("myCanvas");if(!e||!(e instanceof HTMLCanvasElement))throw new Error("Canvas element not found");this.canvas=e,this.scene=new Ke,this.canvasManager=new Fe(this.canvas,this.scene),this.diagramRepository=new Je(t),this.authService=new Os;const s=document.getElementById("app")||document.body;this.authComponent=new Ds(s,this.authService),this.uiManager=new Xs(this.canvasManager,this.scene),this.uiManager.mountAll(document.body)}async init(){this.canvasManager.init(),await this.diagramRepository.loadDiagram(this.scene);const t=await this.dataProvider.loadViewState(),e=this.canvasManager.getPanZoomManager();e.setViewState(t),this.canvasManager.draw(),e.viewChanges.subscribe(s=>this.dataProvider.saveViewState(s)),this.scene.changes.subscribe(()=>this.diagramRepository.saveDiagram(this.scene))}}const se="canvas-tasks",ne="canvas-dependencies",ie="canvas-stories",oe="canvas-view";class _s{async loadTasks(){const t=localStorage.getItem(se);return t?JSON.parse(t):[]}async loadDependencies(){const t=localStorage.getItem(ne);return t?JSON.parse(t):[]}async loadStories(){const t=localStorage.getItem(ie);return t?JSON.parse(t):[]}async saveTasks(t){localStorage.setItem(se,JSON.stringify(t))}async saveDependencies(t){localStorage.setItem(ne,JSON.stringify(t))}async saveStories(t){localStorage.setItem(ie,JSON.stringify(t))}async loadViewState(){const t=localStorage.getItem(oe);return t?JSON.parse(t):{scrollX:0,scrollY:0,scale:1.4}}async saveViewState(t){localStorage.setItem(oe,JSON.stringify(t))}}document.addEventListener("DOMContentLoaded",()=>{const n=new _s;new Zs(n).init()});
